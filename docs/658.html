<html>
<head>
<title>Developing Kubernetes Operators from the Ground Up | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>从头开始开发Kubernetes运营商|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/developing-kubernetes-operators#0001-01-01">https://acloudguru.com/blog/engineering/developing-kubernetes-operators#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>Kubernetes是构建其他平台的一个很好的平台。这意味着它非常适合创建符合您需求的工作流。Kubernetes中的操作者模式是启用定制工作流的关键，开发操作者使您能够作为平台提供商利用Kubernetes。</p><p>我们将在我的课程“<a href="https://acloudguru.com/course/developing-kubernetes-operators-from-the-ground-up" target="_blank" rel="noreferrer noopener">从头开始开发Kubernetes操作符</a>”中深入介绍开发Kubernetes操作符的过程，但是如果您想开始开发一个操作符，只需看看这个快速指南就可以了！</p><h2 id="h-what-you-will-need"><strong>你将需要什么</strong></h2><p>首先，我们需要确保拥有开发操作符所必需的工具。我们将讨论如何创建一个基于go的Kubernetes操作符。以下是您需要的工具:</p><ul><li><a href="https://www.techtarget.com/searchitoperations/definition/Go-programming-language" target="_blank" rel="noreferrer noopener"> <strong> Go </strong> </a>:这将是用于构建操作符的编程语言。</li><li><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noreferrer noopener"> <strong> Docker </strong> </a>:这将用于构建和推送映像，如果您选择将kind(Docker中的Kubernetes)用于本地Kubernetes集群，则需要安装kind。</li><li><a href="https://sdk.operatorframework.io/docs/installation/" target="_blank" rel="noreferrer noopener"> <strong>操作员SDK </strong> </a>:这有两个组件，列举如下:<ul><li><em>Operator-SDK</em>:命令行界面(CLI)工具和SDK方便了操作员的开发。</li><li>操作员生命周期管理器(Operator life cycle Manager):这有助于集群内操作员的安装、升级和基于角色的访问控制(RBAC)。</li></ul></li><li><strong> Kubernetes集群:</strong>这个应该是<a href="https://www.techtarget.com/searchitoperations/answer/Evaluate-3-ways-to-run-Kubernetes-locally" target="_blank" rel="noreferrer noopener">在本地运行</a>。我推荐<a href="https://kind.sigs.k8s.io/docs/user/quick-start"> ki </a> <a href="https://kind.sigs.k8s.io/docs/user/quick-start" target="_blank" rel="noreferrer noopener"> n </a> <a href="https://kind.sigs.k8s.io/docs/user/quick-start"> d </a>做这个，但是任何当地的Kubernetes集群都可以。<ul><li>对于本地开发和测试，使用with <strong> cluster-admin </strong>权限。</li><li>您还需要安装<a href="https://kubernetes.io/docs/tasks/tools/#kubectl" target="_blank" rel="noreferrer noopener"> kubectl </a>，这样您就可以与您的集群进行交互。</li></ul></li><li><strong>图像注册:</strong>例如，使用hub.docker.com发布图像。</li></ul><p>安装好这些工具后，乐趣就开始了。</p><h2 id="h-creating-the-operator-project"><strong>创建操作员项目</strong></h2><p>首先，我们需要为operator dev项目创建项目目录。我们需要创建它，然后移动到项目目录中。</p><pre class="wp-block-code"><code>mkdir memcached-operator cd memcached-operator</code></pre><p>在我们移动到目录中之后，我们就可以初始化项目目录并下拉脚手架文件来帮助您创建操作符。这里是我们开始使用运营商SDK的地方。您将使用带有<code>--domain</code>和<code>--repo</code>标志的<code>operator-sdk init</code>命令。在我的课程中，我将更详细地解释为什么这些选项是必要的。</p><pre class="wp-block-code"><code>operator-sdk init --domain example.com --repo github.com/example/memcached-operator</code></pre><h2 id="h-creating-the-api-and-controller"><strong>创建API和控制器</strong></h2><p>我们的下一步是为我们的操作员创建一个简单的API和控制器。在本课程中，我们将创建一个更健壮的Memcached操作符，但对此我们只是想开始做些事情，所以我们可以简单地使用<code>operator-sdk create api command</code>。为了创建这个API的控制器和其他资源，我们还将使用<code>--resource</code>和<code>--controller</code>选项。</p><pre class="wp-block-code"><code>perator-sdk create api --group cache --version v1alpha1 --kind Memcached --resource --controller</code></pre><h2 id="h-creating-and-deploying-the-operator-image"><strong>创建和部署操作员图像</strong></h2><p>接下来，我们将使用docker来构建我们的操作员映像并将其推送到我们的映像注册中心。在本课程中，我们将简单地使用Docker Hub，但是您可以使用任何您想要的注册表。您将使用以下命令来构建和推送映像。</p><pre class="wp-block-code"><code>make docker-build docker-push IMG="example.com/memcached-operator:v0.0.1"</code></pre><p>现在我们已经构建了我们的操作员映像，对于如何部署我们的操作员，我们有几个选项。</p><h3 id="h-deploy-with-olm"><strong>使用OLM部署</strong></h3><p>我们的第一种方法是使用运营商生命周期管理器来部署我们的运营商。OLM允许您使用操作员框架轻松地管理、版本化和升级您的操作员。首先，我们需要在集群中启用OLM。</p><pre class="wp-block-code"><code>operator-sdk olm install</code></pre><p>接下来，我们将为我们的操作员创建包映像，然后我们将构建并推送映像。您将使用make bundle、make <code>bundle-build</code>和make <code>bundle-push</code>命令来完成这个任务。</p><pre class="wp-block-code"><code>make bundle IMG="example.com/memcached-operator:v0.0.1" make bundle-build bundle-push BUNDLE_IMG="example.com/memcached-operator-bundle:v0.0.1"</code></pre><p>接下来，我们将使用<code>operator-sdk run bundle command</code>将操作员部署到我们的集群中。</p><pre class="wp-block-code"><code>operator-sdk run bundle &lt;some-registry&gt;/memcached-operator-bundle:v0.0.1</code></pre><p>然后，您可以使用我们下载的脚手架创建一个示例定制资源。</p><pre class="wp-block-code"><code>kubectl apply -f config/samples/cache_v1alpha1_memcached.yaml</code></pre><p>这将显示如下所示的输出:</p><pre class="wp-block-code"><code>memcached.cache.example.com/memcached-sample created</code></pre><p>接下来，如果我们想卸载我们的操作员，您可以使用以下命令:</p><pre class="wp-block-code"><code>operator-sdk cleanup memcached-operator</code></pre><h3 id="h-deploy-directly-to-the-cluster"><strong>直接部署到集群</strong></h3><p>我们部署操作员的下一个方法是直接部署到集群。我们将使用make deploy命令。</p><pre class="wp-block-code"><code>make deploy IMG="example.com/memcached-operator:v0.0.1"</code></pre><p>部署操作符后，我们就可以创建自定义资源了。</p><pre class="wp-block-code"><code>kubectl apply -f config/samples/cache_v1alpha1_memcached.yaml</code></pre><p>接下来卸载您将简单地运行以下:</p><pre class="wp-block-code"><code>make undeploy</code></pre><h3 id="h-run-locally-outside-of-the-cluster"><strong>在集群外本地运行</strong></h3><p>最后，我们的最后一种方法是在部署到集群之前测试我们的操作员。您将简单地使用此命令来完成此操作:</p><pre class="wp-block-code"><code>make install run</code></pre><p>这将运行它在您的终端，并退出它只需做一个ctrl+c。</p><h2 id="h-so-what-s-next">那么下一步是什么？</h2><p>既然你已经有了基本的东西，我相信我们已经激发了你的兴趣！如果这是一个你感兴趣的话题，并且你想更深入地研究这个话题，那么就来看看我的课程“<a href="https://acloudguru.com/course/developing-kubernetes-operators-from-the-ground-up" target="_blank" rel="noreferrer noopener">从头开始开发Kubernetes操作符</a>”。我将进一步深入介绍所使用的工具以及构建第一个基于go的Kubernetes操作符的过程。</p><p>做一个令人敬畏的大师，学习所有的东西！</p></div></div>    
</body>
</html>