<html>
<head>
<title>Scheduling Amazon DynamoDB Backups with Lambda, Python, and Boto3 | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Lambda、Python和Boto3 |云专家安排Amazon DynamoDB备份</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/scheduling-amazon-dynamodb-backups-with-lambda-python-and-boto3#0001-01-01">https://acloudguru.com/blog/engineering/scheduling-amazon-dynamodb-backups-with-lambda-python-and-boto3#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>假设您想每天备份一个DynamoDB表。我们还希望将备份保留一段指定的时间。实现这一点的一个简单方法是使用Amazon CloudWatch事件规则每天触发一个AWS Lambda函数。在这个AWS动手实验中，您将使用Boto3库用Python编写一个Lambda函数。设置它需要配置一个IAM角色，设置一个CloudWatch规则，并创建一个Lambda函数。</p><h2 id="h-create-the-dynamodb-table">创建DynamoDB表</h2><p>在本练习中，您当然可以使用您帐户中的任何DynamoDB表，但是如果您想使用AWS CLI创建一个表，您可以使用以下命令:</p><pre class="wp-block-preformatted">aws dynamodb create-table --table-name Person  --attribute-definitions AttributeName=id,AttributeType=N  --key-schema AttributeName=id,KeyType=HASH  --billing-mode=PAY_PER_REQUEST</pre><p>这将创建一个名为<b> Person </b>的DynamoDB表，主键为<b> id </b>。</p><h2 id="h-create-the-iam-execution-role">创建IAM执行角色</h2><p>所有Lambda函数都需要一个IAM角色来定义授予它的权限。这被称为Lambda函数的<b>执行角色。</b>首先，我们将浏览为Lambda函数创作IAM角色和创建Lambda函数本身的过程。我们将使用AWS管理控制台来完成这项任务:</p><ol><li>导航至<strong> IAM </strong>。</li><li>导航到<strong>策略</strong>。</li><li>点击<b>创建策略。</b></li><li>选择<b> JSON </b>选项卡。</li><li>用以下JSON语句替换默认内容:</li></ol><pre class="wp-block-preformatted">{   "Version":"2012-10-17",   "Statement":[      {         "Effect":"Allow",         "Action":[            "logs:CreateLogGroup",            "logs:CreateLogStream",            "logs:PutLogEvents"         ],         "Resource":"arn:aws:logs:*:*:*"      },      {         "Action":[            "dynamodb:CreateBackup",            "dynamodb:DeleteBackup",            "dynamodb:ListBackups"         ],         "Effect":"Allow",         "Resource":"*"      }   ]}</pre><p>该语句授予两组权限。首先，它授予了记录到CloudWatch日志的能力。有了这个权限，任何Python <code>print()</code>语句都会显示在CloudWatch日志中。其次，我们授予Lambda函数在所有表上创建、列出和删除DynamoDB备份的权限。</p><ol><li>点击<b>审核政策。</b></li><li>将这个策略命名为<b>LambdaBackupDynamoDBPolicy</b>。</li><li>点击<b>创建策略。</b></li></ol><p>既然已经创建了策略，您必须创建一个附加了该策略的角色。</p><ol><li>在IAM中，导航到<b>角色</b>。</li><li>点击<b>创建角色</b>。</li><li>选择可信实体的类型:<b> AWS服务</b>。</li><li>选择将使用此角色的服务:<b> Lambda </b>。</li><li>点击<b>下一步:权限</b>。</li><li>在搜索框中，找到上一步中创建的<b>LambdaBackupDynamoDBPolicy</b>。</li><li>选中策略名称旁边的复选框。</li><li>点击<b>下一步:标签</b>。</li><li>点击<b>下一步:复习</b>。</li><li>角色名称:<b> LambdaBackupDynamoDBRole </b>。</li><li>点击<b>创建角色</b>。</li></ol><h2 id="h-create-the-lambda-function">创建Lambda函数</h2><p>让我们创建我们的Lambda函数！</p><ol><li>导航至<strong>λ</strong>。</li><li>点击<b>创建功能</b>。</li><li>从头开始选择<b>作者。</b></li><li>函数名:<b> BackupDynamoDB </b>。</li><li>运行时:<b> Python 3.7 </b>。</li><li>在<em>权限</em>下，选择<b>选择或创建一个执行角色</b>。</li><li>在<em>执行角色</em>下，选择<b>使用现有角色</b>。</li><li>在<em>现有角色</em>下，选择上一步创建的<b> LambdaBackupDynamoDBRole </b>。</li><li>点击<b>创建功能</b>。</li></ol><p>将下面的源代码粘贴到Lambda函数的代码编辑器中:点击屏幕右上角的<strong>保存</strong>。</p><h2 id="h-create-a-cloudwatch-rule">创建云观察器规则</h2><p>接下来，我们将创建一个CloudWatch规则来安排Lambda函数定期运行。这将执行DynamoDB表的备份，并删除过时的备份。</p><ol><li>导航到<b>云观察</b>。</li><li>导航到<b>事件</b> &gt; <b>规则</b>。</li><li>点击<b>创建规则</b>。</li><li>安排事件以所需的时间间隔运行(例如，每1天一次)。</li><li>点击<b>添加目标</b>。</li><li>在<em>λ函数</em>下，选择<b> BackupDynamoDB </b>。</li><li>在<em>配置下输入</em> <b>，</b>选择<b>常量(JSON文本)</b>。</li><li>将值设置为JSON语句:<pre>{"TableName": "Person"}</pre></li><li>点击<b>配置详细信息</b>。</li><li>名称:<b> BackupDynamoDBDaily </b>(或者你喜欢的任何名字)。</li><li>点击<b>创建规则</b>。</li><li>等待CloudWatch规则触发您计划的下一个备份作业。如果你和我一样没有耐心，你可以把调度间隔设置为<b> 1分钟</b>，你会看到它运行得更快。</li><li>使用CloudWatch日志验证计划的备份作业是否已运行。日志组将被命名为<code>/aws/lambda/BackupDynamoDB</code>，每次调用都有一个流。</li><li>验证备份文件是否存在于DynamoDB备份列表中。</li></ol><h2 id="h-want-to-learn-more">想了解更多？</h2><p>我希望你会发现这种技术对你自己的工作有用。如果你想学习更多有用的AWS自动化技术，可以看看我的新课程<a href="https://linuxacademy.com/amazon-web-services/training/course/name/automating-aws-with-lambda-python-and-boto-3/" target="_blank" rel="nofollow noopener noreferrer"> <b>用Lambda、Python和Boto3实现AWS自动化。</b>T3】</a></p></div></div>    
</body>
</html>