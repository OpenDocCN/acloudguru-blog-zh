<html>
<head>
<title>Adding a Jenkins Agent Node | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>添加Jenkins代理节点|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/adding-a-jenkins-agent-node#0001-01-01">https://acloudguru.com/blog/engineering/adding-a-jenkins-agent-node#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>主/控制器是中央协调进程，它存储配置、加载插件并为Jenkins呈现各种用户界面。</p><p>代理通常是连接到Jenkins主服务器的机器或容器，用于在主服务器的指导下执行任务。</p><p>单一的整体式Jenkins安装对于项目数量相对较少的小团队来说非常有用。但是，随着您需求的增长，通常有必要扩大规模。Jenkins提供了一种叫做“主代理连接”的方法。您可以为Jenkins提供代理来处理作业的执行，而主服务器为Jenkins UI提供服务并充当控制节点，而不是在单个系统上运行所有的构建作业。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-accelerate-your-career">加速您的职业发展</h2><p class="has-text-align-center"><a href="https://acloudguru.com/pricing">从ACG开始</a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室改变你的职业生涯。</p><p/><hr class="wp-block-separator"/><p>在这篇文章中，我想给你一个如何建立一个Jenkins代理的简单介绍。你可以在这里找到关于Jenkins代理节点的更多信息。<strong>你将需要:</strong></p><p>我根据詹金斯版本<em> 2.89.4 LTS </em>编写了这个指南。我将提供一些命令，可以用来在CentOS 7机器上完成所有这些步骤。</p><h3 id="h-step-1-install-the-necessary-packages">步骤1:安装必要的软件包。</h3><p>您需要在代理节点上安装一些包，比如Java，以及运行您的构建可能需要的任何工具(Git、Maven、Ant、Gradle等)。).我来安装<em> Java </em>和<em>T3】GitT5:</em></p><pre class="wp-block-preformatted">sudo yum -y install java-1.8.0-openjdk git</pre><h3 id="h-step-2-create-a-user-on-the-agent-to-be-used-by-jenkins">步骤2:在代理上创建一个供Jenkins使用的用户。</h3><p>现在我们需要在代理上创建一个用户。Jenkins主服务器将以此用户身份登录代理，所有构建作业将以此用户身份执行。将这个用户称为<em> jenkins </em>是有意义的，我们将为他们提供一个特殊的主目录，jenkins代理的文件将存放在这个目录中:</p><pre class="wp-block-preformatted">sudo useradd -d /var/lib/jenkins jenkins</pre><h3 id="h-step-3-generate-an-ssh-key">步骤3:生成一个ssh密钥。</h3><p>接下来，我们需要生成一个ssh密钥。Jenkins将使用这个密钥向代理节点进行验证，并作为<em> jenkins </em>用户登录。这个密钥几乎可以在任何Linux机器上生成，但是您也可以在代理节点本身上生成:</p><pre class="wp-block-preformatted">ssh-keygen</pre><p>该命令将提供一系列提示。请随意使用默认值。从安全角度来看，在出现提示时输入密码可能是一个好主意，如果您这样做，请确保记下您使用的密码，因为您以后会需要它。该命令将输出两个文件:<em> id_rsa </em>和<em> id_rsa.pub </em>。如果您已经熟悉了在Linux中使用ssh密钥的过程，那么这将是您非常熟悉的，但是如果没有，不要担心。我会教你如何使用这些钥匙！默认情况下，这些文件位于<i> ~/中。ssh/ </i>。当您运行<em> ssh-keygen </em>时，您可以选择指定另一个位置。</p><h3 id="h-step-4-add-the-public-key-to-the-authorized-keys-file-of-the-jenkins-user-on-the-agent-node">第四步:在<em>代理</em>节点将公钥添加到<i>詹金斯</i>用户的<em> authorized_keys </em>文件中。</h3><p>接下来，我们需要将公钥(<em> id_rsa.pub </em>的内容)添加到我们之前创建的<em> jenkins </em>用户的<em> authorized_keys </em>文件中。这将允许任何拥有私钥的人(在我们的例子中是Jenkins master)作为<em> jenkins </em>用户登录到<em>代理</em>节点。首先，我们需要创建<em> authorized_keys </em>文件所属的目录，然后我们可以创建文件本身:</p><pre class="wp-block-preformatted">sudo mkdir /var/lib/jenkins/.sshsudo vi /var/lib/jenkins/.ssh/authorized_keys</pre><p>复制前面生成的<em> id_rsa.pub </em>文件的全部内容(<em> ~/)。ssh/id_rsa.pub </em>默认)粘贴到<em> authorized_keys </em>中，然后保存。</p><h3 id="h-step-5-add-the-jenkins-agent-node-via-the-jenkins-ui">第五步:通过Jenkins UI添加Jenkins <em>代理</em>节点。</h3><p>现在我们准备好通过Jenkins UI完成节点的设置。在Jenkins中，进入<strong>管理Jenkins </strong>，然后<strong>管理节点</strong>，再点击<strong>新建节点</strong>。在这里你可以给你的代理节点起一个名字，然后选择<strong>永久代理</strong>，点击<strong> OK </strong>。这里有多种选项可以用来定制您的节点。我们现在关心的是<strong>发射方式</strong>。</p><ol><li>对于<strong>启动方式</strong>，选择<strong>通过SSH </strong>启动从代理。</li><li>在<em>主机</em>字段中输入您的<em>代理</em>节点的主机名或IP地址。</li><li>点击<em>证件</em>旁边的<strong>添加</strong>按钮，选择<strong>詹金斯</strong>范围。</li><li>对于凭证，使用私钥将<strong>种类</strong>设置为<strong> SSH用户名。</strong></li><li>输入<em> jenkins </em>作为用户名。</li><li>对于私钥，选择<strong>直接输入</strong>。然后，复制您的私钥文件的内容(<em> ~/)。ssh/id_rsa </em>默认)并粘贴到<strong> Key </strong>框中。</li><li>如果您在生成密钥时使用了密码短语，请为<strong>密码短语</strong>输入密码短语，否则，将其留空。</li><li>输入一个<em>描述id </em>和<em>描述</em>，然后点击<strong>添加</strong>。</li><li>点击<strong>保存</strong>保存新节点。</li></ol><h3 id="h-step-6-make-sure-everything-is-working">第六步:确保一切正常。</h3><p>您的新节点现在应该出现在节点列表中。您可能会注意到节点图标上有一个红色的X。这表明它没有连接，但那是因为我们刚刚添加它，它还没有机会连接。等待几秒钟并刷新页面，红色X将消失，表示节点已连接。<strong>恭喜你！</strong>您已经成功创建了一个Jenkins代理节点！</p><hr class="wp-block-separator"/><p id="h-interested-in-learning-more-about-jenkins-check-out-our-certified-jenkins-engineer-course">有兴趣了解更多关于Jenkins的信息吗？查看我们的<a href="https://acloudguru.com/course/jenkins-fundamentals">詹金斯基础</a>课程，积累基础知识。或者，试试我们的<a href="https://acloudguru.com/course/certified-jenkins-engineer">认证詹金斯工程师课程</a>，为你准备认证詹金斯工程师考试。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-master-the-most-in-demand-skills">掌握最受欢迎的技能</h2><p class="has-text-align-center">无论您是云新手还是经验丰富的专家，云专家都可以让您轻松(而且非常棒)地提升您的云职业生涯。查看<a href="https://acloudguru.com/blog/news/whats-free-at-acg-june-2021" target="_blank" rel="noreferrer noopener"> ACG的免费课程</a>或立即开始免费试用。</p></div></div>    
</body>
</html>