<html>
<head>
<title>Tips for Adopting GitHub Kubernetes in AWS | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在AWS中采用GitHub Kubernetes的技巧|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/adopting-gitops-for-kubernetes-on-aws#0001-01-01">https://acloudguru.com/blog/engineering/adopting-gitops-for-kubernetes-on-aws#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>上周，我有幸参加了在线的<a href="https://aws.amazon.com/events/summits/online/emea/" target="_blank" rel="noopener noreferrer"> AWS EMEA峰会。容器是峰会的一个大主题，议程上最受欢迎的话题之一是</a><a href="https://github.com/jasonumiker/k8s-plus-aws-gitops" target="_blank" rel="noopener noreferrer"> Kubernetes GitOps on AWS </a>与Jason Umiker。</p><p>那么什么是GitOps，为什么它对试图在AWS上运行Kubernetes的企业来说如此重要？</p><h2 id="h-what-is-gitops"><span>什么是GitOps？</span></h2><p><span>现代软件开发实践集中在三个主要活动上:</span></p><ol><li><span>使用Git等工具进行源代码管理</span></li><li><span>使用Jenkins或CodeBuild等工具自动构建和测试应用</span></li><li><span>使用CodeDeploy等工具实现自动化代码部署</span></li></ol><p><span>这些活动通常组合在一起作为<a href="/blog/business/brazeal-how-your-org-predicts-your-ci/cd-pipeline" target="_blank" rel="noopener noreferrer">持续集成管道</a>，其中构建服务监控Git repo并自动触发构建以响应源代码中的变化。</span></p><p>将自动化的理念带到下一个层次，持续部署的实践通过在新代码成功通过构建和测试阶段后立即自动部署新代码，进一步扩展了管道。</p><p><span>CI/CD相结合的方法处理流程中的每一个步骤，从提交代码变更的那一刻起，一直到部署，其巨大优势是您的应用程序可以在任何环境中工作，无论是开发、集成、试运行还是生产环境！</span> <span/></p><p>GitOps利用这些久经考验的原则，允许我们将相同的理念应用于处理基础设施代码(IaC)的变更。如果基础设施是作为代码来管理的，那么为什么不将代码存储在Git这样的源代码控制系统中，并在每次提交更改时自动触发对基础设施的更新呢？ <span/></p><h2 id="h-why-use-gitops"><span>为什么要使用GitOps？</span></h2><p><span>工作负载向云的<a href="https://acloudguru.com/blog/business/what-is-cloud-migration">迁移大大加快了基础设施即代码作为资源调配方法的采用。像</a><a href="https://acloudguru.com/course/mastering-aws-cloudformation" target="_blank" rel="noopener noreferrer"> CloudFormation </a>和AWS Cloud Development Kit (CDK)这样的工具允许你使用熟悉的编程语言，如JSON和YAML，以及Python、Java和. Net来编码、建模和提供云资源</span></p><p>Git是许多开发人员已经在使用的工具，因此让运营和基础设施团队也参与进来是有意义的，这样每个人都可以从管理代码的一致、简化和高效的工作实践中受益。</p><p/><h2 id="h-gitops-kubernetes-integration"><span>gitops kublantes integration</span></h2><p>Kubernetes 支持创建、更新和删除对象的声明式方法。这意味着Kubernetes中所需的对象状态可以由配置文件定义。Kubernetes部署、pods和负载平衡器之类的服务都可以定义为代码，理想情况下，这些代码应该受到版本控制，并存储在合适的源代码存储库中，如Git。</p><p>像CodePipeline和Flux CD这样的工具可以被配置为注意到Git存储库中的变化，并采取措施触发对AWS基础设施的更新。</p><p><span> <a href="https://fluxcd.io/" target="_blank" rel="noopener noreferrer"> Flux CD </a>是一个简单的实用程序，运行在您的Kubernetes集群上。每次您想要更新您的应用程序时，Flux CD会定期从您的Git存储库中提取代码更改并为您应用这些更改，而不是手动运行类似</span> <span>的命令。</span></p><p><span>默认情况下，Git拉取频率设置为5分钟，但是您可以使用以下命令告诉Flux立即同步更改:</span><span>Flux CTL sync–k8s-FWD-ns Flux</span><span/></p><h2 id="h-5-tips-for-adopting-gitops-for-your-kubernetes-workload-in-aws"><span>针对AWS中的Kubernetes工作负载采用GitOps的5个技巧</span></h2><p>现在我们已经有了一些背景知识，让我们来浏览一些技巧，以便在您的Kubernetes部署工作流中充分利用GitOps。</p><h3 id="h-1-use-git-as-your-source-of-truth"><span> 1。使用Git作为你的真理来源</span></h3><p>使用Git，你可以跟踪代码变更的全部历史。这意味着您将了解谁做出了更改，他们更改了什么，他们何时做出了更改，为什么需要更改，以及谁批准了更改。当然，这意味着确保人们在提交变更时包含适当的评论是非常重要的，引用与功能请求或bug相关的标签也是很好的实践。</p><h3 id="h-2-use-a-git-branch-per-environment"><span> 2。每个环境使用一个Git分支</span></h3><p>合并到分支的变更可以触发相应环境中的部署。您还可以考虑每个开发人员都有他们自己的分支，这样他们可以独立地迭代他们自己的变更，并且在准备好的时候将变更合并到开发或集成环境中，并根据其他人的变更进行测试，最终在准备好发布到生产环境时合并到生产分支中。</p><h3 id="h-3-practice-proper-change-management"><span> 3。实践适当的变更管理</span></h3><p>在你的拉式请求机制中，对每一项变更都要实施同行评审。如果你把你的生产环境想象成一座城堡，那么让Git成为你的吊桥。强制所有变更通过Git中的同行评审过程，并配置您的管道，以确保所有变更在发布到生产之前都通过了集成测试。这样，只有成功测试的更改才能进入prod，确保您的应用程序可以在任何环境下工作。</p><h3 id="h-4-roll-back-with-git"><span> 4。用Git回滚</span></h3><p>使用Git，你需要做的唯一一件事就是恢复到之前的提交！例如，您可以使用类似于 <span> git revert HEAD </span> <span>的命令来回滚最新的更改并返回到之前的提交。</span></p><h3 id="h-5-automate-everything"><span> 5。自动化一切</span></h3><p>当然，最终目标是让一切自动化，这样Git repo中的任何变化都会被检测到，并触发相应环境的更新。Flux CD是一个工具，它监视您指定的所有容器映像存储库，检测新映像，触发部署，并自动更新您的Kubernetes集群所需的运行配置。所以它基本上确保了Kubernetes集群的状态与您在Git中提供的配置相匹配。</p><p>对于Kubernetes之外的任何资源，如RDS数据库或EC2实例，您可以使用CodePipeline来自动触发使用CloudFormation应用的更改。</p><h3 id="h-manage-kubernetes-with-gitops"><span>使用GitOps管理Kubernetes】</span></h3><p>在AWS中使用GitOps方法来管理您的Kubernetes基础设施是一个自然的选择。</p><p>你的应用可以在任何环境下运行。</p><p>您的开发和运营团队使用相同的工具。</p><p>你掌控着你的环境，你了解每一项变革的“批准者、批准内容、批准原因、批准时间和批准人”。此外，您还可以在需要时回滚到已知且可信的早期状态！</p><h3 id="h-want-more-git-goodness">想要更多的食物吗？</h3></div></div>    
</body>
</html>