<html>
<head>
<title>Automating CI/CD With AWS CodePipeline | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>利用AWS代码管道实现CI/CD自动化|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/automating-ci-cd-with-aws-codepipeline#0001-01-01">https://acloudguru.com/blog/engineering/automating-ci-cd-with-aws-codepipeline#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>谁不喜欢一个<a href="https://acloudguru.com/course/implementing-a-full-ci-cd-pipeline"> CI/CD管道</a>？尤其是当你在AWS上争论基础设施的时候。我们今天的问题是:我们能使用AWS自己的代码管道服务来管理AWS基础设施的频繁部署吗？</p><p>嗯，首先……你知道什么是持续集成和持续部署管道<em>吗</em>？如果你有，那太好了。跳过下面斜体部分。如果没有，继续读下去。</p><p>持续集成和持续部署(CI/CD)管道用于自动化软件交付步骤，包括构建、测试和部署阶段。是的，这是一个安全的空间。尽情跳你的快乐之舞，不要害怕评判。</p><p>持续集成(CI)阶段包括构建和测试阶段。CI确保构建的变更工件也可以安全部署。现在是一个很好的时机来说明，如果部署阶段是<strong>而不是</strong>完全自动化，那么CD也可能意味着持续交付。在本教程中，CD意味着持续部署，因此所有的更改都被部署到生产环境中。紧张？尝试在生产环境之前部署到临时环境。</p><p>好了，开始了。在这篇博文中，我将带您浏览我为<a href="https://cloudresumechallenge.dev">云简历挑战</a>创建CI/CD管道时采取的步骤。这是我的<a href="https://github.com/bmitchell21/backend-resources"> GitHub知识库，用于云简历挑战赛的后端资源</a>。如果你只是想跟着这个例子走，这里是我的<a href="https://github.com/bmitchell21/acg-pipeline-test"> GitHub库为这个教程</a>。</p><p>第一步是拥有一个AWS账户。它是免费创建的，在最初的12个月里，你可以免费访问许多资源！(阅读有关<a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc"> AWS自由层</a>的更多信息。)</p><p>您拥有AWS帐户。你在滚动。让我们开始…有趣的部分。在AWS控制台中，导航到代码管道。选择<strong>创建管道</strong>。在创建管道的这一点上，我感到很有信心。这是我最后一步。<em>我想，这大约需要一个小时</em>。是啊，没错。更像是五天(我真的<em>投入了时间)。我不想让其他人花那么长时间。这篇文章只是为了帮助读者更快地完成这个过程。还给你，教程。</em></p><ol><li>选择管道名称并创建新的服务角色。请记住，稍后可能需要编辑服务角色。(说真的。记住这个。许可对我来说是一个很大的障碍)。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/aa7620e88cfd41433fe43a530a4e82d8.png" alt="" data-original-src="https://lh4.googleusercontent.com/ED7pSWPuTYPRsoblwRHnJjOcCsRAY_jBjK2ckfenkYffCTuI0VVJciftZl4VnnEym_XEk_OMJXV5NMBwb2bpqlgWlRJgpRArU6UZJhF8W_vI55uMjC3UhqF7tE5TNWXIrDXhTcs"/></figure><p><strong>下一个</strong>。配置源阶段。我使用了AWS CodeCommit，它需要CodeCommit中的存储库。在创建CodeCommit存储库之前，我们有两个步骤要完成。</p><ol start="2"><li>我们需要一个S3水桶。S3桶是用来存放文物的。我使用AWS CLI创建了一个bucket。请参见下面的命令。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/a9e312e50de4b465c4499806c05ba40a.png" alt="" data-original-src="https://lh5.googleusercontent.com/x07kNYDW555MriVcfZP32bmxy6YKr5yDZba30Ma2F1noZPiDKauZfefVGxl7xlPjOwnUMt956ppssqRUY2Mda4SnHit8fIpop90IzNEaSbicDs2MxnDuYu_KXF6lbg"/></figure><ol start="3"><li>创建云信息角色。在这个例子中，我创建了一个角色，将<strong> CloudFormation </strong>作为可信实体，并授予了<strong> AWSLambdaExecute </strong>权限。然后，我使用JSON选项卡将如下所示的内联策略附加到角色上。根据您的SAM应用程序，您可能需要不同的权限。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/15d754280a486a1663bda3185c61b51c.png" alt="" data-original-src="https://lh3.googleusercontent.com/5RKK2YvjGuOqBIpwdRIh7ruepeGUFnbuhIi7FAa6QFPGlm1ua2fKJXeFHKQBtsg-6xX_c0wXalt49skIcBIakIK1M68QdJigxXMDfuTtPuT6c7TkBYqcJuck86oM1UO0kv5iruc"/></figure><p>让我们建立我们的CodeCommit存储库。</p><ol start="4"><li>在AWS控制台的新选项卡中打开CodeCommit。</li><li>创建一个存储库来保存您的工件。</li><li><a href="https://docs.aws.amazon.com/codecommit/latest/userguide/getting-started.html">将存储库克隆到您的本地机器</a>。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/c0e1bdbafe06a9a9cebacbe80a7ebe33.png" alt="" data-original-src="https://lh5.googleusercontent.com/bF81jAeuPZVCFlxv_lhnUw2vAhQpK6a-RIhE-70pWwE4Y20sNBIYOBcLyzMbkZWugfMpc5zD4d3nltromW7E3Rmf5MpGrZpHdzHYz48gqA25uu7f_arTe25QD9Hh22gXBTrVCLM"/></figure><ol start="7"><li>将所有需要的文件上传到本地文件夹，然后将它们推送到存储库。我的存储库包括一个<a href="https://aws.amazon.com/serverless/sam/"> AWS SAM </a>应用程序所需的文件。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/482bf1d9e084090d0cd11664d809af31.png" alt="" data-original-src="https://lh5.googleusercontent.com/F8lQLd5oGNAFlU4vMpyTa3cQr_MxPDWTVjh5W1xmRG0HAITwePLuuTSjDVxVv6hb9KqGVtRpZGYyoPeHO241VYHYeJqUGTO0Zm1pCoRX7h-Hot9EmHnGiPimp0VwlM_VczB1G7M"/></figure><ol start="8"><li>回到AWS控制台中的CodePipeline，配置源阶段设置。这建立了我们的源代码控制服务(CodeCommit ),作为我们部署管道的第一步。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/b05ea933339f9eea25415574c2a4aea5.png" alt="" data-original-src="https://lh4.googleusercontent.com/IZm1Y6niuPaf2UGwpXZBT1Gzda5HJezdrT_xvdFtc5RaizXlWqFBN5WJLerARthCWcHyFw9p6BHPeHnr_BO-YR2bmQ-Zsq_zXvHk9yojMa4swt-F8GHbxRAD1iwI6_CaWrBMLTE"/></figure><ol start="9"><li>创建构建阶段。这是我们打包应用程序进行部署的地方。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/49aa413d5e5042bc725cd4984a35812a.png" alt="" data-original-src="https://lh4.googleusercontent.com/TvkKB5LRl_J7IPJVKmTDVLYbivG48E2bAg-i65vRkscx-y5ipCaET0_SJ-T5TUpBrqoOlrdknYtXfn_0JPyCAAyvZV94pl-hYVwFyxXoANSIXwPqRbRBQHbUf4DMlB0JBSDHBSw"/></figure><p><strong>下一个</strong>。我们必须创建一个项目。</p><ol start="10"><li>选择<strong>创建项目</strong>并选择一个项目名称。我的下一步如下所示。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/e8fda8c3e87dbaf15f9e0f195245be09.png" alt="" data-original-src="https://lh6.googleusercontent.com/_sbRTaoUfD3QK3vt79RRFvcgYjJf7zmieDsGk6GRpguC1bzPt1HhuKP8EXaC8cGUnjT3hHwbNf1O4tWNgGZASxYPIU0ECL8ml6lwjqtogBEvlFHRY_j-miDPfWe6aXFnp7C_JwQ"/></figure><figure class="wp-block-image"><img loading="lazy" src="../Images/13d34227e2f394e0e77daa0bc4066542.png" alt="" data-original-src="https://lh5.googleusercontent.com/DOR6BvngzFjbnlPbH5dvYw1bUu0fSTnWYebfujQfvdi7ma1EY5o65D2hX_DNoJcrdyhH9gTnI-zU4RJzlLWyOBjznZOjh8ns0ltVHsN4H8c3QMdB-gdpEwYkKUBgrQDbUk_cQBY"/></figure><ol start="11"><li>记下<strong>角色名</strong>。管道在首次部署后将会失败，因为角色需要更新。</li></ol><p><strong>下一个</strong>。是时候配置部署阶段了。我们很接近了。我保证。</p><ol start="12"><li>我在部署阶段使用了可爱的云形。请记住，AWS SAM只是CloudFormation的超集，因此您可以通过CodePipeline原生部署SAM应用程序！这只是与AWS服务深度集成的一个很酷的优势。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/260c91ae483cb8697b9ec486c20f9d06.png" alt="" data-original-src="https://lh4.googleusercontent.com/ZRAR6rdO24YefjGXR4uPQeA-2JPL7WNbOZ-5-l5Q9ZKey8lFbuyp9GHPfIHD8y2Onas24LrwFooWN0_KeJT4-zZAP3veMGnKyR1-p5-iN1XvWrxsHNrDqK46_hX-_E4RRWEJRxo"/></figure><figure class="wp-block-image"><img loading="lazy" src="../Images/1a156ed0771bbeac71c6284b5cde66f2.png" alt="" data-original-src="https://lh3.googleusercontent.com/ojWCUcPedbOAPN5h7P1MgImAfEo6Ajk535LkLHK8goF7hr_VP5IhKUA5YRzpyqXDeEFfwRSHNC4P-Kcw7VzoXkMMt8YGZ_l-X2DNAS58yKBwRevQI5OPlt1tEeZDFvHd6orsJKQ"/></figure><ol start="13"><li>使用之前为部署阶段的角色创建的CloudFormation角色。</li></ol><p><strong>下一个</strong>。查看管线并创建管线。</p><p>请记住，更改将会失败，因为需要额外的权限。</p><ol start="14"><li>将<strong> AmazonS3FullAccess </strong>策略附加到我们之前创建的管道角色。</li><li>请重试部署。</li></ol><p>现在，这三个阶段都应该显示成功。现在我们需要做的就是添加一个执行变更阶段。就是这样！至少对管道来说是这样。</p><ol start="16"><li>编辑管道，然后编辑<strong>部署阶段</strong>。</li><li>在<strong>底部</strong>选择<strong>添加动作组</strong>。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/bdfa848038f774ebf28e871dba04dec1.png" alt="" data-original-src="https://lh4.googleusercontent.com/Puqx9-tJh4aerY7_Sb8cVbkScX_npEgE9iHnYG7nZRW5EUky7zLGE7hqK9dlVrt9AVqXJ6pCHWH5bfDqVBprD9njdUYnBUaEBgFuKBMo0CIddwHRRE6lp7zGz5s9ftPzFsflxvU"/></figure><ol start="18"><li>选择<strong>完成</strong>。然后<strong>救</strong>。然后<strong>发布变化</strong>。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/95a06a00d4aefa09fbc0be7d84103ba5.png" alt="" data-original-src="https://lh5.googleusercontent.com/XjvdZCq2CWR-sf5VJQW1uWYmjy9InkOJPBhOCNs8H3jO3Y6aatUjMJAcPemKS72YiszItJiSFvXiNoxqqs9MH3NXP_FcNHMdjFmpuUJLk6jq92HTg9EYUU7kxyaqaw"/></figure><ol start="19"><li>现在我们想要自动化API测试。下载<a href="https://www.postman.com/">邮差</a>和<a href="https://support.getpostman.com/hc/en-us/articles/115003703325-How-do-I-install-Newman-">纽曼</a>。你可能想知道这个过程是否会结束。(剧透:确实如此)</li><li>复制API url并粘贴到Postman中。点击<strong> + </strong>打开下面页面的空白版本。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/fba9e62140a62663ae5ce4cf9efdc8e0.png" alt="" data-original-src="https://lh5.googleusercontent.com/K_MSW2ZK6g-NMDkJmA4y57gsj5e6KZS9obfUvydR7fDPjV6Xx7YZJjXEnlvgYOQacbxpnngDtzSWsR7KOSHvR0AMSR7jbjyv-Np11ZfVU7_6ezcutjjHPtPAPt451A"/></figure><ol start="21"><li>包括您需要的特定测试。使用右边的片段来帮助。</li><li>按下<strong>保存</strong>。单击collections，将集合导出到保存SAM应用程序的其他文件的同一位置。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/a39a1b1ae2bbb51b43e383e72ed04a04.png" alt="" data-original-src="https://lh4.googleusercontent.com/t8hJtFdhQDBTHPD207jcKphuNlPwFwmGZmNliYcWpoU8Z-tiuKWmTRYc3dqo7oC8uwaYfDpSEMWofL65Uifl9He6gkoPBmGqMkH7QsHpomDkYHznzAtfjCe5n1j96A"/></figure><ol start="23"><li>更新buildspec.yml文件，然后在终端内部运行newman命令以确保它能够工作。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/3ecbefd0678bc6aab27f3f099fc28194.png" alt="" data-original-src="https://lh5.googleusercontent.com/t2jzmBMigFhEXWD9vsSV7QGxZd3cLOs0DQ7HxUBhwLrUHfG15JAp3fw1IlsxCD9j5OIFir2CsnKCvuckN1p9ZIA3yPNPE-a6AF96eeNFKzy06B5gZELHvV7AxdF4pQ"/></figure><p><img loading="lazy" src="../Images/a741afee8743d4890582462c329c5f2c.png" data-original-src="https://lh6.googleusercontent.com/qUWafBnrDVVD2ycPNjJEB20itcthaquixcvfwecYq4OdM4nbaNtIKYEhFubWXwqajqxhCan-e8Ia1q0FASG6z2DcUJ_1URlMCee75uAMYRfyNIUhPyiOrrz8cR6eCQ"/> <img loading="lazy" src="../Images/9bc266325415f23e91a9aedb21506fb4.png" data-original-src="https://lh3.googleusercontent.com/KQSixBToiuYWsQSPXSB_rJlDNLnfCe9pWT4Sy7gCBepOHw9AgF-smPH3ZxQEqFnhJbS0Mrr7_GnkGoztdvZjdlU1vPuUjTfbBiAmy8bJca5Da0gNyQECgTFbLMvfsQ"/></p><ol start="24"><li>将文件推送到CodeCommit存储库。然后，您可以查看代码构建日志，以了解管道的状态。</li></ol><figure class="wp-block-image"><img loading="lazy" src="../Images/4d2894fa2cea74e564b0245c01656e4a.png" alt="" data-original-src="https://lh4.googleusercontent.com/RIoY26Nd-sYyLxxCrzCZdhB21WnlZzaLGtxVLPl-p6O2hI1EWA5oTm6QVCbiXJ0smwPvIiSGEZBvbXccfunLCnL-_hgYq964YcDJbunw9t7ljYzxOsXlPhbduudvqA"/></figure><figure class="wp-block-image"><img loading="lazy" src="../Images/16d337a7c14e48e0c85607a9f4797b44.png" alt="" data-original-src="https://lh5.googleusercontent.com/KOgA0CpTB4Ry5UI1hMVcmXC_jpUJ3l_IiF6kN7LPTBGieXHj6iLgD5RhK2yjOt_fJUYOisZjZPFnZQ_xHjqx8GWRoN5HFWqV0ETTKg2Mc2QK4uW8ySJgl25jS3ZI5g"/></figure><p>它做了什么宝贝！！！我们完了！希望有帮助！如果你喜欢这个教程，请在Twitter上关注我，或者在T2的LinkedIn上联系我。在未来的日子里，我会有更多与AWS相关的教程。此外，请随时问我任何问题！如果可以的话，我非常乐意帮忙。</p><p><em> Brooke Mitchell是</em> <em>的一名云专家学习者和云开发者。</em></p></div></div>    
</body>
</html>