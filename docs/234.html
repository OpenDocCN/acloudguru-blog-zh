<html>
<head>
<title>How to get started with infrastructure as code (IaC) on GCP | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在云专家GCP上开始使用基础设施即代码(IaC)</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/how-to-get-started-with-infrastructure-as-code-iac-on-gcp#0001-01-01">https://acloudguru.com/blog/engineering/how-to-get-started-with-infrastructure-as-code-iac-on-gcp#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>想知道如何在谷歌云平台(GCP)上开始使用基础设施即代码(IaC)吗？好吧，如果你对GCP有所了解，但对IaC了解不多，那么我有一个故事给你！聚集起来，大师们，来听一个关于IaC、GCP、一个叫做<a href="https://acloudguru.com/hands-on-labs/deploying-resources-with-google-cloud-deployment-manager">谷歌部署管理器</a>的工具和一个叫罗伊的人的故事。</p><h4 id="h-once-upon-a-time">从前…</h4><p>从前，有一个叫罗伊·g·比夫的人。他是Virtucon公司的新实习生。他的第一个任务是熟悉Google Cloud Deployment Manager。他在办公桌前坐下来，在那里他找到了下面的架构图。</p><p>“嗯，”罗伊想。尽管罗伊熟悉谷歌云平台的基础知识，但他之前从未使用过部署管理器。</p><p>他决定做一些严肃的研究(也就是快速的谷歌搜索)来挖掘一些关于谷歌云部署管理器的信息。Roy了解到，Deployment Manager是一个GCP工具，用于将基础架构定义为可重用模板的代码。</p><p>Roy对图表有了更多的了解，他决定应该使用<a rel="noreferrer noopener" href="https://acloudguru.com/blog/engineering/one-shell-to-rule-them-all-5-reasons-to-use-powershell-for-cloud-management" target="_blank">云外壳</a>向部署管理器API提交一个配置文件。然后，部署管理器将使用计算引擎API来请求所需的资源，即使用默认VPC网络的VM实例。</p><p>罗伊匆匆写了一份清单，以确保他把所有的事情都安排妥当。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><em>设置多台服务器？我们都知道在几台服务器上连续运行命令是乏味且容易出错的。查看我们的动手实验室，学习使用<a href="https://acloudguru.com/hands-on-labs/using-bootstrap-scripts-in-google-compute-engine">引导脚本</a>在谷歌计算引擎中自动完成新服务器的基本设置。</em></p><hr class="wp-block-separator"/><h2 id="h-a-checklist-for-google-cloud-deployment-manager">Google云部署管理器清单</h2><ul><li>启用了部署管理器和计算引擎API的Google云项目</li><li>定义资源和项目信息的配置文件</li><li>将配置文件发送到部署管理器API的能力</li></ul><p>让我们看看Roy是如何完成这三项任务的。</p><hr class="wp-block-separator"/><p class="has-text-align-center">对Amazon Web Services上的基础设施代码感兴趣？ <br/> <em>查看<a href="https://acloudguru.com/blog/engineering/cloudformation-terraform-or-cdk-guide-to-iac-on-aws" target="_blank" rel="noreferrer noopener">AWS上的IaC指南</a>。</em></p><hr class="wp-block-separator"/><h2 id="h-deployment-manager-configuration-file">部署管理器配置文件</h2><p>Roy继续阅读关于使用云部署管理器的<a rel="noreferrer noopener" href="https://cloud.google.com/deployment-manager/docs/step-by-step-guide/installation-and-setup" target="_blank">文档。在早期的项目启动同步中，Roy获得了一个启用了正确API的GCP项目。</a></p><p>他的下一步是学习更多关于用于以代码形式设计基础设施的配置文件。他了解到配置文件描述了要在Google云平台上创建或配置的资源。每个资源都有三个在YAML文件或Python模板中定义的组件<strong>。YAML文件必须包括资源部分。</strong></p><figure class="wp-block-table"><table><thead><tr><th>资源</th><th>定义</th></tr></thead><tbody><tr><td><strong>名称</strong>:第一虚拟机</td><td>资源名称</td></tr><tr><td><strong>类型</strong> : compute.v1.instance</td><td>我们想要创建的资源类型</td></tr><tr><td><strong>属性</strong>:</td><td>此资源类型的参数</td></tr></tbody></table></figure><p>Roy知道，在代码文件的资源部分，他需要添加一个关于要创建的资源的名称、类型和属性。这不是很难编码，也很容易记住。</p><p>如果Roy想创建一个不同的资源，比如说一个VPC网络，他会将类型改为<em> compute.v1.network </em>并使用与网络资源相关的属性。Roy收藏了下面的站点，它提供了一个<a rel="noreferrer noopener" href="https://cloud.google.com/deployment-manager/docs/configuration/supported-resource-types" target="_blank">所有支持的资源类型</a>的列表。</p><h4 id="h-pop-quiz">突击测验</h4><p>下面是一个配置文件的摘录。关注一下<em> my-first-vm </em>实例的属性，您能确定属性中的每个主要参数定义了什么吗？</p><p>在思考上述问题时，Roy注意到有四个不同的参数用于<em> compute.v1.instance </em>类型，它们是:</p><ul><li><strong> zone: </strong>指定将在Google Cloud中创建资源的区域</li><li><strong> machineType: </strong>指定机器大小——考虑实例的内存和RAM</li><li><strong> disks: </strong>指定要使用的磁盘类型，如果是引导磁盘，则指定要安装的操作系统映像</li><li><strong>网络接口:</strong>指定VPC网络，需要外部IP地址</li></ul><p>罗伊还注意到了文件上的凹痕图案。Roy记得配置文件是用YAML结构编写的，它使用缩进来分隔资源、参数(属性)和值。</p><p>对配置文件有了很好的理解后，Roy接下来需要将文件传递给部署管理器API。根据图表，要使用的工具是<a href="https://acloudguru.com/hands-on-labs/build-a-custom-network-in-google-cloud-shell"> Google Cloud Shell </a>。</p><p>在幕后，Roy用Google项目细节更新了示例配置文件。</p><h3 id="h-google-cloud-shell">谷歌云外壳</h3><p>Roy之前在准备Google Certified Associate Cloud Engineer考试期间使用了Cloud Shell，因此他记得Cloud Shell是一个基于网络的终端，连接到一个预装了工具的容器化实例，以便与Google云平台进行交互。</p><p>云壳预装了Google SDK。Roy决定将配置文件提交给部署管理器API，并使用Google Cloud Shell <strong> gcloud </strong>命令行工具。</p><h2 id="h-setting-up-your-configuration-file">设置配置文件</h2><p>罗伊连接到谷歌云控制台，并在他的网络浏览器中启动了云壳连接。进入终端后，Roy验证他是否在正确的项目中，并在活动的配置文件中设置区域。</p><p>接下来，罗伊推出了<a rel="noreferrer noopener" href="https://acloud.guru/series/acg-fundamentals/view/cloud-shell-and-editor" target="_blank">云编辑器</a>，一个有用的基于云的IDE工具。在编辑器中，Roy在一个已知的位置创建了一个名为<code>roys.yaml</code>的新文件。(文件的扩展名需要是YAML格式。)</p><p>Roy然后将在该网页上找到的示例配置文件复制并粘贴到编辑器中。Roy记得他需要将标记为“<em> My_Project </em>的部分更改为他的项目名称。(这个完成的比较早，不过是个例子让你知道Roy改了什么。)</p><p>也许您还想更改虚拟机名称或用于部署的网络？<a href="https://github.com/ACloudGuru-Resources/Course_IaC_on_GCP_with_Deployment_Manager/blob/master/blog_files/roys.yaml">使用此链接</a>下载或复制roys.yaml文件，以便在您的Cloud Shell实例中跟进。</p><h2 id="h-deploying-the-configuration-file-using-gcloud">使用gcloud部署配置文件</h2><p>完成后，Roy就可以部署文件了。Roy使用命令行界面切换到保存<em> roys.yaml </em>配置文件的目录。</p><p>Roy使用下面的命令通过Cloud Shell向部署管理器API提交资源请求。</p><p><code>gcloud deployment-manager deployments create roys-test --config roys.yaml</code></p><ul><li><strong> gcloud </strong>是谷歌SDK工具</li><li>部署管理器是资源</li><li><strong>部署</strong>是我们需要的服务</li><li>为了<strong>创建</strong>一个名为<strong> roys-test </strong>的部署</li><li>使用<strong>配置</strong>文件命名为<strong>&lt;roys . YAML&gt;T3】</strong></li></ul><h3 id="h-deployment-manager">部署经理</h3><p>单击submit后，Roy观察了部署管理器进度指示器。15秒钟后，他收到了一条返回消息，表明操作已经成功完成。</p><p>Cloud Deployment Manager非常出色地让您知道文件中是否有任何错误，以及如何修复它们，所以不要担心:如果您遇到错误，请列出更改列表并重试。</p><p>在Roy的案例中，一切都按计划进行，他使用gcloud compute instances list命令查看新部署的详细信息。(部署是使用部署管理器部署的资源的名称。)</p><h3 id="h-deleting-the-resources-to-reduce-cost">删除资源以降低成本</h3><p>在故事的这一点上，Roy打破了第四堵墙，并提醒我们在结束时删除Google Cloud测试资源。(我们不希望你拿个账单，怪这个故事。)所以要像罗伊一样。<strong>不要忘记使用这个命令删除项目</strong>中的资源——如果您更改了它，用您的部署名称替换<em> roys-test.yaml </em>。</p><p><code>gcloud deployment-manager deployments delete roys-test</code></p><p>通过完成上面的步骤，你(或者更确切地说，Roy)应该在Google Cloud上的项目中创建了一个VM。从此每个人都过着幸福的生活。</p><h2 id="h-mastering-managing-infrastructure-as-code">掌握将基础设施作为代码进行管理</h2><p>像所有技能一样，将基础设施作为代码来管理需要实践。谷歌有一个很好的关于使用部署管理器的演练。但是你可以亲自去<a rel="noreferrer noopener" href="https://acloud.guru/learn/iac-on-gcp-with-deployment-manager" target="_blank">学习如何在谷歌云平台</a>上以代码形式管理你的基础设施，这是一门名副其实的云大师课程<a rel="noreferrer noopener" href="https://acloud.guru/learn/iac-on-gcp-with-deployment-manager" target="_blank">在GCP用部署管理器</a>以代码形式管理基础设施。</p><p>培养技能，成为现实世界中的专业云架构师。<a href="https://acloudguru.com/course/google-certified-professional-cloud-architect">Google Certified Professional Cloud Architect</a>课程旨在高效教授专业云架构师认证所需的技能，即使用Google Cloud技术设计、开发和管理动态解决方案，以推动业务目标。看看您是否具备通过当今最具挑战性和最受欢迎的云计算认证的条件。</p><div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://acloudguru.com/course/infrastructure-as-code-on-gcp-with-deployment-manager"><img loading="lazy" src="../Images/9bd108ab62e831144977b6a33643937f.png" alt="" class="wp-image-41754" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_609/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/IaC-on-GCP-with-Deployment-Manager-Course-from-ACG.png 609w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/IaC-on-GCP-with-Deployment-Manager-Course-from-ACG.png 300w" sizes="(max-width: 609px) 100vw, 609px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/IaC-on-GCP-with-Deployment-Manager-Course-from-ACG.png"/></a><figcaption><em>Explore using Google Cloud Deployment Manager as your tool of choice for orchestrating infrastructure needs on GCP in <a rel="noreferrer noopener" href="https://acloud.guru/learn/iac-on-gcp-with-deployment-manager" target="_blank">t</a><a href="https://acloudguru.com/course/infrastructure-as-code-on-gcp-with-deployment-manager" target="_blank" rel="noreferrer noopener">his course from A Cloud Guru</a>.</em></figcaption></figure></div></div></div>    
</body>
</html>