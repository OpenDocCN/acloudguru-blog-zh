<html>
<head>
<title>How to Develop Serverless Apps with GitHub Codespaces | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用GitHub Codespaces开发无服务器应用</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/how-to-develop-serverless-apps-with-github-codespaces#0001-01-01">https://acloudguru.com/blog/engineering/how-to-develop-serverless-apps-with-github-codespaces#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p><a href="https://github.com/features/codespaces" target="_blank" rel="noreferrer noopener"> GitHub Codespaces </a>是一个在线开发环境，运行在<a href="https://github.com/" target="_blank" rel="noreferrer noopener"> GitHub </a>上，使用Visual Studio代码。我们可以用它100%在云端开发。所以我想看看它能否运行一个混合了<a href="https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> Azure功能</a>和<a href="https://docs.microsoft.com/azure/static-web-apps/?WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> Azure静态Web应用</a> <a href="https://docs.microsoft.com/azure/static-web-apps/?WT.mc_id=acg-blog-alvidela">的项目。</a></p><p>本项目教程将向您展示如何为GitHub代码空间准备好Azure Functions &amp; Static Web App项目。您将了解如何自定义Visual Studio代码启动目标以自动测试您的应用程序，以及如何配置您的项目，以便在您在云端开发时自动安装Visual Studio代码扩展。</p><p>该项目由一个静态Web应用程序和一个图像上传表单组成。图像被直接上传到<a href="https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction?WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> Azure Blob存储器</a>，但是为了工作，它需要接收一个<a href="https://docs.microsoft.com/azure/storage/common/storage-sas-overview?WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> SAS密钥</a>来对Blob容器执行匿名认证。这意味着我们有一个无服务器的后端生成SAS密钥，我们的前端可以通过API调用检索这些密钥。</p><p>你可以在GitHub 上访问这个项目的代码<a href="https://github.com/videlalvaro/upload_image" target="_blank" rel="noreferrer noopener">。</a></p><p>要完成本教程，您需要一个Azure帐户。可以<a href="https://azure.microsoft.com/free/?WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener">免费报名</a>。注册后，您需要创建一个<a href="https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal&amp;WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> Azure存储帐户</a></p><p>我们希望有一个可以在代码空间中运行的开发环境，并且能够支持所有开箱即用的服务，所以让我们列出我们需要的东西:</p><ol><li>我们的项目运行在nodejs上，所以我们需要安装这个依赖项。</li><li>对于Azure Functions，我们需要安装Azure Functions核心工具，并在本地测试它们。</li><li>对于“@azure/storage-blob”依赖，我们需要一个运行的“webpack ”,每当我们做一些更改时，它会自动重建我们项目的JavaScript。</li><li>对于静态Web应用程序，我们希望Visual Studio代码的<a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer&amp;WT.mc_id=acg-blog-alvidela" target="_blank" rel="noreferrer noopener"> Live Server </a>扩展可以让我们在本地预览我们的网站。</li><li>设置项目所需的环境变量。</li></ol><p>让我们看看如何解决这些问题。</p><h2>为代码空间准备项目</h2><p>在幕后，Codespaces运行docker容器，我们的依赖项将安装在那里。幸运的是，Codespaces有一整套现成的容器，我们可以开箱即用。去克隆GitHub上的<a href="https://github.com/microsoft/vscode-dev-containers" target="_blank" rel="noreferrer noopener">/Microsoft/vs code-dev-containers</a>repo。在“containers”文件夹中，我们有“azure-functions-node ”,它已经包含了nodejs依赖项和Azure Functions核心工具依赖项。因此，第1点和第2点将被覆盖。</p><p>要为我们的项目启用该容器，我们需要将“. devcontainer”文件夹从“azure-functions-node”文件夹复制到我们项目的根文件夹中。在该目录中有“Dockerfile”和“devcontainer.json”文件，用于配置我们的代码空间。一旦它被添加，提交给git并推送到GitHub。</p><p>要设置“webpack ”,我们将把这些行添加到“package.json”文件中，以确保依赖项安装在代码空间容器中:</p><pre class="wp-block-code"><code>json
"devDependencies": {
  "webpack": "^4.44.1",
  "webpack-cli": "^3.3.12"
}</code></pre><p>然后在“脚本”下，我们将添加一个自定义脚本来执行名为“构建”的“webpack ”:</p><pre class="wp-block-code"><code>json
"scripts": {
    "start": "func start",
    "test": "echo \"No tests yet...\"",
    "build": "webpack --mode=development"
  },</code></pre><p>然后我们需要告诉VSCode如何开始我们的项目。通常，当我们点击“F5”时，VSCode会启动Azure Functions核心工具，但在这种情况下，我们也需要它来运行webpack构建。让我们编辑`. vscode/tasks.json `文件，在其中添加几个任务。</p><pre class="wp-block-code"><code>json
{
  "type": "shell",
  "label": "npm run webpack",
  "command": "npm run build",
  "dependsOn": "npm install"
},</code></pre><p>此任务将运行我们的webpack build命令，同时依赖于“npm install ”,因此我们确保也运行一个。然后，我们需要编辑“主机启动”任务，这将启动“Azure功能核心工具”。让我们让它依赖于我们的webpack任务:</p><pre class="wp-block-code"><code>json
{
  "type": "func",
  "command": "host start",
  "problemMatcher": "$func-watch",
  "isBackground": true,
  "dependsOn": "npm run webpack"
},</code></pre><p>注意，任务相关性是使用任务“标签”作为标识符来指定的。</p><p>我们赢了五分之三。现在是时候解决服务器直播的问题了。默认情况下，我们需要安装Live Server扩展。为此，让我们打开`. devcontainer/devcontainer.json `配置文件，并编辑` extensions '条目，以包含Live Server扩展的id，(既然我们在这里，让我们添加静态Web Apps扩展):</p><pre class="wp-block-code"><code>json
"extensions": [
	"ms-azuretools.vscode-azurefunctions",
"ms-azuretools.vscode-azurestaticwebapps",
	"dbaeumer.vscode-eslint",
	"ritwickdey.liveserver"
],</code></pre><p>Live Server会让我们在http://localhost:5500下预览或者静态的Web App。在代码空间中，任何指向本地主机的URL都将被端口转发并重定向到重写的URL。为了与Live Server一起工作，我们需要告诉Codespaces转发“5500”端口。在“. devcontainer/devcontainer.json”文件中，我们需要修改“forwardPorts”条目以包含该端口:</p><pre class="wp-block-code"><code>json
"forwardPorts": [ 7071, 5500 ],</code></pre><p>一旦我们进入代码空间，我们将处理第5步。</p><h2>创建您的第一个代码空间</h2><p>我们在前面的步骤中做了所有的更改，现在是时候将您的项目推送到GitHub了。一旦完成，进入<a href="https://github.com/codespaces" target="_blank" rel="noreferrer noopener"> GitHub代码空间</a>并点击“创建你的第一个代码空间”。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/a03eac360c3c9c604e9b4ad675f9d128.png" alt="" class="wp-image-40837" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1554/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png 1554w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png 1536w" sizes="(max-width: 1554px) 100vw, 1554px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.12-PM.png"/></figure><p>然后选择代码空间的项目，以及git分支，并单击create codespace:</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/eab3bf3f452de113543b571348a54e50.png" alt="" class="wp-image-40838" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1555/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png 1555w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png 1536w" sizes="(max-width: 1555px) 100vw, 1555px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.27-PM.png"/></figure><p>一旦代码空间启动并运行，我们就可以进行最后的第五步，即告诉Azure Functions Core Tools如何连接到我们的存储帐户。为此，在项目的根目录下创建一个名为“local.settings.json”的文件。为此，您可以重命名repo已提供的“local.settings.sample.json”文件，并将其命名为“local.settings.json”。在这里，我们可以编辑“AzureWebJobsStorage”密钥，以包含从Azure Portal获得的存储帐户的连接字符串。您可以从运行在代码空间上的Visual Studio代码内部完成所有这些工作！这有多酷多meta？！</p><p>它看起来应该是这样的，但是带有您的实际连接字符串:</p><pre class="wp-block-code"><code>json
{
    "IsEncrypted": false,
    "Values": {
      "AzureWebJobsStorage": "DefaultEndpointsProtocol=https;AccountName=youraccountname;AccountKey=&lt;SecretAccountKey&gt;;EndpointSuffix=core.windows.net",
      "FUNCTIONS_WORKER_RUNTIME": "node"
    }
  }</code></pre><p>一旦完成，就该运行项目了。按“F1 ”,然后键入“用Live Server打开”以启动Live Server实例，这将让我们预览项目的静态Web应用程序端。完成后，按“F5”启动我们项目的Azure功能部分:</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/b427ea8239c75185052c7f2adc1bbc61.png" alt="" class="wp-image-40839" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1551/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png 1551w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png 1536w" sizes="(max-width: 1551px) 100vw, 1551px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.37-PM.png"/></figure><p>在Azure Functions启动我们的后端之后，我们可以继续在浏览器中查看它。在Visual Studio代码侧面板中选择“代码空间”选项卡，以访问转发端口及其各自的URL:</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/fdaad94ba56a16293646d1c797e07431.png" alt="" class="wp-image-40840" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1557/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png 1557w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png 1536w" sizes="(max-width: 1557px) 100vw, 1557px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.47-PM.png"/></figure><p>点击“转发端口”下的“端口:5500”。如果一切顺利，您应该会看到类似这样的内容:</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/0136aa6a38812633f6392d12a68efe66.png" alt="" class="wp-image-40841" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1557/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png 1557w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png 1536w" sizes="(max-width: 1557px) 100vw, 1557px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/10/Screen-Shot-2020-10-13-at-1.19.59-PM.png"/></figure><p>静态Web应用程序运行在我们的代码空间上，由Live Server提供服务，它联系了我们的无服务器应用程序，该应用程序为它提供了SAS密钥，允许我们将文件上传到Azure Web Storage。</p><h2>结论</h2><p>通过这5个步骤，我们可以拥有一个使用Azure静态Web应用程序和Azure函数的项目，准备好使用GitHub Codespaces开箱即用。</p><p>GitHub Codespaces是一个很棒的工具，它让我们在云中拥有一个工作开发环境，而不需要安装任何东西。这将有助于我们简化开发，并在开发过程中与其他开发人员共享我们的应用，使协作变得更加容易。可能性是无限的。就我而言，我对所有在线编程教育感到兴奋，这将由Codespaces实现。</p><h2>后续步骤</h2><h5>关于作者</h5><p>阿尔瓦罗·维德拉是微软的一名开发者拥护者，他组织了DuraznoConf。他是RabbitMQ in Action的合著者，并为计算机器协会撰写文章。你可以在推特上找到他的名字是<a class="" href="https://twitter.com/old_sound"> @old_sound </a> 。</p></div></div>    
</body>
</html>