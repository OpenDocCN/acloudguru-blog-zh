<html>
<head>
<title>System Log Aggregation with the Elastic Stack | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用弹性堆栈的系统日志聚合|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/system-log-aggregation-with-the-elastic-stack#0001-01-01">https://acloudguru.com/blog/engineering/system-log-aggregation-with-the-elastic-stack#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>弹性堆栈可以无限配置，几乎可以用于任何涉及收集、搜索和分析数据的用例。为了使启动和运行变得容易，我们可以使用模块来快速实现预配置的管道。在这个简短的教程中，我们将使用系统模块来收集来自<code>/var/log/secure</code>和<code>/var/log/auth.log</code>的日志事件，然后通过模块在Kibana中创建的仪表板来分析这些日志事件。在这个演示中，我将在<a href="https://acloudguru.com/blog/engineering/system-log-aggregation-with-the-elastic-stack">云专家云操场</a>上使用一个t2.medium EC2实例。如果您不是Linux Academy的订阅者，请随时关注您自己的云服务器或虚拟机。您所需要的只是一台带有1个CPU和4 GB内存的CentOS 7主机。否则，服务器已经为您预先配置好了！</p><div id="attachment_11242" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/Screen-Shot-2018-10-30-at-4.28.20-PM.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-11242" loading="lazy" class="wp-image-11242 size-large" src="../Images/40e0d8279955fed47c4fdd4a6dc724e6.png" alt="Linux Academy Cloud Playground" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2018-10-30-at-4.28.20-p-m-1024x496.png"/><p id="caption-attachment-11242" class="wp-caption-text"/></a><p>Linux学院云游乐场</p></div><h2>弹性搜索</h2><p>首先，我们需要安装Elasticsearch的唯一先决条件，一个Java JDK。我将使用OpenJDK，特别是<code>java-1.8.0-openjdk</code>包:</p><pre>sudo yum install java-1.8.0-openjdk -y</pre><p>现在我们可以安装Elasticsearch了。我将通过RPM进行安装，所以首先让我们导入Elastic的GPG密钥:</p><pre>sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</pre><p>现在我们可以下载并安装Elasticsearch RPM:</p><pre>curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.4.2.rpmsudo rpm --install elasticsearch-6.4.2.rpmsudo systemctl daemon-reload elasticsearch</pre><p>让我们启用Elasticsearch服务，使其在重启后启动，然后启动Elasticsearch:</p><pre>sudo systemctl enable elasticsearchsudo systemctl start elasticsearch</pre><p>由Filebeat系统模块创建的摄取管道使用GeoIP处理器来查找在日志事件中找到的IP地址的地理信息。要做到这一点，我们首先需要将它安装为Elasticsearch的插件:</p><pre>sudo /usr/share/elasticsearch/bin/elasticsearch-plugin install ingest-geoip</pre><p>现在我们需要重新启动Elasticsearch，以便它能够识别新插件:</p><pre>sudo systemctl restart elasticsearch</pre><h2>Kibana</h2><p>我们已经导入了弹性GPG键，所以让我们下载并安装Kibana RPM:</p><pre>curl -O https://artifacts.elastic.co/downloads/kibana/kibana-6.4.2-x86_64.rpm<span class="pln">sudo rpm </span><span class="pun">--</span><span class="pln">install kibana</span><span class="pun">-</span><span class="lit">6.4</span><span class="pun">.</span><span class="lit">2</span><span class="pun">-</span><span class="pln">x86_64</span><span class="pun">.</span><span class="pln">rpm</span></pre><p>现在我们可以启动并启用Kibana服务:</p><pre>sudo systemctl enable kibanasudo systemctl start kibana</pre><p>因为Kibana和Elasticsearch都为单节点部署提供了合理的默认值，所以我们不需要对任何一个服务进行任何配置更改。</p><h2>Filebeat</h2><p>现在我们可以安装将收集我们的日志的客户机Filebeat。同样，因为我们已经导入了弹性GPG键，所以我们可以下载并安装Filebeat RPM:</p><pre class="programlisting prettyprint lang-sh prettyprinted"><span class="pln">curl </span><span class="pun">-</span><span class="pln">O https</span><span class="pun">://</span><span class="pln">artifacts</span><span class="pun">.</span><span class="pln">elastic</span><span class="pun">.</span><span class="pln">co</span><span class="pun">/</span><span class="pln">downloads</span><span class="pun">/</span><span class="pln">beats</span><span class="pun">/</span><span class="pln">filebeat</span><span class="pun">/</span><span class="pln">filebeat<span class="pun">-</span><span class="lit">6.4</span><span class="pun">.</span><span class="lit">2</span><span class="pun">-</span>x86_64<span class="pun">.</span>rpm</span><span class="pln">sudo rpm --install filebeat<span class="pun">-</span><span class="lit">6.4</span><span class="pun">.</span><span class="lit">2</span><span class="pun">-</span>x86_64<span class="pun">.</span>rpm</span></pre><p>我们希望在Elasticsearch中存储带有UTC时间戳的日志事件。这样，Kibana可以简单地从UTC转换到我们的浏览器在请求时间所在的任何时区。为了启用这种转换，让我们取消注释并启用<code>syslog</code>和<code>auth</code>部分的<code>/etc/filebeat/modules.d/system.yml.disabled</code>中的以下变量:</p><pre>var.convert_timezone: true</pre><p>现在我们可以启用系统模块并将模块资产推送到Elasticsearch和Kibana:</p><pre>sudo filebeat modules enable systemsudo filebeat setup</pre><p>最后，我们可以启用并启动Filebeat服务，开始收集系统日志事件:</p><pre>sudo systemctl enable filebeatsudo systemctl start filebeat</pre><h2>分析</h2><p>默认情况下，Kibana监听<code>localhost:5601</code>。因此，为了在我们的本地web浏览器中浏览Kibana，让我们使用SSH通过端口转发登录到我们的主机:</p><pre>ssh username@hostname_or_ip -L 5601:localhost:5601</pre><p>现在，我们可以在本地web浏览器中导航到<code>https://localhost:5601</code>来访问我们的远程Kibana实例。从Kibana的侧面导航窗格中，选择<b>仪表板</b>并搜索“系统”以查看所有系统模块仪表板。更进一步，您可以创建自己的蜜罐，将您的主机暴露在互联网上，以收集更多的日志事件进行分析。</p><div id="attachment_11237" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/Screen-Shot-2018-10-30-at-4.17.10-PM-2.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-11237" loading="lazy" class="wp-image-11237 size-large" src="../Images/4d4857ec06762969295dd0805c188d16.png" alt="Syslog Dashboard" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2018-10-30-at-4.17.10-p-m-2-1024x576.png"/></a><p id="caption-attachment-11237" class="wp-caption-text">系统日志仪表板</p></div><div id="attachment_11238" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/Screen-Shot-2018-10-30-at-4.17.21-PM-2.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-11238" loading="lazy" class="wp-image-11238 size-large" src="../Images/512de3897e38808a352fafb75928c587.png" alt="Sudo Commands Dashboard" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2018-10-30-at-4.17.21-p-m-2-1024x576.png"/></a><p id="caption-attachment-11238" class="wp-caption-text">Sudo命令仪表板</p></div><div id="attachment_11239" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/Screen-Shot-2018-10-30-at-4.17.40-PM-2.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-11239" loading="lazy" class="wp-image-11239 size-large" src="../Images/ad5c783601a81458cbd3c5fd3e5033e5.png" alt="SSH Logins Dashboard" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2018-10-30-at-4.17.40-p-m-2-1024x576.png"/></a><p id="caption-attachment-11239" class="wp-caption-text">SSH登录仪表板</p></div><div id="attachment_11240" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/Screen-Shot-2018-10-30-at-4.17.46-PM-2.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-11240" loading="lazy" class="wp-image-11240 size-large" src="../Images/c9e8ac500b791f2cf9b93e15f1ed1359.png" alt="New Users and Groups Dashboard" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2018-10-30-at-4.17.46-p-m-2-1024x576.png"/></a><p id="caption-attachment-11240" class="wp-caption-text">新用户和组仪表板</p></div><h2>想了解更多？</h2><p>从创建漂亮的可视化效果到管理弹性堆栈，<a href="https://acloudguru.com/course/a-cloud-gurus-elastic-certified-analyst-exam-preparation-course">ki Bana markdown visualization</a>帮助您充分利用您的数据。在云专家<a href="https://linuxacademy.com" target="_blank" rel="nofollow noopener noreferrer">的</a>，我们为弹性产品提供了大量精彩的学习内容。通过弹性堆栈基础课程，简要了解弹性堆栈中的所有产品。或者通过Elasticsearch深潜课程了解弹性堆栈的核心——Elastic search。当你准备好了，通过我们最新的认证准备课程，成为一名弹性认证工程师，证明你对弹性堆栈的掌握。所有这些课程都包含动手实验和课程，您可以使用自己的云专家云服务器来学习。你还在等什么？让我们变得有弹性！</p><div id="attachment_11241" class="wp-caption aligncenter"><a href="https://wpengine.linuxacademy.com/wp-content/uploads/2018/10/elastic_stack.png" target="_blank" rel="nofollow noopener noreferrer"><img aria-describedby="caption-attachment-11241" loading="lazy" class="wp-image-11241 size-large" src="../Images/0da2c6d86dc4d34e42e1afc0b43c2f7e.png" alt="Elastic Stack Ecosystem" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/elastic-stack-1024x512.png"/></a><p id="caption-attachment-11241" class="wp-caption-text">弹性堆栈生态系统</p></div></div></div>    
</body>
</html>