<html>
<head>
<title>AWS Greengrass API Tutorial and Manual | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>AWS Greengrass API教程和手册|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/aws-greengrass-the-missing-manual#0001-01-01">https://acloudguru.com/blog/engineering/aws-greengrass-the-missing-manual#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p id="h-the-greengrass-api-is-a-pile-of-spare-parts-without-wiring-instructions-so-here-s-a-map-an-explanation-and-some-code">Greengrass API是一堆没有接线说明的备件，所以这里有一张地图、一个解释和一些代码:</p><p id="2f59"><a href="https://aws.amazon.com/greengrass/" target="_blank" rel="noreferrer noopener"> AWS Greengrass </a>是一项伟大的技术。如果你正在读这篇文章，你可能也已经这样想了。如果你没有——看看<a href="https://youtu.be/1IxDLeFQKPk?t=2h33m35s%20or%20https://www.youtube.com/watch?v=4JuyF2zwFp0" target="_blank" rel="noreferrer noopener"> re:Invent keynote </a>和<a href="https://www.youtube.com/watch?v=1rLxPOxVJoQ" target="_blank" rel="noreferrer noopener">AWS green grass introduction</a>，你会被说服并受到启发去做黑客。</p><p id="55d4">要掌握教程之外的Greengrass，以自动化、可靠、可重复的方式定义和部署设置，必须使用AWS API或CLI——我们长期生活在光明的DevOps世界中。</p><p id="e84b">这里有一个大问题:虽然Greengrass上的AWS文档列出了各个呼叫，但它没有给出从哪里开始的线索。没有地图显示如何将电话连接在一起。所有零件都在适当的位置，但是装配手册不见了。或者，<em>是</em>失踪的——直到这篇帖子。</p><h2 id="1bb6">AWS Greengrass入门</h2><p id="09d7">我将从高层次开始:概念定义，模型图，一些关于事物如何工作的理论…但是我的千禧一代读者渴望通过实践来学习，所以让我们从一些工作代码开始。别担心，你仍然可以找到下面的地图和概念。</p><p id="cced">这是创建具有单个核心的Greengrass组的代码。</p>  <blockquote class="wp-block-quote"><p>作为奖励，为了您的方便和即时满足，请将此代码记录在<a href="https://github.com/dzimine/greengo/blob/master/misc/greengrass_create_core.ipynb" target="_blank" rel="noreferrer noopener"> Jupyter笔记本</a>中！</p></blockquote><p id="14e3">当你点击AWS控制台中的一个“创建组”按钮来创建<em> Greengrass Core，</em>下面提供的代码是场景中发生的事情。相当多…跨3个AWS服务的7个调用— 5个显式创建的实体，2个隐式创建的实体。</p><p id="4da7">创建群组只是开始，您还需要:</p><ul><li>用AWS Lambda创建Lambda函数</li><li>通过Lambda定义将它们注册到IoT</li><li>为您的Lambdas定义要访问的资源</li><li>配置记录器和注册设备</li><li>为每个点对点通信设置MQTT订阅</li><li>将整个shebang部署到绿草核心</li></ul><p id="7721">顺便说一下，所有这些都必须正确安装和配置，携带正确的证书，并在您的边缘设备上运行。如果听起来有点复杂，那是因为它<em>是</em>有点复杂。是时候提升概念和定位了。</p><h3 id="2f6e">AWS Greengrass操作流程</h3><p id="c2d0">首先，让我们回顾一下绿草运营生命周期工作流程的步骤。</p><ol><li><strong>在AWS IoT中创建Greengrass组定义</strong> —多次调用AWS API来创建和连接所有必要的实体。</li><li><strong>设置green grass core“on the edge”</strong>—配置一个box Raspberry Pi或其他<a href="https://aws.amazon.com/greengrass/faqs/#Greengrass_Core_Platform_Compatibility" target="_blank" rel="noreferrer noopener">兼容设备</a>，或用于开发&amp;测试的VM / Docker。下载并安装正确版本的greengrass，放置证书，调整“config.json ”,并启动Greengrass守护程序。</li><li><strong>部署</strong> —告诉AWS将Greengrass组定义推送到Greengrass核心运行时。</li><li><strong>清理</strong> —步骤1-3会产生一系列工件，如果不正确回收，会污染您的AWS帐户。</li></ol><h3 id="ad8d"><strong> AWS温室模型</strong></h3><p id="96a7">接下来我们来了解一下模型。到目前为止，组定义(上面的步骤1)是最复杂的。为了帮助你导航，我创建了一个“绿草实体地图”。虽然地图不是AWS API的拓扑精确表示，但它会帮助您掌握模型，不会迷路。</p><p id="28f6">Greengrass与其他AWS服务交织在一起，最明显的是IoT、Lambda和IAM &amp; security，它们在地图上以颜色编码。看一下地图。找出上面代码创建的对象。探索其余部分。尽情享受吧！</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/061574ade947d135a7974080f1808ff1.png" alt="aws greengrass entities" class="wp-image-41826" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_HlRxVIZnld5EWNxi7rsnjg.png"/><figcaption>Please help make this map better — report <em>errors and omissions on the map </em><a href="https://github.com/dzimine/aws-greengrass-map/issues" target="_blank" rel="noreferrer noopener"><em>here</em></a><em>.</em></figcaption></figure><blockquote class="wp-block-quote"><p>为了减少混乱，LoggerDefinition和ResourceDefinition块没有显示在地图上，因为它们相对简单，所以您可以在看到模式后进行推断。</p></blockquote><p id="b0b2">绿草在概念上是AWS物联网的一部分，在视觉上是AWS控制台中物联网的一个板块。但在API级别，它是一种具有不同模型的独立服务——在概念、约定甚至命名方面都与物联网截然不同。</p><h2 id="4339">AWS Greengrass实体</h2><p id="0d93">在Greengrass中，每个实体都是有版本的，不可变的。任何修改都是通过用新创建的版本更新实体来完成的。版本包含所有数据和对其他AWS服务的引用。</p><h3 id="h-group-version">群组版本</h3><p id="c7e9"><strong>团版<br/> </strong>模特的焦点是<em>团版</em>。只有在创建了<em>组版本</em>后，AWS控制台中才会显示组清单。但是要创建一个<em>组版本</em>，你必须首先创建<a href="http://boto3.readthedocs.io/en/latest/reference/services/greengrass.html#Greengrass.Client.create_group_version" target="_blank" rel="noreferrer noopener">一些其他实体</a>并提供给<code><a href="http://boto3.readthedocs.io/en/latest/reference/services/greengrass.html#Greengrass.Client.create_group_version" target="_blank" rel="noreferrer noopener">create_group_version</a></code>调用。</p><h3 id="h-greengrass-core">绿草芯</h3><p id="13d0"><strong>green grass Core<br/></strong><em>green grass Core</em>具有双重性:在物联网端，它作为一个“<em>东西</em>”，或用于连接和通信的“设备”，在<a href="https://docs.aws.amazon.com/iot/latest/developerguide/thing-registry.html" target="_blank" rel="noreferrer noopener">物联网注册表</a>中由物联网“<em>东西</em>”表示，并附带证书、角色和策略。在Greengrass端，它被公开为一个<em> CoreDefinition/Version </em>。</p><h3 id="h-lambda-functions-and-greengrass">λ函数和绿草</h3><p id="5a8d"><strong> Lambda函数<br/> </strong> Lambda函数首先在AWS Lambda中创建，通过<em>function definition/Version</em>链接到Greengrass。它还添加了一些额外的特定于Greengrass的Lambda参数——比如让Lambda长期运行的<code>pinned</code>标志、设备访问策略或额外的环境变量。</p><p id="d730">要被链接，Lambdas必须被发布，并由一个<a href="https://docs.aws.amazon.com/lambda/latest/dg/versioning-intro.html" target="_blank" rel="noreferrer noopener">合格的ARN </a>推荐——一个有版本或别名的ARN(推荐)。我希望AWS API doc告诉我这一点——没有，如果您提供一个不合格的ARN作为<code>FunctionArn</code>，API会抛出一个令人费解的“函数定义无效或损坏”消息。</p><h3 id="h-greengrass-subscriptions">绿草订阅</h3><p id="5cf1"><strong>订阅<br/> </strong> <em>订阅</em>简单明了，但太冗长，难以定义:我觉得这很烦人，因为要用一堆订阅来定义设备、lambdas和云之间的所有通信。怎么处理？参见下面的“基于文件的Greengrass设置方法”。</p><h3 id="h-aws-iot-greenhouse-device-definition">AWS物联网温室设备定义</h3><p id="3350"><strong>设备定义<br/> </strong> <em>设备定义</em>将连接到核心的设备表示为物联网事物的链接——这些事物必须在AWS物联网中设置。考虑使用ELF为您的开发环境快速模拟一个设备。<em> Logger定义</em>告诉Greengrass core本地记录什么，发送什么到CloudWatch。<em>资源定义</em>用于定义集团范围内对Greengrass核心设备资源的Lambda访问，附属于Lambda <em>功能定义。</em></p><blockquote class="wp-block-quote"><p>哦，你有没有注意到Greengrass AWS控制台中的机器学习资源，现在<a href="https://www.youtube.com/watch?v=EiQ8kqnAkno" target="_blank" rel="noreferrer noopener"> AWS ML推理已经普遍可用了？</a></p></blockquote><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/ae67a92a405cbffecc40b881195c16d3.png" alt="" class="wp-image-41825" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_7STCaWc-YF-unpeoRQRTiQ.png"/></figure><p id="f711">关于地图已经说得够多了:探索它，跟踪并找到相应的AWS API调用来创建和连接实体。我考虑过在地图上标出确切的方法，但决定偏向美学，给你留下一些空间和发现的乐趣。</p><h2 id="ff96">部署AWS Greengrass</h2><p id="d81a">最后，谈谈基于文件的Greengrass部署方法。当我玩Greengrass时，我想要——但错过了——我习惯于享受Ansible、Terraform或无服务器框架的三样东西:</p><ol><li>基于文件的Greengrass组定义</li><li>创建、部署和清理的一个命令</li><li>简单、可表示、可重复的开发样板，带有虚拟机上的Greengrass核心(Docker？甚至更好！)</li></ol><p id="7ea9">我错过了，所以我写了一个。有请<a href="https://github.com/dzimine/greengo" target="_blank" rel="noreferrer noopener"><strong>greengo</strong></a>——一个简单的基于文件的Greengrass配置工具。</p><p id="7728">把它作为你的Greengrass dev样板文件——根据你的喜好调整<code>greengo.yaml</code>,然后点击<code>greengo create</code>。或者使用is作为一个备忘单，找出如何用正确的参数以正确的顺序调用正确的boto3方法，就像您在上面的地图上跟踪链一样。</p><p id="b913"><strong>就这样。</strong>我希望上面的地图、代码示例、解释和greengo工具/备忘单能够填补AWS文档中的空白，并帮助您以自动化、可重复的方式、DevOps风格操作Greengrass。</p><p id="eef1">绿草如茵快乐！</p><h2 id="h-want-more-cloud-goodness-check-these-out">想要更多的云好吗？看看这些:</h2><hr class="wp-block-separator"/><p class="has-text-align-center"><em>想要扩展您的云技能和知识吗？查看云计算专家的云计算课程、实验室和学习途径！</em></p><hr class="wp-block-separator"/><p>如果你觉得这本手册有用或有趣，我会为你鼓掌👏给小费。请在这里的评论里分享你的想法，或者在Twitter上关注我<a href="https://twitter.com/dzimine"/><em/><a href="https://twitter.com/dzimine" target="_blank" rel="noreferrer noopener"><em>@ dz亚胺</em> </a> <em>关于IoT、DevOps、Serverless的讨论和故事。</em></p></div></div>    
</body>
</html>