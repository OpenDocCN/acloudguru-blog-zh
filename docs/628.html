<html>
<head>
<title>The Ultimate Terraform Command Line Cheat Sheet | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>终极Terraform命令行备忘单|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/the-ultimate-terraform-cheatsheet#0001-01-01">https://acloudguru.com/blog/engineering/the-ultimate-terraform-cheatsheet#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>没有必要从Terraform恐惧地跑。关闭搜索引擎标签，查看我们的终极版<a rel="noreferrer noopener" href="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-from-ACG.pdf" target="_blank"> Terraform备忘单</a>,获取您手头需要的所有基本命令，以便从这个令人敬畏的、直观的IaC工具中获得最大收益。另外，为什么不通过<a href="https://acloudguru.com/course/hashicorp-certified-terraform-associate"> Terraform认证</a>来展示你的IaC技能呢。</p><p>在云专家那里，我们有关于Terraform的深入课程——从使用Terraform的<a href="https://acloud.guru/overview/8a6f598f-a41f-48ff-99a6-2c7a760b4119" target="_blank" rel="noreferrer noopener">部署到</a><a href="https://acloudguru.com/course/deploying-to-aws-with-terraform-and-ansible" target="_blank" rel="noreferrer noopener">AWS</a>到使用Terraform的<a href="https://acloudguru.com/course/deploying-resources-to-gcp-with-terraform" target="_blank" rel="noreferrer noopener">部署资源到GCP</a>和使用Terraform在Azure中创建基础设施的<a href="https://acloudguru.com/course/build-and-deploy-pipelines-with-microsoft-azure" target="_blank" rel="noreferrer noopener">。但有时你需要的只是一个简单、方便的参考来完成工作。我们会掩护你的。</a></p><h3 id="table-of-contents">目录</h3><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-accelerate-your-career">加速您的职业发展</h2><p class="has-text-align-center"><a href="https://acloudguru.com/pricing">从ACG开始</a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室改变你的职业生涯。</p><p>什么是Terraform？</p><hr class="wp-block-separator"/><h2 id="h-what-is-terraform">基础设施即代码(IaC)是平衡的云早餐的关键部分。说到IaC工具，Terraform是最棒的工具之一。(哪款IaC工具适合你？查看AWS上的IaC指南。)</h2><p>Terraform于2014年登场，将基础设施编排为代码。它最初的目标是AWS，但已经发展到可以很好地与模块的<a href="https://registry.terraform.io/" target="_blank" rel="noreferrer noopener">大型生态系统合作，包括谷歌云平台(GCP)、微软Azure、甲骨文云基础设施和阿里云。事实上，多提供商支持是Terraform的主要卖点之一。</a></p><p>Terraform推出了自己的DSL，叫做<a href="https://github.com/hashicorp/hcl" target="_blank" rel="noreferrer noopener"> Hashicorp配置语言</a> (HCL)。从表面上看，它更像是一个对人类友好的JSON，在Terraform中也有原生支持。</p><p>Terraform introduced its own DSL, called <a href="https://github.com/hashicorp/hcl" target="_blank" rel="noreferrer noopener">Hashicorp Configuration Language</a> (HCL). On the surface, it feels like a more human-friendly JSON, which is also natively supported within Terraform.</p><p>HCL是一种强大的配置语言，有助于将Terraform发挥到极致！</p><hr class="wp-block-separator"/><p class="has-text-align-center"><em>想了解更多关于<a href="https://acloudguru.com/hands-on-labs/formatting-a-packer-template-in-hcl2"> HCL2 </a>的信息？通过我们的动手实验修复一个编写不准确的HCL2打包模板来测试您的HCL2技能！</em></p><p class="has-text-align-center">Terraform命令行</p><hr class="wp-block-separator"/><h2 id="h-terraform-command-lines"><strong> <u>地形CLI招数</u> </strong></h2><p><strong><code>terraform -install-autocomplete</code></strong>#设置标签自动完成，需要重新登录</p><ul><li><strong> <u>格式化并验证地形代码</u> </strong></li></ul><p><strong><code>terraform fmt</code></strong>#格式代码符合HCL规范标准</p><ul><li><strong><code>terraform validate</code></strong>#验证代码的语法</li><li><strong><code>terraform validate -backend=false</code></strong>#验证代码跳过后端验证</li><li><strong> <u>初始化你的Terraform工作目录</u> </strong></li></ul><p><code><strong>terraform init</strong> </code>#初始化目录，下拉提供者</p><ul><li><strong><code>terraform init -get-plugins=false</code></strong>#初始化目录，不下载插件</li><li><strong><code>terraform init -verify-plugins=false</code></strong>#初始化目录，不验证插件是否为哈希公司签名</li><li><strong> <u>规划、部署和清理基础设施</u> </strong></li></ul><p><strong><code>terraform apply --auto-approve</code></strong>#应用更改而不提示输入“是”</p><ul type="1"><li><strong><code>terraform destroy --auto-approve</code></strong>#不提示“是”就销毁/清理部署</li><li><strong><code>terraform plan -out plan.out</code></strong>#输出部署计划到plan.out</li><li><strong><code>terraform apply plan.out</code></strong>#使用plan.out计划文件部署基础设施</li><li><strong><code>terraform plan -destroy</code></strong>#输出一个摧毁计划</li><li><strong><code>terraform apply -target=aws_instance.my_ec2</code></strong>#仅应用/部署对目标资源的更改</li><li><strong><code>terraform apply -var my_region_variable=us-east-1</code></strong>#应用配置时通过命令行传递变量</li><li><strong><code>terraform apply -lock=true</code></strong>#锁定状态文件，使其不能被任何其他Terraform应用或修改操作修改(仅当后端允许锁定时才可能)</li><li><strong> <code>terraform apply refresh=false</code> </strong> #不要使状态文件与现实世界的资源一致(对于大型复杂部署有助于节省部署时间)</li><li><strong><code>terraform apply --parallelism=5</code></strong>#同时进行资源操作的数量</li><li><strong><code>terraform refresh</code></strong>#将Terraform状态文件中的状态与现实世界的资源相协调</li><li><strong><code>terraform providers</code></strong>#获取当前配置中使用的提供商的信息</li><li><strong> <u>地形工作区</u> </strong></li></ul><p><strong><code>terraform workspace new mynewworkspace</code></strong>#创建新工作区</p><ul type="1"><li><strong><code>terraform workspace select default</code></strong>#改变到选中的工作区</li><li><strong><code>terraform workspace list</code></strong>#列出所有工作区</li><li><strong> <u>地形状态操纵</u> </strong></li></ul><p><strong><code>terraform state show aws_instance.my_ec2</code></strong>#显示以地形状态存储的资源详细信息</p><ul type="1"><li><strong><code>terraform state pull &gt; terraform.tfstate</code></strong>#下载并输出地形状态到文件</li><li><strong><code>terraform state mv aws_iam_role.my_ssm_role module.custom_module</code></strong>#将通过状态跟踪的资源移动到不同的模块</li><li><strong><code>terraform state replace-provider hashicorp/aws registry.custom.com/aws</code></strong>#用其他提供商替换现有提供商</li><li><strong><code>terraform state list</code></strong>#列出通过当前状态文件跟踪的所有资源</li><li><strong><code>terraform state rm  aws_instance.myinstace</code></strong>#取消资源管理，将其从Terraform状态文件中删除</li><li><strong> <u>地形导入和输出</u> </strong></li></ul><p><strong><code>terraform import aws_instance.new_ec2_instance i-abcd1234</code></strong>#将id为i-abcd1234的EC2实例导入到类型为“aws_instance”的名为“new_ec2_instance”的Terraform资源中</p><ul type="1"><li><strong><code>terraform import 'aws_instance.new_ec2_instance[0]' i-abcd1234</code></strong>#同上，将真实世界的资源导入到Terraform资源的实例中</li><li><strong><code>terraform output</code></strong>#列出代码中规定的所有输出</li><li><strong> <code>terraform output instance_public_ip</code> </strong> #列出一个具体申报的产量</li><li>以JSON格式列出所有输出</li><li><strong><u/></strong></li></ul><p><strong><code>terraform version</code></strong>#显示Terraform二进制版本，如果版本太旧也会发出警告</p><ul type="1"><li><strong><code>terraform get -update=true</code></strong>#下载并更新“root”模块中的模块。</li><li><strong> <u> Terraform控制台(测试Terraform插值)</u> </strong></li></ul><p><strong><code>echo 'join(",",["foo","bar"])' | terraform console</code></strong>#将一个表达式回显到terraform控制台，并将其预期结果作为输出</p><ul type="1"><li><strong> <code>echo '1 + 5' | terraform console</code> </strong> #Terraform控制台也有一个交互式CLI只要进入“Terraform控制台”</li><li><strong><code>echo "aws_instance.my_ec2.public_ip" | terraform console</code></strong>#显示Terraform状态文件中看到的“my _ ec2”terra form资源的公共IP</li><li><strong> <u>【地形图(从属图形)</u> </strong></li></ul><p><strong><code>terraform graph | dot -Tpng &gt; graph.png</code></strong>#生成一个PNG图表，显示配置/代码中Terraform资源之间的关系和依赖关系</p><ul type="1"><li><strong><u>【terra form tain/un tain】(标记/取消标记资源以便重新创建- &gt;删除然后重新创建)</u> </strong></li></ul><p><strong><code>terraform taint aws_instance.my_ec2</code></strong>#污染下次应用时要重新创建的资源</p><ul type="1"><li><strong><code>terraform untaint aws_instance.my_ec2</code></strong>#清除资源中的污点</li><li><code><strong>terraform force-unlock LOCK_ID</strong> </code>#强制解锁一个锁定的状态文件，预先锁定状态文件时提供的LOCK_ID</li><li><strong> <u>地形云</u> </strong></li></ul><p><strong><code>terraform login</code></strong>#获取并保存地形云的API令牌</p><ul type="1"><li><strong><code>terraform logout</code></strong>#注销Terraform云，默认为主机名app.terraform.io</li><li>10个最有用的地形命令</li></ul><figure class="wp-block-image size-full"><a href="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-from-ACG.pdf"><img loading="lazy" src="../Images/08127ff394aa8bcb664fc80d125d6a62.png" alt="The ACG Terraform Commands Cheatsheet" class="wp-image-42186" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1053/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 1053w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_123/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 123w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_421/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 421w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_632/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 632w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_843/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg 843w" sizes="(max-width: 1053px) 100vw, 1053px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/11/terraform-cheatsheet-scaled.jpg"/></a></figure><h2 id="h-the-10-most-useful-terraform-commands">使用Terraform的一个关键部分是通过了解配置来学习使用Terraform CLI。</h2><p>以下是AWS CLI中10个最常见的Terraform命令，可帮助您导航和使用功能强大的工具，并从Terraform开始。</p><p>因此，如果您已经安装了Terraform二进制文件，并准备好开始工作，现在是熟悉您将最常用的Terraform命令的好时机。</p><p> </p><figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><p class="wp-block-embed__wrapper">当您需要快速参考指南时，您可以随时调出Terraform的内置命令行文档。有几个命令可以做到这一点:</p></figure><p><code>terraform</code></p><ul><li><code>terraform -h</code></li><li><code>terraform --help</code></li><li>生成的帮助页面将在顶部显示主要命令，下面是不常用或更复杂的命令。</li></ul><p>您也可以输入terraform命令，然后输入带有<code>-h</code>或<code>--help</code>的子命令，以调出特定于该子命令的命令列表。让我们来演练一下你可能会用到最多的10个Terraform命令。</p><p><strong> 1。<code>fmt</code> </strong> <br/>当我完成我的Terraform配置后，我想确保所有东西都被正确格式化，所以我首先运行<code>fmt</code>命令。此命令以标准样式重新格式化您的配置，因此它将确保间距和其他所有内容的格式正确。如果它返回空白，这意味着工作目录中的配置文件已经被正确格式化。如果它格式化了一个文件，它会让你知道它接触了什么文件。</p><p><strong> 2。<code>init</code> </strong> <br/>使用<code>format</code>命令后，你需要初始化你的工作目录，为你所需要的做准备。<code>init</code>命令查看您的配置文件，并确定需要从注册表中删除哪些提供程序和模块，以使您的配置正常工作。</p><p><strong> 3。<code>validate</code> </strong> <br/>一旦初始化了目录，最好在运行<code>plan</code>或<code>apply</code>之前运行<code>validate</code>命令。验证将捕捉语法错误、版本错误和其他问题。这里需要注意的一点是，在运行<code>init</code>命令之前，不能运行<code>validate</code>。在运行验证之前，您必须初始化工作目录。</p><p><strong> 4。<code>plan</code> </strong> <br/>接下来，对你的计划做一次预演，看看它实际上会做什么，这总是一个好主意。您甚至可以使用带有<code>terraform plan</code>的子命令之一来输出您的计划，以便稍后应用。</p><p>5 <strong>。<code>apply</code> </strong> <br/>当然还有<code>apply</code>命令，这也是你最常使用的命令之一。这是将您的配置部署或应用到提供程序的命令。</p><p><strong> 6。<code>destroy</code></strong><br/><code>destroy</code>命令显然会破坏您的基础设施——或者，当与<code>target</code>标志一起使用时，会破坏您的基础设施中的单个资源。</p><p><strong> 7。<code>output</code> </strong> <br/>如果你已经准备好了一个输出变量文件，你可以使用<code>output</code>命令让那些定义好的输出显示某些信息。例如，如果您正在部署EC2实例，您可以输出标记名、实例名、实例id、实例的IP等等。您可以收集一些非常有用的信息，以便以后查找。如果你们是团队合作，后面的人可以使用<code>output</code>命令来解决问题并加快速度。</p><p><strong> 8。<code>show</code></strong><br/><code>show</code>命令显示已保存计划的当前状态，提供关于您已部署的基础设施的良好信息。例如，如果您的配置中部署了EC2实例或虚拟机，它会向您显示其所处的状态——是启动并准备就绪，还是正在终止。它还提供有用的信息，如IP地址。</p><p><strong> 9。<code>state</code> </strong> <br/>检查工作的另一个好方法是使用<code>state</code>命令。如果您使用<code>state</code>，然后使用子命令<code>list</code>，它会给您一个由您的配置管理的资源的综合列表。如果您正在移动您的Terraform实例，比如从本地实例到远程备份，您将使用<code>state mv</code>命令。就像<code>show</code>命令一样，有一个<code>state show</code>命令显示资源的状态。您也可以使用<code>state rm</code>命令从一个状态中删除实例。</p><p><strong> 10。<code>version</code> </strong> <br/>你会经常使用<code>version</code>命令来检查你的地形版本，尤其是当你有任何版本冲突的时候。有时，提供者只处理特定版本的Terraform，所以如果你在配置中定义这些版本，你需要到处使用<code>version</code>命令。<br/></p><p>这些是一些最流行的地形命令。请记住，当你不能100%确定如何使用一个命令或它有什么作用时，<code>-h</code>是快速查找命令的一个非常方便的方法，尤其是当你开始使用的时候。有机会看一看吧！</p><p>Jesse Hoch和Moosa Khalid对此文亦有贡献。</p><p class="has-text-align-left">学习地形的基础知识</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-learn-the-basics-of-terraform"><em>想了解更多关于充分利用Terraform的信息吗？查看ACG的课程<a href="https://acloudguru.com/course/deploying-to-aws-with-terraform-and-ansible" target="_blank" rel="noreferrer noopener">使用Terraform和Ansible </a>部署到AWS。</em></h2><p class="has-text-align-center"><em>Want to learn more about getting the most out of Terraform? Check out ACG’s course <a href="https://acloudguru.com/course/deploying-to-aws-with-terraform-and-ansible" target="_blank" rel="noreferrer noopener">Deploying to AWS with Terraform and Ansible</a>.</em></p></div></div>    
</body>
</html>