<html>
<head>
<title>How to Keep Your AWS Lambda Functions Warm | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何让您的AWS Lambda功能保持温暖|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/how-to-keep-your-lambda-functions-warm#0001-01-01">https://acloudguru.com/blog/engineering/how-to-keep-your-lambda-functions-warm#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p id="h-use-cloudwatch-timers-to-thaw-functions-and-help-reduce-response-times-from-3-seconds-to-a-couple-hundred-milliseconds"><em>了解如何安排CloudWatch事件规则来解冻AWS Lambda函数，并帮助将响应时间从3秒减少到几百毫秒。</em></p><hr class="wp-block-separator"/><p class="has-text-align-center" id="h-your-keys-to-a-better-career"><strong>通往更好职业的钥匙</strong></p><p class="has-text-align-center"><a href="https://acloudguru.com/pricing">立即开始ACG </a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室来改变你的职业生涯。</p><hr class="wp-block-separator"/><p>使用无服务器架构有很多优点，有数百篇优秀的文章赞美它的优点，但一个令人痛苦的缺点是不常用的无服务器功能的响应时间通常很慢。</p><p id="580a">这是因为，有时，创建函数的容器不会被重用。因此，对于某些请求，AWS需要在处理请求之前用您的代码重新提供一个容器。</p><p id="eadf">对于后台任务，这显然不是问题。但是，如果你有一个由用户输入触发的任务，并且在收到响应之前阻止你的应用程序，那么这个函数必须是热的，这样你的响应时间可以是几百毫秒，而不是3秒。</p><p id="d2c9">另一方面，有时您的代码只是冻结在一个容器中，在处理新的请求之前可以“解冻”,这只需要几毫秒。</p><p id="21d2">理想情况下，AWS会有一个类似“保持温暖”的选项，您可以切换并同意支付更多费用来让AWS让未使用的容器一直运行。唉，这还没有(还没有？)已经实现，所以我们的下一个最佳选择是使用CloudWatch计时器。</p><p>那么如何才能让我们的AWS Lambda函数保持温暖呢？正如在<a href="https://stackoverflow.com/questions/42877521/is-it-possible-to-keep-an-aws-lambda-function-warm?noredirect=1#comment72860693_42877521" target="_blank" rel="noreferrer noopener">栈溢出</a>中所建议的，你需要每5-15分钟ping你的Lambda函数来保持它们的热度。这比你想象的要容易。</p><h2 id="2a4f">1.创建Amazon CloudWatch事件规则</h2><p id="3f5f">首先，打开AWS控制台(是的，<a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html" target="_blank" rel="noreferrer noopener">有一种方法可以通过CLI </a>做到这一点)，然后进入<a href="https://acloudguru.com/hands-on-labs/using-cloudwatch-for-resource-monitoring"> CloudWatch </a>。从那里，转到<code>Events</code>并点击<code>Create rule</code>。将事件类型设置为<code>Schedule</code>，每1分钟运行一次该事件。</p><p>然后从<code>Targets</code>列表中选择您想要的Lambda函数并保存。然后，您需要创建一个名称和描述。</p><p id="1180">就是这样！你现在每1分钟检测一次Lambda函数。</p><h2 id="317f">2.测试Amazon CloudWatch事件规则</h2><p id="b0c7">为了测试我们的计时器是否真的让函数保持活动，我们将创建一个函数，在全局范围内(在单个函数之外)将惟一的<code>awsRequestId</code>存储在一个名为<code>containerID</code>的变量中。</p>  <p>从技术上讲，这不是容器的ID，但它会告诉我们一个容器是否被后续请求重用，因为我们只在尚未定义值的情况下写入它。</p><p id="0fb1">在部署这个函数、设置一个计时器并等待一段时间后，您可以检查您的CloudWatch日志，您会看到<code>containerID</code>在请求之间持续存在，这告诉我们，如果调用之间的间隔少于1分钟，AWS会保持函数的热度。</p><p id="10e0">所以为了科学起见，我继续为1-15分钟，以及30、45和60分钟的间隔设置了间隔计时器。这应该让我们知道AWS能让这些容器保温多长时间。</p><h2 id="1394">3.检查结果</h2><p id="3bf9">快进8小时，我们就有结果了。我希望结果足够有趣，可以创建一个漂亮的图表，但是相反，我发现所有函数都是这种模式。</p><p id="87e9">基本上，所有Lambda函数在实验期间都保持温暖，除了在世界协调时14:00左右的某个时候，AWS决定重置所有容器，而不管它最近是否被使用过。</p><p id="6968">即使是1小时的ping也连续几个小时使用同一个容器。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/6a2056afeccdc9268f48ec9d3b5af053.png" alt="Logs showing the 1-hour ping continuing to use the same container for several hours in a row." class="wp-image-42074" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_hV12Z5-QCTABnxx9EF3jjg.png"/><figcaption>These requests were 1 hour apart, but still used the same container.</figcaption></figure></div><p id="cd70">所以看起来(至少从这个实验来看)脉冲的频率并不那么重要…</p><p id="0351">无论哪种方式，每15分钟左右ping一次仍然几乎不花什么钱，所以没有理由吝啬你的CloudWatch定时器。</p><hr class="wp-block-separator is-style-wide"/><h2 class="has-text-align-center" id="h-get-the-skills-you-need-for-a-better-career">获得更好职业所需的技能。</h2><p class="has-text-align-center">掌握现代技术技能，获得认证，提升您的职业生涯。无论您是新手还是经验丰富的专业人士，您都可以通过实践来学习，并在ACG的帮助下推进您的云计算职业生涯。</p><hr class="wp-block-separator is-style-wide"/><p>Sam Corcos是CarDash   <em>的联合创始人，这是一家全方位的汽车礼宾服务提供商，消除了汽车服务、护理和维护的麻烦。他也是</em> <a href="http://learnphoenix.io/" target="_blank" rel="noreferrer noopener"> <em>学凤凰</em> </a> <em>的作者，以及</em> <a href="http://sightlinemaps.com/" target="_blank" rel="noreferrer noopener"> <em>视线图</em> </a> <em>的创始人。</em></p></div></div>    
</body>
</html>