<html>
<head>
<title>Scaling Data Analytics with AWS Data Pipeline and Athena | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>借助AWS数据管道和Athena |云专家扩展数据分析</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/affordable-and-scalable-data-analytics-on-amazon-web-services-using-athena-and-data-pipeline#0001-01-01">https://acloudguru.com/blog/engineering/affordable-and-scalable-data-analytics-on-amazon-web-services-using-athena-and-data-pipeline#0001-01-01</a></blockquote><div><div class="elementor-full-height elementor-element elementor-element-8a920a5 elementor-widget elementor-widget-theme-post-content" data-id="8a920a5" data-element_type="widget" data-widget_type="theme-post-content.default"><div class="elementor-widget-container"><p id="66f3">如果你正在使用亚马逊网络服务，或者只是在某种程度上关注他们的服务产品，你不能错过他们最新推出的分析服务。这是一个非常符合<a href="https://acloudguru.com/blog/engineering/whats-this-serverless-thing-anyway">最近无服务器云计算</a>趋势的工具。本质上只是计算，而不必自己分配基于云的资源。</p><h2 id="h-what-is-aws-athena">AWS雅典娜是什么？</h2><p id="5078">AWS Athena与Google的<a href="https://cloud.google.com/bigquery/" target="_blank" rel="noreferrer noopener"> BigQuery </a>一样，是一个无服务器的工具，用于查询大数据集，而无需设置物理或虚拟机集群。在AWS领域，比较公平的说法是，Athena对于EMR就像Lambda对于EC2一样。</p><p id="5078">您有很多限制，只能执行非无服务器选项所能执行的部分任务。但是一旦你真的考虑到这些限制，你就可以构建一些以非常低的价格交付结果的东西。</p><h2 id="h-athena-at-work">雅典娜在工作</h2><p id="601f">我们决定将我们为立法者意识形态所做的一些计算移植到我们对Athena的应用中，目标是能够更好地扩展和削减成本。</p><p id="h-statehill-uses-aws-to-measure-the-government-s-impact-into-actionable-intelligence-to-help-your-ability-to-advocate-effectively">Statehill使用AWS来衡量政府的影响，并将其转化为可操作的情报，以帮助您有效地进行宣传</p><blockquote class="wp-block-quote"><p><a href="https://statehill.com/product/"> Statehill将世界各地的立法数据联系起来，以发现</a>，分析和衡量政府对你的影响。我们首先收集立法信息并将其组织成可操作的情报，以提高您有效倡导的能力。</p></blockquote><p id="4b58">从本质上说，我们正在做的是获取历史投票记录，并确定立法者在一些类别上倾向于共和党还是民主党。我们目前正在美国多个州开展这项工作，包括蒙大拿州、T2、得克萨斯州和威斯康星州。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/f7d4f0a5dd7b03bd7ea6978bf7cd5494.png" alt="AWS Athena being used to measure the governments impact into actionable intelligence." class="wp-image-41742" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2017/02/1_lfJOLZkk705nDtn0OAZekA.png"/><figcaption>Ideology for Alan Redfield (R), Montana legislator in the 65th session</figcaption></figure></div><hr class="wp-block-separator"/><p class="has-text-align-center"><em>对升级或开始云数据之旅感兴趣吗？云专家的<a href="https://acloudguru.com/learning-paths/aws-data"> AWS数据学习路径</a>提供适合初学者和高级专家的定制课程！</em></p><hr class="wp-block-separator"/><h2 id="h-how-to-move-data-to-aws-data-pipeline">如何将数据移动到AWS数据管道</h2><p>首先，我们必须得出结论，我们可以只用SQL来完成这项任务，因为这就是你查询Athena的方式。一旦我们确定了这一点，我们的第一步就是将数据以CSV格式从RDS实例发送到S3，这样我们就可以在Athena中创建一个表。还有<a href="https://acloudguru.com/course/introduction-to-amazon-rds">你如何定期有效地将数据从RDS </a>发送到S3？明明用的是数据管道！</p><div class="wp-block-media-text alignwide is-stacked-on-mobile"><figure class="wp-block-media-text__media"><img loading="lazy" src="../Images/5aee29cc7c9010771d80f6510fdc0f6c.png" alt="AWS Data pipeline" class="wp-image-41743 size-full" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2017/02/1_R-9n5CZi0vQOrzsRQdb6ZQ.png"/></figure><p class="wp-block-media-text__content"/><p id="6292"><strong>数据管道是一种非常强大的瑞士军刀式服务，</strong>得益于调度，它可以成为运行重复性数据转换任务的可行选项，甚至仅用于计算任务。这就是我们最终用它来查询Athena的原因。</p><p id="bc07">Athena乍一看可能只是一个图形用户界面。但是您仍然认为可以使用AWS SDK运行查询吗？没那么快，在GUI之外实际运行查询的唯一方法是使用JDBC和使用<a href="http://docs.aws.amazon.com/athena/latest/ug/connect-with-jdbc.html" target="_blank" rel="noreferrer noopener"> Athena驱动程序</a>进行连接。</p><p id="bc07">因此，为了让我们定期查询Athena，我们最终再次使用了数据管道，但这一次的目标是运行一个<em> ShellCommandActivity </em>来准备在S3的查询结果，然后再将其发送回我们的RDS实例。</p></div></div><h2 id="h-using-data-pipelines-to-query-athena">使用数据管道查询Athena</h2><p>为了实现这一点，我们必须用Java 1.8构建一个定制的AMI(默认的EC2 AMI是1.7)，构建一个可以连接到Athena的小Java类，运行查询，然后在指定的位置输出结果。现在我无论如何都不是一个好的Java开发人员，但是我可以到处走走。最后，我们得到了类似这样的结果(大致基于AWS提供的示例):</p><p/><pre class="wp-block-code"><code>statement = conn.createStatement();
ResultSet rs = statement.executeQuery(sql);
ResultSetMetaData rsmd = rs.getMetaData();
CSVWriter writer = new CSVWriter(
  new FileWriter(outputLocation),
  ',',
  CSVWriter.NO_QUOTE_CHARACTER,
  CSVWriter.NO_ESCAPE_CHARACTER
);
while (rs.next()) {
  String[] entries = new String[rsmd.getColumnCount()];
  
  for (int i = 1; i &lt; rsmd.getColumnCount() + 1; i++) {
    entries[i — 1] = rs.getString(i);
  }
  writer.writeNext(entries);
}</code></pre><p>这工作得非常好，因为<code>sql</code>变量和<code>outputLocation</code>实际上来自<code>args</code>，我们可以为将来的查询重用同一个类，并且简单地复制管道。</p><div class="wp-block-image"><figure class="aligncenter size-large is-resized"><a href="https://acloudguru.com/blog/engineering/your-aws-terminology-cheat-sheet"><img loading="lazy" src="../Images/09fdefb5b29b6537f56500680e982da4.png" alt="Athena powering production data" class="wp-image-41741" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2017/02/1_BVb4nDfOxMt2JDylmMWbIQ.png"/></a><figcaption>Final setup, now serving data for our customers in production</figcaption></figure></div><h3 id="b59f">结论</h3><p id="a3c1">Athena是一个非常强大的工具,我建议你看看它。这是一种运行分布式查询的廉价而快速的方法，现在它为我们的应用程序提供生产数据。每TB数据扫描费用为5美元，大数据处理的准入门槛已显著降低。</p><p id="f448">当然有一些方法可以改进我们的设置，几乎总是有的。但是最主要的事情可能是将我们在Athena中查询的CSV文件替换为拼花文件，以节省成本并提高查询性能。关于这一点，Mark Litwintschik写了一篇关于Athena <a href="http://tech.marksblogg.com/billion-nyc-taxi-rides-aws-athena.html" target="_blank" rel="noreferrer noopener"> here </a>的比较不同数据格式的精彩文章，我推荐阅读。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-level-up-your-cloud-career">提升您的云计算职业生涯</h2><p class="has-text-align-center">无论您是云新手还是经验丰富的专家，云专家都能让您轻松(而且非常棒)地获得认证并掌握现代技术技能。查看ACG目前的免费课程或立即开始免费试用。</p><hr class="wp-block-separator"/></div></div>    
</body>
</html>