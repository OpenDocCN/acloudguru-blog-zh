<html>
<head>
<title>How to debug faster with structured logging | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用结构化日志更快地调试|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/how-to-debug-faster-with-structured-logging#0001-01-01">https://acloudguru.com/blog/engineering/how-to-debug-faster-with-structured-logging#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>日志一直是开发人员调试应用程序的工具，从简单的“print("Here ")”`到使用更正式的库，如log4j和日志模块。虽然这种“非结构化日志记录”对于单独的开发人员阅读日志来查明问题是有效的，但在执行更深入的分析或构建关于应用程序使用情况的报告时，这种类型的“非结构化日志记录”无法扩展。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><strong>加速您的云计算职业生涯</strong></p><p class="has-text-align-center">云专家让你轻松(也很棒)提升你的云事业——即使你对技术完全陌生。查看<a href="https://acloudguru.com/blog/news/whats-free-at-acg" target="_blank" rel="noreferrer noopener"> ACG目前的免费课程</a>或<a href="https://acloudguru.com/pricing">立即开始</a>免费试用。</p><hr class="wp-block-separator"/><p>在最近关于构建无服务器应用程序的Twitter空间中，讨论了结构化日志的概念，作为一种扩展日志工作的方式，并提供了一种一致的方式来使用日志。</p><h2 id="h-what-is-structured-logging"><strong>什么是结构化日志</strong>？</h2><p>结构化日志记录是一种以一致的格式记录信息的方法，允许将日志视为数据而非文本。结构化日志通常用JSON表示，这使得开发人员能够高效地存储、检索和分析日志。</p><figure class="wp-block-image size-full"><img loading="lazy" src="../Images/cde8c9cb61ad98bcd2e7427519fc7482.png" alt="" class="wp-image-117719" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1008/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64fc338b12ae47deaa.png 1008w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64fc338b12ae47deaa.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64fc338b12ae47deaa.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64fc338b12ae47deaa.png 380w" sizes="(max-width: 1008px) 100vw, 1008px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64fc338b12ae47deaa.png"/></figure><p>支持更快调试的一些主要优势包括…</p><ul><li><strong>更好的搜索—</strong>通过利用JSON格式，我们可以在字段上创建查询，而不必依赖原始文本的脆弱正则表达式模式</li><li><strong>更好的集成</strong>–通过使用一致的JSON格式，应用程序可以轻松地为仪表板或分析等下游任务获取数据。</li><li><strong>更好的可读性—</strong>通过利用一致的格式，日志的使用者(如系统管理员)可以比阅读原始文本文件更有效地解析数据。</li></ul><p>在这篇文章中，我将通过一个简单的<a href="https://aws.amazon.com/lambda/"> AWS Lambda </a>函数演示Python中的一个例子，强调非结构化和结构化日志记录之间的区别。</p><h2 id="h-unstructured-logging-example"><strong>非结构化日志示例</strong></h2><p>在本例中，我们将只使用默认的print语句。简单地说“这里”可以让我们知道代码在函数中的什么地方被执行。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/04a3d07cf045a38661bb4e689a10340f.png" alt="" class="wp-image-117720" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1110/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png 1110w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png 380w" sizes="(max-width: 1110px) 100vw, 1110px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase643822d60a1735d452.png"/></figure><p>虽然简单，但在查看日志事件时，它允许快速的人类可读调试过程。在AWS Lambda的上下文中，我们可以使用<a href="https://aws.amazon.com/cloudwatch/"> AWS CloudWatch </a>日志组来轻松验证我们的代码运行。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/8405e6d5a5b4bc00e192d7704b241fbb.png" alt="" class="wp-image-117721" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1600/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 1600w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 1536w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png 380w" sizes="(max-width: 1600px) 100vw, 1600px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase64981aaa294ba69f58.png"/></figure><p>虽然对于简单用例的单独调试来说很棒，但是简单地打印文本并不能传达更深入的分析或有效的搜索方式所需的上下文。例如，可以从某个地区的客户那里查找日志，或者在特定页面上执行某个操作。必须进行文本匹配或正则表达式来查找日志中的数据，这对于细致入微的搜索来说并不理想。</p><p>日志模块也遇到了与标准打印语句相同的问题。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/33678b819f5c9374add84b4ea7cf12c0.png" alt="" class="wp-image-117722" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1110/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png 1110w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png 380w" sizes="(max-width: 1110px) 100vw, 1110px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase648fe16bebededc694.png"/></figure><p>数据仍然是文本格式，即使它提供了日志级别等附加信息，日志消息仍然被视为文本而不是数据。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/aa8bb40f203a99ad791991a25665af78.png" alt="" class="wp-image-117723" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1600/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 1600w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 1536w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png 380w" sizes="(max-width: 1600px) 100vw, 1600px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/pngbase641fd73ac1a2806018.png"/></figure><h2 id="h-structured-logging-example"><strong>结构化测井示例</strong></h2><p>为了将日志视为数据，我们必须创建一个能够将日志表示为数据的结构。有一些包，如<a href="https://github.com/madzak/python-json-logger" target="_blank" rel="noreferrer noopener"> Python JSON Logger </a>提供了将日志转换成JSON的机制，但是您也可以创建一个类来封装您的数据。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/f51a1c0bdb15abca405950dabbc7a740.png" alt="" class="wp-image-117727" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1276/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png 1276w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png 380w" sizes="(max-width: 1276px) 100vw, 1276px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/1pngbase6436638feca2d8f3ac.png"/></figure><p>现在，当我们在Cloudwatch中查看数据时，我们会得到一个漂亮的JSON，其中包含我们想要的任何字段。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/c3d2afe4d3c1628c1fc08c35635f149a.png" alt="" class="wp-image-117726" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1600/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 1600w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1536/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 1536w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png 380w" sizes="(max-width: 1600px) 100vw, 1600px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/2pngbase64b5a6105ef842c202.png"/></figure><p>由于数据是JSON格式，允许我们使用Cloudwatch Log Insights使用自定义字段对数据进行查询，因此我们决定不进行任何额外的配置。</p><figure class="wp-block-image size-full"><img loading="lazy" src="../Images/d03d1570ba03d681780f0b0cc744ecfd.png" alt="" class="wp-image-117725" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_720/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/3pngbase6430bc9c7199921064.png 720w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/3pngbase6430bc9c7199921064.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/3pngbase6430bc9c7199921064.png 380w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/3pngbase6430bc9c7199921064.png"/></figure><p>更多利用Cloudwatch日志的例子，请查看<a href="https://aws.amazon.com/blogs/compute/tag/cloudwatch-logs/" target="_blank" rel="noreferrer noopener"> AWS计算博客</a>。</p><p>当我们移植日志时，我们还获得了一种易于使用的JSON格式，可以在其他应用程序中使用。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/ef1d1dba5ddad590c07eeef48a25aadb.png" alt="" class="wp-image-117724" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1276/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png 1276w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png 380w" sizes="(max-width: 1276px) 100vw, 1276px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/03/4pngbase64e03b4c25ceec3481.png"/></figure><p>与其他日志示例中的原始文本相比，在结构化示例中，日志消息现在可以作为JSON对象使用。</p><p>如您所见，结构化日志记录并不是必须以某种方式实现的“硬性要求”。它只是一个框架，使您能够将日志视为数据，从而为您、您的团队和组织提供更健壮的调试方法。</p><p><em>在Twitter上关注Banjo，点击</em> <a href="https://twitter.com/banjtheman"> <em>，@banjtheman </em> </a> <em>和</em> <a href="https://twitter.com/awsdevelopers"> <em>，@AWSDevelopers </em> </a> <em>了解更多关于云计算和AWS的有用提示和技巧。</em></p><h4><strong>关于作者</strong></h4><p>Banjo是AWS的一名高级开发人员，他在那里帮助开发人员对使用AWS感到兴奋。Banjo热衷于将数据操作化，并围绕利用数据启动了一个播客、一个meetup和开源项目。当没有建造下一个大东西时，Banjo喜欢通过玩视频游戏特别是JRPGs和探索他周围发生的事件来放松。</p></div></div>    
</body>
</html>