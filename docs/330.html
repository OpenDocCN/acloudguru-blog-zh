<html>
<head>
<title>How to track, analyze, and visualize data using AWS | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用AWS |云专家跟踪、分析和可视化数据</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/how-to-track-analyze-and-visualize-user-group-data-using-aws#0001-01-01">https://acloudguru.com/blog/engineering/how-to-track-analyze-and-visualize-user-group-data-using-aws#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p><em>在本帖中，我们将讨论如何使用亚马逊定位服务对地址进行地理编码，如何使用亚马逊EventBridge和AWS Lambda每天将数据转换和加载到S3，如何使用亚马逊QuickSight可视化和共享存储的数据，以及如何使用SAM自动化和协调整个解决方案</em></p><h2 id="h-using-aws-to-understand-trends-in-user-group-data"><em>使用AWS了解用户群数据的趋势</em></h2><p>新冠肺炎疫情已经将许多面对面的社区聚会转变为虚拟活动。发表在《应用心理学杂志》上的新研究表明，在虚拟会议、聚会和社交活动的时代，“变焦疲劳”是真实存在的。</p><p>社区总是询问支持用户组的方法。为此，我一直在寻找一种快速、有效、可靠的方法来分析用户组数据，并将其可视化到仪表板中。该解决方案有助于以多种方式获得洞察力:</p><ul><li><strong>跟踪活跃的会议:</strong>了解哪些用户组在过去12个月、6个月或3个月一直活跃。</li></ul><ul><li><strong>可视化成员的位置:</strong>使用地图查看我们团队的位置，以及他们的足迹有多大。</li></ul><ul><li><strong>跟踪事件:</strong>使用一个按最后事件时间戳排序的表，查看哪些组最近发生了事件</li></ul><hr class="wp-block-separator"/><h2 class="has-text-align-center">加速您的职业发展</h2><p class="has-text-align-center"><a href="https://acloudguru.com/pricing">从ACG开始</a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室改变你的职业生涯。</p><hr class="wp-block-separator"/><h2>解决方案概述</h2><p>这篇文章描述了我是如何构建这个解决方案的，从地理编码地址数据到在亚马逊QuickSight上的最终可视化。</p><p>在这个解决方案中，我从开发Python代码开始，从<a href="http://www.meetup.com/" target="_blank" rel="noreferrer noopener"> Meetup </a>收集用户组数据。</p><p>为了在地图上标出每次聚会，需要地理位置数据。我使用亚马逊定位服务将地址地理编码为经度和纬度坐标。</p><p>然后，转换后的数据被发布到一个<a href="http://aws.amazon.com/s3" target="_blank" rel="noreferrer noopener">亚马逊简单存储服务</a>(亚马逊S3)桶中。</p><p>我使用Amazon EventBridge设置了一个每日作业来触发一个lambda函数来收集用户组数据。报告和可视化层是使用<a href="https://acloudguru.com/blog/engineering/amazon-quicksight-how-to-put-eyes-on-your-data-with-this-aws-bi-tool" target="_blank" rel="noreferrer noopener"> QuickSight </a>构建的。最后，使用AWS SAM部署整个管道。</p><p>下图说明了这种体系结构。</p><h3>收集用户组数据</h3><p>AWS用户组是定期聚会以分享想法、回答问题并了解新服务和最佳实践的社区。用户组使用meetup.com组织他们的活动。我对美洲页面的<a href="https://aws.amazon.com/developer/community/usergroups/americas/" target="_blank" rel="noreferrer noopener">用户组中列出的加拿大和美国的用户组很好奇。</a></p><p>我使用了<code>BeautifulSoup</code>和requests库从AWS用户组网站抓取内容。</p><p>该脚本首先通过<code>get_user_group_data</code>函数获取每个用户组的meetup URL。基于某些div属性的存在，它将相关的meetup URL和名称存储在一个要废弃的列表中。</p><p>接下来，<code>get_meetup_info</code>函数遍历列表并解析每个meetup页面上的信息，比如成员数量和meetup位置。原始数据保存为CSV格式，以便进一步处理。</p><p>本文中的解决方案仅用于演示目的。我们建议在与管理这些脚本的团队协商后，仅在您自己的网站上运行类似的脚本，或者确保遵守您试图抓取的网站的服务条款。</p><p>下面显示了该脚本的一个示例。</p><pre class="wp-block-code"><code>meetup_json = {}
	page = requests.get(meetup_url)
	usergroup_html = page.text
	soup = BeautifulSoup(usergroup_html, "html.parser")

	# Get Meetup Name
	meetup_name = soup.findAll("a", {"class": "groupHomeHeader-groupNameLink"})[0].text

	# Meetup location
	meetup_location = soup.findAll("a", {"class": "groupHomeHeaderInfo-cityLink"})[
    	0
	].text

	# Number of members
	meetup_members = (
    	soup.findAll("a", {"class": "groupHomeHeaderInfo-memberLink"})[0]
    	.text.split(" ")[0]
    	.replace(",", "")
	)

	# Past events
	past_events = (
    	soup.findAll("h3", {"class": "text--sectionTitle text--bold padding--bottom"})[
        	0
    	]
    	.text.split("Past events ")[1]
    	.replace("(", "")
    	.replace(")", "")
	)</code></pre><h3>地理编码用户组</h3><p>为了在地图上绘制每个meetup组，我们需要meetup组中每个城市的经度和纬度。我可以使用亚马逊定位服务，通过地点索引将每个城市的名称地理编码成经度和纬度坐标。有关创建地点索引的更多信息，请参见<a href="https://docs.aws.amazon.com/location/latest/developerguide/places-prerequisites.html" target="_blank" rel="noreferrer noopener">亚马逊位置服务开发者指南</a>。</p><p>以下是使用地点索引进行地理编码的示例Python代码。</p><pre class="wp-block-code"><code>import boto3

def get_location_data(location: str):
	"""
	Purpose:
    	get location data from name
	Args:
    	location - name of location
	Returns:
    	lat, lng -  latitude and longitude of location
	"""
	client = boto3.client("location")
	response = client.search_place_index_for_text(
    	IndexName="my_place_index", Text=location
	)

	print(response)
	geo_data = response["Results"][0]["Place"]["Geometry"]["Point"]

	#  Example output for Arlington, VA:   'Results': [{'Place': {'Country': 'USA', 'Geometry': {'Point': [-77.08628999999996, 38.89050000000003]}, 'Label': 'Arlington, VA, USA', 'Municipality': 'Arlington', 'Region': 'Virginia', 'SubRegion': 'Arlington County'}}
	lat = geo_data[1]
	lng = geo_data[0]

	print(f"{lat},{lng}")

	return lat, lng
</code></pre><h3>使用SAM来协调部署</h3><p>在本地测试脚本之后，下一步是创建一个机制来每天运行脚本并将结果存储在S3。我使用AWS无服务器应用程序模型(SAM)创建了一个无服务器应用程序，它执行以下操作。</p><ol><li>创建S3存储桶</li><li>创建每24小时触发一次的CloudWatch事件</li><li>部署Python lambda函数来运行数据抓取代码</li></ol><p>下面是用于部署无服务器应用程序的大纲，突出显示了我使用的示例代码。</p><p><strong> 1。从终端窗口，初始化一个新的应用</strong> <br/> <code>sam init</code></p><p><strong> 2。更改目录:<br/> </strong> <code>cd ./sam-meetup</code></p><p><strong> 3。</strong>更新依赖关系<br/> *更新my_app/requirements.txt</p><p><code>requests</code><br/><code>pandas</code><br/>T2】</p><p><strong> 4。更新代码</strong> <br/>将您的代码添加到示例` my_app/app.py `中</p><pre class="wp-block-code"><code>import json
import logging

import get_meetup_data


def lambda_handler(event, context):

	logging.info("Getting meetup data")

	try:
    	get_meetup_data.main()
	except Exception as error:
    	logging.error(error)
    	raise error

	return {
    	"statusCode": 200,
    	"body": json.dumps(
        	{
            	"message": "meetup data collected",
        	}
    	),
	}</code></pre><p><strong> 5。更新模板. yml〔t1〕</strong></p><pre class="wp-block-code"><code>Globals:
  Function:
	Timeout: 600
Resources:
  S3Bucket:
	Type: 'AWS::S3::Bucket'
	Properties:
  	BucketName: MY_BUCKET_NAME
  GetMeetupDataFunction:
	Type: AWS::Serverless::Function
	Properties:
  	CodeUri: my_app/
  	Handler: app.lambda_handler
  	Policies:
    	- S3WritePolicy:
        	BucketName: MY_BUCKET_NAME
  	Runtime: python3.9
  	Architectures:
    	- x86_64
  	Events:
    	GetMeetupData:
      	Type: Schedule
      	Properties:
        	Schedule: 'rate(24 hours)'
        	Name: MeetupData
        	Description: getMeetupData
        	Enabled: True</code></pre><p><strong> 6。跑`<code>sam build</code> ` </strong></p><p><strong> 7。将应用程序部署到AWS <br/> </strong> <code>sam deploy --guided</code></p><p>有关开发SAM应用程序的更多详细信息，请查看<a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started.html" target="_blank" rel="noreferrer noopener">AWS SAM入门</a>。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><a href="https://go.acloudguru.com/AWS-Cost-Optimization-Webinar"> <strong>自动化AWS成本优化</strong> </a> <br/> AWS为您的企业提供了前所未有的价值，但经济高效地使用它可能是一项挑战。在这个<a href="https://go.acloudguru.com/AWS-Cost-Optimization-Webinar">免费点播的网络研讨会</a>中，您将了解AWS成本优化工具和策略的概况。</p><hr class="wp-block-separator"/><h2>使用QuickSight可视化数据</h2><p>为了共享用户组数据，我选择使用亚马逊S3的<a href="https://acloudguru.com/blog/engineering/amazon-quicksight-how-to-put-eyes-on-your-data-with-this-aws-bi-tool" target="_blank" rel="noreferrer noopener"> QuickSight </a>作为数据源。</p><p>QuickSight是一项原生AWS服务，可与其他AWS服务无缝集成，如亚马逊红移、雅典娜、亚马逊S3和许多其他数据源。</p><p>作为一项完全托管的服务，QuickSight使团队能够轻松创建和发布交互式仪表盘。除了构建强大的可视化功能，QuickSight还提供了数据准备工具，可以轻松过滤数据并将其转换为所需的数据集。有关创建数据集的更多信息，请参见<a href="https://docs.aws.amazon.com/quicksight/latest/user/create-a-data-set-s3.html" target="_blank" rel="noreferrer noopener">使用亚马逊S3文件创建数据集</a>。</p><p>以下是仪表板的屏幕截图示例。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><em>参加<a href="https://acloudguru.com/blog/engineering/amazon-quicksight-how-to-put-eyes-on-your-data-with-this-aws-bi-tool" target="_blank" rel="noreferrer noopener"> Amazon QuickSight速成班，学习如何使用这款AWS BI工具</a> </em>查看您的数据。</p><hr class="wp-block-separator"/><h3>结论</h3><p>在本帖中，我们讨论了如何成功实现以下目标:</p><ul><li>使用亚马逊定位服务对地址进行地理编码</li><li>使用Amazon EventBridge和AWS Lambda每天将数据转换并加载到S3</li><li>使用Amazon QuickSight可视化和共享存储的数据</li><li>使用SAM自动化和协调整个解决方案</li></ul><p>该解决方案可用于深入了解与技术社区的互动。如果你有兴趣加入当地社区，请点击这里查看AWS用户组页面<a href="https://aws.amazon.com/developer/community/usergroups/" target="_blank" rel="noreferrer noopener"/>。</p><h4><strong>关于作者</strong></h4><p>Banjo是AWS的一名高级开发人员，他在那里帮助开发人员对使用AWS感到兴奋。Banjo热衷于将数据操作化，并围绕利用数据启动了一个播客、一个meetup和开源项目。当没有建造下一个大东西时，Banjo喜欢通过玩视频游戏特别是JRPGs和探索他周围发生的事件来放松。</p></div></div>    
</body>
</html>