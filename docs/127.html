<html>
<head>
<title>Deploying Kubernetes Applications with Azure DevOps | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用云专家Azure DevOps部署Kubernetes应用程序</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/deploy-kubernetes-app-with-azure-devops#0001-01-01">https://acloudguru.com/blog/engineering/deploy-kubernetes-app-with-azure-devops#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p><strong>大家好，我是<a href="https://www.youtube.com/watch?v" target="_blank" rel="noopener noreferrer">查德·克罗威尔</a>，微软Azure课程的讲师，在一个云计算大师那里。我<span class="lt-line-clamp__line">非常热衷于帮助</span> <span class="lt-line-clamp__line">你实现梦想，并帮助你利用自己的技能度过逆境。在一起，我们可以完成任何事情。</span> </strong></p><hr class="wp-block-separator"/><p>在科技世界里，我们喜欢创造新的流行语！有些会脱口而出，有些不会。他们中的一些人甚至发现自己在我们的职位上，尽管他们可能不应该这样。DevOps是那些超级酷的流行语之一。DevOps是那些听起来很酷的词之一(因为马丁·福勒是这么说的)，而且似乎甚至在我们今天的对话中仍然存在。因此，我认为探索Azure DevOps中的新特性并带您通过一个简单的管道会很有趣。</p><hr class="wp-block-separator"/><p class="has-text-align-center">准备好和云专家一起深入Azure内容了吗？</p><hr class="wp-block-separator"/><h2 id="h-what-is-devops">DevOps是什么？</h2><p><span>简单来说，<a href="https://acloudguru.com/blog/engineering/devops-vs-agile-whats-the-difference"> DevOps就是将之前由于物理系统的约束而分离的两个进程</a>合并。这两个过程是开发(构建计算机程序/应用程序的过程)和操作(创建运行所述计算机程序的基础设施/机器的过程)。</span>无论你是不是开发人员，单独工作还是在团队中工作，<a href="https://acloudguru.com/course/introduction-to-azure-devops"> Azure DevOps培训</a>可以帮助你组织你计划、创建和交付软件的方式。</p><p>制约因素是什么？物理机器必须由一群工程师以相当智能的方式组装起来。例如，构建计算机、将其添加到网络、实施身份管理、加强安全性等。快进到今天，已经不是这样了。一切都变了。</p><h2 id="h-the-cloud-changed-everything">云改变了一切</h2><p>许多硬件组件的虚拟化和云的流行(更不用说进入门槛低了)使得许多运营人员改变了他们的工作职能。以前他们处理硬件，现在他们构建代码基础设施(IaC ),以及其他与编码相关的任务。</p><p>既然我们已经了解了这些年来工程师工作职能的转变，我们就来谈谈微软800磅重的大猩猩(又名Azure)。Azure提供的不仅仅是云中的基础设施。有了PaaS、SaaS和介于两者之间的一切，Azure是云中弹性和高可用性的一站式商店。</p><h2 id="h-azure-devops">Azure DevOps</h2><p>Azure DevOps的前身是Visual Studio Team Services (VSTS)，它简化了从代码集成到软件应用程序发布和测试的流程，让开发人员感到满意。虽然Jenkins一直是CI/CD软件的主导者，但微软希望窃取一些市场，但仍然支持Jenkins以缓解这种过渡。</p><h2 id="h-aks-app-integration-tutorial">AKS应用集成教程</h2><p><span>在真正的边做边学中，让我们直接进入并在Azure DevOps中创建一个项目，展示使用一些简单的命令行技巧将应用程序集成和部署到AKS中是多么容易。跟着做，最后，你也可以拥有一个运行在AKS上的闪亮的新的web应用程序，可以从任何web浏览器访问，其中包括来自云专家的友好消息。</span></p><p>若要跟进，您必须拥有Azure和GitHub帐户。GitHub帐户是免费的，所以如果你还没有注册的话，就直接去https://github.com的<a href="https://github.com" target="_blank" rel="noopener noreferrer"><span/></a><span>注册吧！</span></p><p><span>此外，在继续之前，前往https://aex.dev.azure.com</span><a href="https://aex.dev.azure.com" target="_blank" rel="noopener noreferrer"><span/></a><span>创建一个Azure DevOps组织(如果您还没有的话)。只需点击“创建新组织”按钮。</span></p><p>以下所有命令都应该在Azure Cloud Shell中运行。通过从任何浏览器进入<a href="https://shell.azure.com" target="_blank" rel="noopener noreferrer"><span>【https://shell.azure.com】</span></a><span>并登录您的Azure帐户来访问此shell。</span></p><p><strong> PRO提示:</strong> <span> <strong>可以使用PowerShell屏幕，但是在终端中键入“bash”切换到bash命令</strong>。</span></p><h2 id="h-let-s-begin">我们开始吧！</h2><p><strong>首先，将Azure DevOps扩展添加到我们的云外壳会话:</strong></p><p><span> ~$ az扩展添加–名称azure-devops </span></p><p><strong>接下来，让我们为我们的shell添加上下文来引用我们的DevOps组织(我的组织名称是“https://dev . azure . com/ccrowellla/”，但您的名称会有所不同):</strong></p><p><span>~ $ az devo PS configure–defaults organization = https://dev . azure . com/ccrowellla/</span></p><p>从云壳，我们必须重新登录，这样我们的帐户才能访问Azure DevOps。按照终端的提示进行登录:</p><p><span>~ ~ $登录￥t1</span></p><p><strong>接下来，让我们创建一个新的DevOps项目:</strong></p><p><span> ~$ az devops项目创建–命名项目1 </span></p><p><strong>现在，设置要使用的默认项目:</strong></p><p><span>~ $ az devo PS configure–defaults project = project 1</span></p><p><strong>让我们创建一个资源组，以便在逻辑上组织我们将在后续步骤中创建的Azure资源:</strong></p><p><span>~ $ az group create–name aks-rg–location eastus</span></p><p>我们可以为我们的AKS集群创建一个服务主体。我们的AKS集群将使用这个服务主体来访问Azure容器注册表和拉容器映像。</p><h4 id="h-important-copy-the-output-of-the-following-command-to-a-notepad-you-will-need-it-later">重要提示:将以下命令的输出复制到记事本中，您以后会用到它:</h4><p><span>~ $ az ad sp create-for-RBAC–跳过分配</span></p><p><strong>现在，让我们创建一个AKS集群来部署我们的应用程序(在这里，您使用前一个命令的输出将“appId”粘贴到“–service-principal”之后，并将“password”粘贴到“–client-secret”之后):</strong></p><p><span>~ $ az aks create-g aks-rg-n myaks cluster–node-count 1–service-principal " e 848493 e-1614-4f 58-b6a 7-a 880045 e 7d 8 f "-client-secret " 47 b01a 18-903 e-463 b-ac68-641 b 40 be 80 b 6 "</span></p><p>接下来，让我们创建一个Azure容器注册中心(ACR)。这将是我们在AKS中使用的容器的存储库。ACR名称必须是全球唯一的，这意味着世界上没有人可以拥有相同的名称。发挥创意的时间:</p><p><span>~ $ az ACR create-g aks-rg-n uniqueacrname here–SKU Basic–admin-enabled true</span></p><p><strong>为了允许AKS从ACR获取图像，我们必须为服务主体设置我们的Azure RBAC权限(在此填写您唯一的ACR名称):</strong></p><p><span>~ $ ACR _ ID = $(az ACR show–name uniqueacrnamehere–resource-group AK s23–query“ID”-output tsv)</span></p><p><span>~ $ CLIENT _ ID = $(az aks show-g aks-rg-n myaks cluster–query " serviceprincipalprofile . clientid–output tsv)</span></p><p><span> ~$ az角色分配创建–被分配人$ CLIENT _ ID–角色ACR pull–范围$ACR_ID </span></p><h4 id="h-now-let-s-get-to-the-good-stuff-creating-and-deploying-the-application">现在，让我们进入正题；创建和部署应用程序！</h4><p><strong>对于应用程序代码，您将派生repo，克隆该repo(从您的GitHub帐户)并更改到“pipelines-sample-app”目录:</strong></p><p><strong> Fork这个GitHub repo(在新标签页打开这个链接，点击“Fork”):<a href="https://github.com/chadmcrowell/pipelines-sample-app" target="_blank" rel="noopener noreferrer">https://github.com/chadmcrowell/pipelines-sample-app</a>T3】</strong></p><p><strong>一旦分叉，用“git克隆”将其克隆到云shell中的终端会话，但将github用户名改为您的用户名:</strong></p><p><span> ~$ git克隆https://github.com/&lt;your-github-username-goes-here&gt;/pipelines-sample-app . git</span></p><p><span> ~$ cd pipelines-sample-app </span></p><p><strong>现在让我们在Azure DevOps中创建一个管道:</strong></p><p><span> ~$ az管道创建-名称“管道1”</span></p><p><strong>按照终端提示设置管道:</strong></p><p><span> <strong>第一次提示:</strong>输入你的GitHub用户名；按回车键</span></p><p><span> <strong>第二次提示:</strong>输入你的GitHub密码；按回车键</span></p><p><span> <strong>第三次提示:</strong>再次输入你的github密码确认；按回车键</span></p><p><span> <strong>第四次提示:</strong>输入服务连接名称(如管道)；按回车键</span></p><p><span> <strong>第5次提示:</strong>选择【3】部署到Azure Kubernetes服务；按回车键</span></p><p><span> <strong>第6次提示:</strong>选择您刚刚创建的k8s集群；按回车键</span></p><p><span> <strong>第7次提示:</strong>选择【2】为“默认”kubernetes命名空间；按回车键</span></p><p><span> <strong>第8次提示:</strong>选择您刚刚创建的ACR按回车键</span></p><p><span> <strong>第9次提示:</strong>输入图像名称值(回车接受默认)；按回车键</span></p><p><span> <strong>第10次提示:</strong>输入服务端口的值(回车接受默认)；按回车键</span></p><p><span> <strong>第11次提示:</strong>输入一个值，为拉式请求启用审核应用流(按Enter键，无需键入值)</span></p><p><span> <strong>第12次提示:</strong>选择【1】继续生成YAML；按回车键</span></p><p><span> <strong>第13次提示:</strong>选择【1】直接提交到主分支；按回车键</span></p><p><span> </span></p><p><span> <strong>恭喜恭喜！</strong>你已经创建了一个Azure DevOps项目！等待大约四分钟，让应用程序构建容器，推送到ACR，然后部署到AKS。</span></p><p><strong>通过获取kubeconfig凭证来访问您的AKS集群:</strong></p><p><span>~ $ az aks get-credentials–resource-group aks-rg–name myaks cluster</span></p><p><strong>查看您的项目已经创建的Kubernetes资源:</strong></p><p><span> ~$ kubectl获取全部</span></p><p>在新的部署和pod中有一项服务。复制服务IP地址(在“外部IP”下)并粘贴到一个新的浏览器选项卡中，在末尾添加“:8080”(例如104.45.182.156:8080)。</p><h3 id="h-here-is-your-final-result">这是你的最终结果:</h3><figure class="wp-block-image"><img loading="lazy" src="../Images/2685d18e135e16d380d65aff528bec9c.png" alt="A Cloud Guru loves Kubernetes" class="wp-image-27438" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/screen-shot-2020-04-07-at-7.25.07-a-m-300x83.png"/></figure><h2 id="h-summary">摘要</h2><p>在这篇短文中，我们在Azure DevOps中创建了一个新项目。在该项目中，我们建立了一个CI/CD渠道。该管道在一个容器内构建我们的应用程序，将该容器推送到容器存储库，并将该容器部署到AKS。最终允许我们通过Kubernetes服务从web上查看我们在AKS中运行的web应用程序。很酷吧。</p><p><span> <strong>重要的</strong>:注意我们管道的触发器。回到你的分叉回购，查看文件“azure-pipelines.yml”。您应该看到“trigger:–master”这一行，这意味着每当我们对主分支进行更改时，一个新的构建就会自动开始。</span></p><p><span>所以，这里最大的收获不是我们运行了web应用程序。此外，从现在开始对应用程序的所有更改都将自动部署到我们的AKS集群中。这意味着当您开始开发应用程序时，您可以立即“实时”看到变化。太棒了，对吧？！？</span></p><p><span>如果你和我一样，对将这种自动化构建到你的部署过程中感到兴奋，请查看我的课程“<a href="https://acloudguru.com/course/build-and-deploy-pipelines-with-microsoft-azure" target="_blank" rel="noreferrer noopener">用微软Azure </a>构建和部署管道”，在那里我演示了许多这方面的其他例子。</span></p><hr class="wp-block-separator"/><p class="has-text-align-center">你准备好让你的技能更上一层楼了吗？现在开始训练。</p><hr class="wp-block-separator"/><h3 id="h-want-more-devops-goodness-check-these-out">想要更多的DevOps善良？看看这些:</h3></div></div>    
</body>
</html>