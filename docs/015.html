<html>
<head>
<title>Throttling Pods in Kubernetes | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes中的节流豆荚|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/throttling-pods-in-kubernetes#0001-01-01">https://acloudguru.com/blog/engineering/throttling-pods-in-kubernetes#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>如果你一直在学习Kubernetes，那么你可能对pod的概念很熟悉。豆荚是Kubernetes的重要组成部分。这就是为什么Minerva 的“<a target="_blank" rel="noopener noreferrer" href="https://www.lucidchart.com/documents/view/b1b62a6e-1266-41dd-b48d-3c44252fb88f" noreferrer="1"> Pod”(本</a><a target="_blank" rel="noopener noreferrer" href="https://linuxacademy.com/linux/training/course/name/cloud-native-certified-kubernetes-administrator-cka" noreferrer="1">认证Kubernetes管理员</a>课程中使用的互动指南)代表Pod指南。</p><h2><strong>吊舱</strong></h2><p>pod被调度到机器或虚拟机，其中调度器(控制平面组件)尝试将pod安装到虚拟机上，假设虚拟机具有足够的CPU和内存来满足pod的需求。对于那些希望利用我们虚拟机的所有资源的人来说，你可能会问“我如何告诉Kubernetes在我的虚拟机上安装pod，以便它利用它拥有的所有资源？”毕竟，我们大多数人都没有能力为我们的pod创建无限数量的虚拟机，利用我们购买的每一平方英寸的资源不仅具有成本效益，而且允许我们确保我们的pod获得足够的资源来运行，从而使我们的应用程序性能更好。在这个简短的教程中，您将学习如何对您的pod使用请求和限制，以便更好地组织您的pod在集群中的调度方式。我的目的是让您相信，将这一点添加到每个pod定义中是一个很好的想法，可以让您安心，为您在Kubernetes上运行的应用程序增加价值。</p><h2><strong>请求和限制</strong></h2><p>在创建pod时，您可以指定容器需要的CPU和内存量，称为<strong>请求</strong>。您还可以对容器应该使用的CPU和内存数量设置限制，这被称为<strong>限制</strong>。当考虑Java应用程序的JVM堆大小时，设置请求和限制变得非常重要。如果设置不正确，JVM进程很可能会被系统OOM杀手杀死。让我们继续创建一个只包含请求的pod，我将解释这对pod有什么作用。首先，创建以下pod YAML，它将指定要使用的图像和请求数量。如果你不能访问你自己的集群，那么就开始使用<a target="_blank" rel="noopener noreferrer" href="https://linuxacademy.com/join/community" noreferrer="1"> Linux学院的免费社区版</a>(限制访问)。</p><pre>apiVersion: v1kind: Podmetadata:name: pod1spec:containers:- image: busyboxcommand: ["dd", "if=/dev/zero", "of=/dev/null"]name: pod1resources:requests:cpu: 800mmemory: 20Mi</pre><p>继续运行以下命令来创建pod:</p><pre>kubectl create -f pod.yaml</pre><p>要查看此pod以及它在哪个节点上运行，请输入以下命令:</p><pre>kubectl get pods -o wide</pre><p>要获取有关节点及其利用的资源的更多信息，请输入以下命令:</p><pre>kubectl describe node [node_name]</pre><p><strong>注意</strong> <strong> : </strong>如果您不知道节点名称，请键入以下内容来获取:<code>kubectl get nodes</code>在<code>kubectl describe node</code>命令输出的底部，您会注意到请求和限制，类似于此:<a target="_blank" rel="noopener noreferrer" href="https://wpengine.linuxacademy.com/wp-content/uploads/2019/05/kubectl-describe-node-command.png" noreferrer="1"> <img loading="lazy" class="aligncenter wp-image-13272 size-full" src="../Images/ee55f74138f3636393f2e007fd251170.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/kubectl-describe-node-command.png"/> </a>您可能会从上面的截图中注意到，在这个节点上运行的不止一个pod。这是因为法兰绒和kube-proxy也将运行在集群中的kube-system名称空间中。这就是请求总量的来源。从上面的截图来看，法兰绒pod请求100m的CPU，而我们刚刚安排的pod请求800m的CPU。这使我们的总数9亿(90%)列在底部。</p><h2><strong>节点CPU资源</strong></h2><p>你可能会认为，因为每个pod都请求了一个数量，所以它们只会使用请求的数量，仅此而已。这不是真的。实际上，如果需要的话，这两个pod很可能会使用所有剩余的CPU。但是，他们不只是平均分配。剩余的CPU以1:5的比例分割。第一个pod将获得六分之一的CPU时间，另一个将获得剩余的六分之五。为了明确说明pod可以使用的最大CPU和内存量，我们也可以在pod YAML中设置限制。这是第一个舱中的YAML，但我们增加了限制:</p><pre>apiVersion: v1kind: Podmetadata:name: pod1spec:containers:- image: busyboxcommand: ["dd", "if=/dev/zero", "of=/dev/null"]name: pod1resources:requests:cpu: 800mmemory: 20Milimits:cpu: 800mmemory: 20Mi</pre><p>要应用这些更改，您必须删除现有的pod，并使用修改后的YAML重新创建它。使用以下命令删除pod:</p><pre>kubectl delete pods pod1</pre><p>然后，您可以使用以下命令创建具有新YAML的pod:</p><pre>kubectl create -f pod.yaml</pre><p>我们可以通过输入以下命令来检查pod是否正在运行:</p><pre>kubectl get pods -o wide</pre><p>现在我们的pod正在运行，它请求了800m CPU和20Mi内存，因为我们设置了相同的限制，所以它将使用请求的数量，仅此而已。</p><h2><strong>关于Pod CPU和内存的更多信息</strong></h2><p>这是一个关于在Kubernetes中设置CPU和内存请求和限制的简短教程。如果你想了解更多关于Kubernetes的日程安排，请查看Linux Academy上的<a target="_blank" rel="nofollow noopener noreferrer" href="https://linuxacademy.com/linux/training/course/name/cloud-native-certified-kubernetes-administrator-cka">云原生认证Kubernetes管理员(CKA)课程</a>,或者查看以下免费资源以了解更多关于Kubernetes的信息:</p></div></div>    
</body>
</html>