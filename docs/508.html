<html>
<head>
<title>Deploying a Containerized Flask Application with AWS ECS and Docker | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用AWS ECS和Docker |云专家部署容器化Flask应用程序</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/deploying-a-containerized-flask-application-with-aws-ecs-and-docker#0001-01-01">https://acloudguru.com/blog/engineering/deploying-a-containerized-flask-application-with-aws-ecs-and-docker#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>如今，容器很受欢迎，这是有道理的。让我们花15分钟时间，通过使用Docker、AWS和Flask(一种用于构建web应用程序的Python微框架)部署我们自己的应用程序来找出原因。 <span>注意:这篇文章中的一些假设你使用的是Linux/Mac系统。</span> <b>第一步——先决条件</b> <span>让我们确保我们拥有完成这项工作所需的一切:</span></p><ol> <li><span>安</span><a target="_blank" rel="noopener noreferrer" href="https://aws.amazon.com/">T3】AWS账号T5】。</a></li> <li><span>AWS CLI</span><a target="_blank" rel="noopener noreferrer" href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html"><span>已安装</span> </a> <span>和</span> <a target="_blank" rel="noopener noreferrer" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html"> <span>已配置</span> </a> <span>(有足够的权限采取我们需要采取的所有行动)。</span></li> <li><a target="_blank" rel="noopener noreferrer" href="https://www.docker.com/community-edition"><span>Docker</span></a><span>(Docker命令可能需要sudo，或者您可以将当前用户添加到Docker组)。</span></li> <li><span/><a target="_blank" rel="noopener noreferrer" href="https://github.com/linuxacademy/cda-2018-flask-app/tree/ecs-master"><span>本项目代号</span> </a> <span>。可以运行<code>git clone https://github.com/linuxacademy/cda-2018-flask-app.git &amp;&amp; cd cda-2018-flask-app &amp;&amp; git checkout ecs-master</code> </span><ul> <li><span>(确保切换到另一个分支，因为该分支包含特定于ECS的代码)</span></li></ul> </li></ol><p><b>第2步——制作我们的容器图像</b> <span>从命令<code>sudo docker image ls</code>开始，查看当前的Docker设置。如果这是一个新的Docker设置，这个命令可能不会显示太多。如果Docker已经安装了一段时间，可能已经有一些图像了。</span> <span>接下来，我们来看看资源库中带有<code>cat Dockerfile</code>的Dockerfile。我们的docker文件非常简单。让我们一行一行地过一遍:</span></p><ol> <li><span><code>FROM python:3.5-slim</code>–我们从Python 3.5映像开始，将其作为Docker映像的基础。这意味着在我们进行任何定制之前，我们将免费获得Python3.5及其软件包管理器pip。</span></li> <li><span><code>MAINTAINER </code></span><a href="mailto:fernando@linuxacademy.com" rel="noopener"><span>【fernando@linuxacademy.com】</span></a><span>——这一行声明了图像的作者是谁。可以改成你的邮箱。这种格式已不再使用，所以您可能还想将其改为不推荐使用的标签指令，如下:</span> <span/> <span> <code>LABEL maintainer="fernando@linuxacademy.com"</code> </span></li> <li><span><code>USER root</code>–这告诉我们哪个用户应该运行映像和任何命令，比如docker文件后面的CMD或RUN部分中的内容。</span></li> <li><span><code>WORKDIR /app</code>–这为一些其他命令设置工作目录，例如CMD或RUN部分中的命令，这些命令稍后将在other文件中运行。</span></li> <li><span><code>ADD . /app</code>–从当前目录复制所有文件和目录(用。)到<code>/app</code>目录。</span></li> <li><span><code>RUN pip install --trusted-host pypi.python.org -r requirements.txt</code>–这将使用pip和提供的requirements.txt文件安装我们的应用程序的需求。</span></li> <li><span><code>EXPOSE 80</code>–这告诉Docker在运行时监听哪些端口。</span></li> <li><span><code>ENV NAME World</code>–将名为NAME的环境变量设置为World的值。</span></li> <li><span><code>CMD ["python", "app.py"]</code>–设置运行图像时要执行的命令<code>python app.py</code>(运行我们的Flask应用程序所需的命令)</span></li></ol><p><span>现在我们已经确切地了解了这里的内容，让我们创建新的Docker图像。我们将使用:<code>sudo docker build -t cda-flask-app .</code> </span> <span>在本地构建docker映像，然后让我们测试我们的映像。首先，运行<code>curl localhost:80</code>只是为了确保您没有在本地提供任何东西。你什么都没得到？酷，这正是我们想要的。</span> <span>接下来，运行这个命令在本地运行你的Docker镜像<code>sudo docker run -p 80:80 cda-flask-app</code>。现在要么再次运行这个命令:<code>curl localhost:80</code>要么打开一个网页浏览器，在你的网页浏览器的地址栏中输入<code>localhost</code>。</span> <span>你现在应该看到这样的东西:</span> <img loading="lazy" class="alignnone wp-image-9801" src="../Images/f0cf6805a49ca7e554029e3659abdbcb.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs0.png"/> <span>耶！我们在新的容器映像中本地运行我们的站点。</span> <b>步骤3–将我们的图像发送到AWS </b> <span>现在我们将把我们新创建并测试的图像发送到AWS。</span> <span>首先在弹性容器注册表中创建一个存储库:</span> <span> <code>aws ecr create-repository --repository-name cda-penguin-app1123</code> </span> <span>然后运行这个命令来获得一个可以用来登录到您刚刚创建的ECR存储库的命令:</span> <span> <code>aws ecr get-login --region us-east-1 --no-include-email</code> </span> <span>然后将该命令的输出复制并粘贴回终端并运行它。这实际上将向弹性容器存储库验证您的身份，因此您可以将Docker映像放入其中。</span> <span>现在我们已经登录到ECR，我们可以将我们的图像放入ECR。让我们这样做:</span></p><ol> <li><span>通过运行<code>docker image ls</code> </span>确保我们在本地有我们的映像</li> <li><span>通过运行<code>docker tag cda-flask-app:latest ACCT_ID.dkr.ecr.us-east-1.amazonaws.com/</code>(其中account ID是您自己的AWS帐户ID) </span>来标记图像</li> <li><span>使用<code>docker push ACCT_ID.dkr.ecr.us-east-1.amazonaws.com/hello-world</code>将图像上传到AWS ECR(再次使用您自己的AWS帐户ID代替ACCT ID)</span></li></ol><p><span>轰！AWS中应该有一个容器映像。</span> <b>第4步——使用ECS部署我们的web应用程序</b> <span>我们在本地构建的容器映像现在位于AWS cloud中的ECR内。既然我们已经这样做了，我们可以使用同一个容器映像来部署使用Amazon ECS的应用程序。</span> <span>首先，让我们确保可以看到我们在ECR内部部署的图像。我们通过导航到Amazon ECR &gt;仓库下的</span> <a target="_blank" rel="noopener noreferrer" href="https://console.aws.amazon.com/ecs/home?region"> <span> ECS控制台</span> </a> <span>的ECR部分来做到这一点。它应该看起来像这样，尽管您上传的存储库名称和URL可能有一点不同。</span> <img loading="lazy" class="alignnone size-full wp-image-9785" src="../Images/9a8795ef8afd8afd01f05f6b0d51c31c.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs1.png"/> <span>这意味着我们在AWS中存储了应用程序的容器映像，现在我们可以转移到ECS来运行它了！不过，在您这么做之前，让我们确保复制下存储库的URI(我们很快就会需要它)。在AWS控制台中，转到</span> <a target="_blank" rel="noopener noreferrer" href="https://console.aws.amazon.com/ecs/home?region"> <span> ECS部分</span> </a> <span>并导航到集群选项卡。然后按“开始”按钮。</span> <img loading="lazy" class="alignnone size-full wp-image-9787" src="../Images/c826d9bed4e47cac2dbb5eee9fd3e222.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs2.png"/> <span>在下一个屏幕上，您应该看到这个页面:</span> <img loading="lazy" class="alignnone wp-image-9788" src="../Images/1e83b96f2c4bb4d6bf725ccdf02707f5.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs3.png"/> <span>这允许您为您的新服务定义一个容器和任务定义。在同一页面的下方，您需要按“Configure”来设置一个自定义容器:</span> <img loading="lazy" class="alignnone wp-image-9789" src="../Images/c35dfaa366a34c07b1494c655ebd4b49.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs4.png"/> <span>在配置容器定义时，我们需要将“Image*”旁边的框中的值更改为我们从ECR页面复制的图像的URL。这允许我们在容器定义中引用ECR图像。我的URL可能看起来与你的略有不同，因为我给了我的应用程序和容器一个不同的名称，而且我们的AWS帐户id也不同。我们还需要在这个页面上设置一个内存限制——使用128这个硬限制。此外，在按下更新按钮之前，请确保在端口80上添加一个TCP端口映射，如图所示。</span> <img loading="lazy" class="alignnone wp-image-9790" src="../Images/7ceabcbb40f0477ef8f7ee4787aacf08.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs5.png"/> <span>这次更新之后，我们应该准备好进入下一步了。我们不需要对任务定义做任何更改，所以只需按“Next”按钮。</span> <img loading="lazy" class="alignnone wp-image-9791" src="../Images/7a0a147cd6e546168bff0e661cfab595.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs6.png"/> <span>在下一页，我们将定义好容器和任务，实际上也不需要对服务配置进行任何更改。如果这是一个生产应用程序，我们可能希望设置一个负载平衡器。但事实并非如此，所以现在，我们只需按下“下一步”按钮。</span> <img loading="lazy" class="alignnone wp-image-9792" src="../Images/5d9c45e54246c18ab4d35d9e5bedb790.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs7.png"/> <span>然后，如果我们愿意，我们可以通过命名集群并再次按下Next按钮来完成所有工作。</span> <img loading="lazy" class="alignnone wp-image-9793" src="../Images/e753318a41b45311c48b87da64ec4dd5.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs8.png"/> <span>然后，我们将进入一个页面，在实际创建新服务之前，我们可以在这里查看我们的配置。它看起来应该是这样的:</span> <img loading="lazy" class="alignnone wp-image-9794" src="../Images/93867ffc07c53472e7b695d622651043.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs9.png"/> <span>在页面的更下方应该有一个名为Create的蓝色按钮:</span> <img loading="lazy" class="alignnone size-full wp-image-9786" src="../Images/8f225f2c84b5c00818cd98507c707585.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs-9.5.png"/> <span>一旦我们按下它，我们应该会看到AWS开始为新服务创建一堆资源。让它结束，然后按“查看服务”按钮。</span> <img loading="lazy" class="alignnone wp-image-9795" src="../Images/f56a6f434794aea24420d2ab50f06d24.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs10.png"/> <span>我们应该在一个新的屏幕上。如果我们迷路了，我们可以转到ECS控制台，单击正确的群集，然后单击服务，再次找到它。在此页面上，我们单击“任务”选项卡。</span> <img loading="lazy" class="alignnone wp-image-9796" src="../Images/c57e629b4e35356bbcb084f6ae03bd68.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs11.png"/> <span>然后，从tasks选项卡中，我们可以单击为这项新服务运行的任务。</span> <img loading="lazy" class="alignnone wp-image-9797" src="../Images/4aff2e643ff5aad4ed1377d3d7dc3690.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs12.png"/> <span>然后单击ENI Id旁边的ENI ID链接:</span> <img loading="lazy" class="alignnone wp-image-9798" src="../Images/c477644aac89a2126d4d3dda54bd9caf.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs13.png"/> <span>这将把我们重定向到AWS EC2控制台，它应该显示一个实例正在运行。我们可以获取该实例的IPV4 IP地址，并将其粘贴到web浏览器中。</span> <img loading="lazy" class="alignnone wp-image-9799" src="../Images/8d6c14bc3c1a630716831dc7568d2c9d.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs14.png"/> <span>恭喜恭喜！我们刚刚使用AWS、Docker、ECS和Flask部署了一个容器化的应用程序！</span> <img loading="lazy" class="alignnone wp-image-9800" src="../Images/a7773756e2eb3aead1d50220c75d4c14.png" alt="" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/06/ecs15.png"/> <span>现在，我们显然可以配置或更改许多这种流程，以做更酷的事情。例如，我们可以:</span></p><ol> <li>定制Flask应用程序，让它除了显示可爱的企鹅网站之外还能做其他事情</li> <li><span>根据您自己的应用需求，配置使用ECS时可用的许多其他设置</span></li> <li><span>部署大量具有不同需求、其他编程语言和更多的酷容器</span></li></ol><p>但是这已经足够让你开始了！如果您想观看视频形式的演示，并在Linux Academy的现场环境中进行测试，请注册Linux Academy并查看包含实际操作环境的 <span> <a target="_blank" rel="noopener noreferrer" href="https://linuxacademy.com/amazon-web-services/training/course/name/aws-certified-developer-associate-2018"> AWS认证开发人员助理级别准备课程</a>、</span> <span>！</span></p></div></div>    
</body>
</html>