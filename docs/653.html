<html>
<head>
<title>How to use SCP and SSH Linux Commands | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用SCP和SSH Linux命令</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/ssh-and-scp-howto-tips-tricks#0001-01-01">https://acloudguru.com/blog/engineering/ssh-and-scp-howto-tips-tricks#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>本教程还记录了Linux命令之间的一些重要差异。</p><p>Linux就业市场继续增长和扩大，我们的<a href="https://acloudguru.com/course/linux-foundation-certified-system-administrator-lfcs"> LFCS </a>课程将帮助你准备一个标准的行业Linux管理认证。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-accelerate-your-career">加速您的职业发展</h2><p class="has-text-align-center"><a href="https://acloudguru.com/pricing">从ACG开始</a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室改变你的职业生涯。</p><p/><hr class="wp-block-separator"/><p>难度:<strong> <em>基础</em> </strong></p><p>在我们开始之前:在本教程中，你将会遇到ssh和SSH。区别在于:ssh是通用协议，SSH是linux SSH客户端命令。</p><p><a name="scp"/> SCP命令</p><h2 id="h-scp-command">scp命令允许您通过ssh连接复制文件。如果你想在计算机之间传输文件，例如备份一些东西，这是非常有用的。scp命令使用ssh命令，它们非常相似。然而，有一些重要的区别。</h2><p>如何使用SCP</p><h3 id="h-how-to-use-scp">从(远程)服务器拷贝到您的电脑</h3><ol><li>从您的电脑拷贝到(远程)服务器</li><li>从一台(远程)服务器复制到另一台(远程)服务器</li><li>在第三种情况下，数据直接在服务器之间传输；你自己的电脑只会告诉服务器做什么。</li></ol><p>这些选项对于许多需要传输文件的事情非常有用，所以让我们来看看这个命令的语法:</p><p>上面的scp命令会将文件“examplefile”传输到服务器“yourserver”上的目录“/home/yourusername/”，尝试使用用户名“yourusername”获得ssh访问。这是相当多的信息，但scp真的需要全部。嗯，几乎全部。您可以省略“您的服务器”前面的“您的用户名@ ”,但前提是您想在自己的计算机上使用当前用户名登录服务器。</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp examplefile yourusername@yourserver:/home/yourusername/</code></pre><p>让我们仔细看看命令的结尾。那边有个冒号，后面有个目录。就像Linux的普通cp命令一样，scp需要知道源文件和目标目录(或文件)。对于远程主机，文件/目录以这种方式提供给scp命令。您也可以将一个(或多个)文件从(远程)服务器复制到您自己的本地计算机上。让我们来看一个例子:</p><p><em>注意:末尾的点表示当前的本地目录。这是一个方便的技巧，可以在Linux的任何地方使用。除了单点之外，您还可以键入双点(..)，是当前目录的父目录。</em></p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp yourusername@yourserver:/home/yourusername/examplefile .</code></pre><p>这将把文件“/home/yourusername/examplefile”复制到您自己计算机上的当前目录中，前提是用户名和密码是正确的，并且该文件确实存在。您可能已经猜到，以下命令将文件从一台(远程)服务器复制到另一台(远程)服务器:</p><p><em>注意:要使上面的命令工作，服务器必须能够互相连接，因为数据将在它们之间直接传输。</em></p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp yourusername@yourserver:/home/yourusername/examplefile yourusername2@yourserver2:/home/yourusername2/</code></pre><p>如果服务器由于某种原因不能互相连接(例如，如果端口22在一端没有打开)，你将不能复制任何东西。在这种情况下，首先将文件复制到您自己的计算机上，然后复制到另一台主机上。或者使服务器能够彼此联系(例如通过打开端口)。这些是scp的主要用途。</p><p>我们将更深入地讨论ssh和scp之间的区别。实际上，您也可以像普通的cp命令一样使用它，而不需要任何ssh连接，但这完全没有用。它要求你多打一个“s”。</p><p><a name="specifying-a-port-with-scp"/>用scp指定端口</p><h2 id="h-specifying-a-port-with-scp">当涉及到端口时，scp命令的行为稍有不同。您可能认为应该这样指定端口:</h2><p>然而，这是行不通的。您将会看到如下错误消息:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp -p yourport yourusername@yourserver:/home/yourusername/examplefile .</code></pre><p>这是由scp的不同架构造成的。它的目标是类似于cp，cp也有-p选项。然而，在cp术语中，它的意思是“保存”，它使cp命令保存诸如所有权、许可和创建日期之类的东西。</p><pre class="wp-block-code"><code>cp: cannot stat `yourport': No such file or directory</code></pre><p>scp命令也可以保存类似的东西，并且-p选项启用了这个特性。应该使用-P选项指定端口。因此，以下命令将起作用:</p><p>还要注意-P选项<em>必须</em>在(远程)服务器的前面。</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp -P yourport yourusername@yourserver:/home/yourusername/examplefile .</code></pre><p>如果您在主机语法后面加上-p，ssh命令仍然可以工作，但是scp不行。为什么？因为scp也支持两个服务器之间的复制，因此需要知道“-P”选项适用于哪个服务器。</p><p><a name="ssh"/> SSH命令</p><h2 id="h-ssh-command">SSH是某种安全SHell的缩写。这是一种允许计算机之间安全连接的协议。</h2><p>在本教程中，我们将处理Linux上的ssh命令，OpenSSH版本。今天，大多数Linux发行版都有OpenSSH客户端的特性，但是如果你想确定的话，可以看看你的系统上的SSH联机帮助页。您可以通过键入以下命令来完成此操作:</p><p><em>注意:这应该在终端中完成。</em></p><pre class="wp-block-code"><code>[pinehead@localhost ~]$ man ssh</code></pre><p>如果它显示如下内容:</p><p>那么您可以非常确定您运行的是OpenSSH版本。有关SSH的更多背景信息，请参见<a title="Wikipedia's page about SSH" href="https://en.wikipedia.org/wiki/SSH">https://en.wikipedia.org/wiki/SSH</a>。</p><pre class="wp-block-code"><code>NAMEssh - OpenSSH SSH client (remote login program)</code></pre><p><a name="the-most-simple-case"/>最简单的例子</p><h4 id="h-the-most-simple-case">在最简单的情况下，您可以使用如下语法连接到支持ssh的服务器:</h4><p>注意:如果您附近没有可以访问的ssh服务器，您也可以使用自己的计算机作为服务器来尝试这个命令。为此，请将“yourserver”替换为“localhost”。当然，您的服务器应该替换为您想要连接的服务器的主机名或ip地址。</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh yourserver</code></pre><p>正如您在终端代码片段中看到的，我以pineehad的身份登录。如果您不指定用户名(我将在本教程的后面解释如何做)，SSH将假设您希望使用当前登录的用户名登录。因此，在这种情况下，SSH将尝试用户名pineehad。当然，您需要确保服务器支持ssh连接。</p><p>ssh客户端尝试连接到默认的端口22。这意味着，如果您想要使用默认设置连接到远程主机，您应该确保端口22(如果适用)被转发到您尝试连接的服务器。在本教程中，您将找到更多关于SSH端口的内容。</p><p>现在，回到我们运行的命令。如果服务器支持ssh连接，并且您可以通过端口22访问它，则应该提示您输入密码(如果这是您第一次尝试连接服务器，SSH将首先询问您是否要继续连接，通常只需回答“是”)。如果您在此处键入密码，您将不会看到星号出现。不要惊慌，这是宋承宪的正常行为。这使得使用ssh连接更加安全，因为任何偶然的旁观者都无法看到密码的长度。</p><p>输入密码后，如果用户名和密码正确，您应该在服务器上运行shell。如果没有，请确保您正在连接的服务器知道您应该能够使用您的用户名和指定的密码登录。您可以尝试连接到您自己的计算机(参见终端引用下面的注释),或者继续阅读以了解如何指定另一个用户名。尝试完ssh shell后，可以通过按Ctrl + D退出它。</p><p><a name="specifying-a-username"/>指定用户名</p><h2 id="h-specifying-a-username">指定不同的用户名其实很简单。你可能已经很熟悉它了。请参见以下示例:</h2><p>以上将使ssh尝试使用用户名“yourusername”连接，而不是(在我的例子中)pineehad。许多其他协议也使用这种语法，所以了解它总是很方便的。</p><pre class="wp-block-code"><code>[pinehead@localhost ~]$ ssh yourusername@yourserver</code></pre><p>顺便说一下，您仍然会被要求输入密码。出于安全原因，甚至不可能在语法中直接指定密码。除非您开始以高级方式配置服务器，否则您总是会被交互地询问(这正是该主题超出本教程范围的原因:本教程记录了如何使用客户机，而不是如何配置服务器)。</p><p>将ssh服务移动到另一个端口</p><h2 id="h-move-the-ssh-service-to-an-other-port">将ssh服务转移到另一个端口有很多原因。其中之一是避免暴力登录尝试。某些黑客试图通过使用普通密码尝试许多普通用户名来访问ssh服务器(想想密码为“doe”的用户“john”)。</h2><p>尽管这些黑客不太可能访问系统，但是暴力攻击的另一个方面是您通常希望避免的:系统和连接负载。暴力攻击通常在一秒钟内进行几十次甚至几千次，这不必要地降低了服务器的速度，占用了一些本可以更好地使用的带宽。</p><p>通过将端口更改为非默认端口，黑客的脚本将被拒绝，大部分带宽将被节省。由于ssh命令不能猜测端口，如果它不是默认的22端口，我们就必须指定它。你可以这样做:</p><p>当然，您必须用端口号替换“yourport”。这是ssh和scp在这一点上的重要区别。我将进一步解释它。</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh -p yourport yourusername@yourserver</code></pre><p><a name="running-a-command-on-the-remote-server"/>在远程服务器上运行命令</p><h2 id="h-running-a-command-on-the-remote-server">有时，尤其是在脚本中，您会想要连接到远程服务器，运行一个命令，然后再次退出。ssh命令有一个很好的特性。您可以在选项username和hostname后指定命令。看看这个:</h2><p>这将使服务器更新其搜索数据库。当然，这是一个非常简单的命令，没有参数。如果你想告诉别人你在网上读到的最新消息，该怎么办？你可能认为下面的话会给他/她传达这样的信息:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh yourusername@yourserver updatedb</code></pre><p>然而，如果您运行这个命令，bash会给出一个错误:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh yourusername@yourserver wall "Hey, I just found out something great! Have a look at www.examplenewslink.com!"</code></pre><p>发生了什么事？Bash(你的shell后面的程序)试图解释你想给ssh的命令。这会失败，因为命令中有感叹号，bash会将其解释为应该启动bash函数的特殊字符。</p><pre class="wp-block-code"><code>bash: !": event not found</code></pre><p>但是我们不希望这样，我们只是希望bash把命令交给ssh！有一个非常简单的方法可以告诉bash不要担心命令的内容，只需将它传递给ssh即可:用单引号将它括起来。看看这个:</p><p>单引号防止bash试图解释该命令，因此ssh接收该命令，不做任何修改，并可以将其发送给服务器。不要忘记单引号应该出现在整个命令中，而不是其他地方。</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh yourusername@yourserver 'wall "Hey, I just found out something great! Have a look at www.examplenewslink.com!"'</code></pre><p><a name="another-difference-between-scp-and-ssh"/>SCP和SSH的区别</p><h2 id="h-differences-between-scp-and-ssh">与ssh不同，scp不能用于在(远程)服务器上运行命令，因为它已经使用ssh的这个特性来启动主机上的scp服务器。scp命令确实有一个接受程序的选项(-S选项),但是这个程序将用于代替ssh来建立加密连接，并且不会在远程主机上执行。</h2><p><a name="tips-tricks-with-ssh-and-scp"/>技巧&amp;使用SCP和SSH的技巧</p><h2 id="h-tips-tricks-with-scp-and-ssh">scp的一个很方便的地方是它支持星号。您可以通过以下方式复制远程目录中的所有文件:</h2><p>您也可以通过指定-r(递归)选项来复制整个目录:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp yourusername@yourserver:/home/yourusername/* .</code></pre><p>当复制到一个(远程)服务器或在一个(远程)服务器和另一个(远程)服务器之间复制时，这两种方法都有效。如果您不知道要用scp复制的文件的确切位置，ssh命令就可以派上用场。首先，到(远程)服务器的ssh:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ scp -r yourusername@yourserver:/home/yourusername/ .</code></pre><p>然后用cd浏览到正确的目录。这是必不可少的Linux终端知识，这里就不解释了。当您在正确的目录中时，您可以使用以下命令获得完整路径:</p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ ssh yourusername@yourserver</code></pre><p><em>注意:pwd是Print Working Directory的缩写，这是一种记忆命令的有用方法。</em></p><pre class="wp-block-code"><code>[pineehad@localhost ~]$ pwd</code></pre><p>然后，您可以复制这个输出，通过按Ctrl + D离开ssh shell，然后在scp命令中粘贴完整的目录路径。这样就省去了很多记忆和打字！</p><p>您还可以限制scp在复制时可能使用的带宽。如果你想拷贝大量的数据，而又不想长时间受网速慢的困扰，这是非常有用的。限制带宽是这样实现的:</p><p>带宽以千比特/秒为单位。这是什么意思？八位是一个字节。如果您希望复制速度不超过10千字节/秒，请将该限制设置为80。如果您希望复制速度不超过80千字节/秒，请将该限制设置为640。明白了吗？您应该将该限制设置为您希望的最大千字节/秒的八倍。</p><pre class="wp-block-code"><code>scp -l bandwidthlimit yourusername@yourserver:/home/yourusername/* .</code></pre><p>我建议您对其他人也需要使用的连接设置-l选项。如果你使用集线器，大量的拷贝会阻塞整个10兆比特的网络。</p><p>提升您的云计算职业生涯</p><hr class="wp-block-separator has-text-color has-background has-indigo-background-color has-indigo-color is-style-wide"/><h2 class="has-text-align-center has-indigo-color has-text-color" id="h-level-up-your-cloud-career">无论您是云新手还是专家，云专家都能让您轻松(而且非常棒)地获得认证并掌握现代技术技能。查看我们当前的<a href="https://acloudguru.com/blog/news/whats-free-at-acg"> <strong>免费云课程</strong> </a>或通过免费试用提升您的<a href="https://acloudguru.com/platform/training-paths"> <strong>云和it职业道路</strong> </a>。</h2><p class="has-text-align-center has-black-color has-text-color"><a name="final-words"/>最后的话</p><hr class="wp-block-separator has-text-color has-background has-indigo-background-color has-indigo-color is-style-wide"/><h2 id="h-final-words">好吧，就是这样！我希望你学到了很多。当然，如果你忘记了什么，你可以再快速浏览一下这个教程。请告诉其他可能对本教程感兴趣的人，如果你这样做，你将有助于这个博客的发展=)。感谢您的阅读，并与您的新知识有很多乐趣！</h2><p>Well, that was it! I hope you learned a lot. Of course, you can always have a quick look at this tutorial again if you forgot something. Please tell other people who might be interested about this tutorial, you’ll help this blog to grow if you do =). Thank you for reading and have a lot of fun with your new knowledge!</p></div></div>    
</body>
</html>