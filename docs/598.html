<html>
<head>
<title>NoSQL Comparison: Cosmos DB vs DynamoDB vs Cloud Datastore and Bigtable | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>NoSQL比较:Cosmos DB vs dynamo DB vs Cloud Datastore和Bigtable |云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/comparing-cloud-nosql-databases-dynamodb-vs-cosmos-db-vs-cloud-datastore-and-bigtable#0001-01-01">https://acloudguru.com/blog/engineering/comparing-cloud-nosql-databases-dynamodb-vs-cosmos-db-vs-cloud-datastore-and-bigtable#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><h3 id="h-which-nosql-database-service-is-the-best">NoSQL哪个数据库服务最好？</h3><p>哪只NoSQL DB是山羊？看看在AWS DynamoDB与GCP云数据存储和Bigtable与Azure Cosmos DB之间，哪个数据库服务在所有云中占主导地位。请继续阅读！</p><h4 id="h-the-tl-dr">TL；速度三角形定位法(dead reckoning)</h4><p>现代应用程序开发的前景已经发生了变化。在云平台出现(和广泛使用)之前，一切都可以用有限的术语来思考。通常有固定的可用计算资源池、有限的带宽和可预测的流量。</p><p>这一切都变了。</p><p>大量的计算、存储和带宽可以通过几次点击或API调用来承担。开发人员现在面临的挑战是如何管理数据，因为现代应用程序堆栈拥有大量数据，并且总是在产生更多数据。</p><h2 id="h-nosql-vs-relational-databases">NoSQL与关系数据库</h2><p>MySQL、PostgreSQL等关系数据库以及微软和甲骨文等公司的企业产品长期以来一直是数据存储的主流。然而，它们有其局限性。不灵活的模式和众所周知的困难的水平扩展意味着它们并不总是很好地适应高度可扩展和地理上分散的基础设施堆栈。</p><p>开发NoSQL数据库技术的目的是为传统关系数据库在大规模应用中出现的问题提供一种替代方案。NoSQL数据库可以有效地扩展，并且在包含的数据结构类型上更加灵活。</p><p>本文将研究亚马逊网络服务(AWS)、微软Azure和谷歌云(GCP)的主要NoSQL产品。</p><p>首先，将提供NoSQL与SQL在技术方面的一些额外深度，以及选择NoSQL作为数据存储的潜在好处。</p><p/><hr class="wp-block-separator"/><p class="has-text-align-center"><em>对升级或开始云数据之旅感兴趣吗？云专家的<a href="https://acloudguru.com/learning-paths/aws-data"> AWS数据学习路径</a>提供适合初学者和高级专家的定制课程！</em></p><hr class="wp-block-separator"/><h2 id="h-nosql-database-pricing-comparison">NoSQL数据库价格比较</h2><figure class="wp-block-table is-style-stripes"/><p class="has-text-align-center"><a href="https://get.acloudguru.com/nosql-for-grownups-dynamodb-webinar"> <strong>成年人的NoSQL:DynamoDB单表建模与里克·霍利汉</strong> <br/> </a>在<a href="https://get.acloudguru.com/nosql-for-grownups-dynamodb-webinar">这个免费的点播网络研讨会</a>中，里克·霍利汉，AWS的高级实践经理和单表DynamoDB设计的发明者，展示了他在dynamo db中建模复杂数据访问模式的技巧。</p><hr class="wp-block-separator"/><h2 id="h-nosql-adoption-background">NoSQL领养背景</h2><p>为了理解是什么推动了NoSQL的采用，理解关系数据库与典型的NoSQL数据库相比是如何工作的，以及一些潜在的限制可能是有帮助的。正如在简介中提到的，主要的摩擦点围绕着模式和伸缩性。</p><p>通常，NoSQL数据库被认为是基于<a href="https://www.mongodb.com/document-databases" target="_blank" rel="noreferrer noopener">“document”</a>的——数据松散地存储在包含各种数据结构的文档中。在关系数据库中，数据存储在一个由行和列组成的表中，用一个模式严格定义。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><em>在ACG的这个课程中，学习使用<a href="https://acloudguru.com/course/amazon-dynamodb-deep-dive"> AWS DynamoDB </a>构建可扩展的高性能应用。</em></p><hr class="wp-block-separator"/><p>模式定义了数据库的“是什么”。在一个假设的个人数据库的关系模型中，它告诉用户第一列数据可能是“名字”，第二列是“姓氏”，第三列是“年龄”，依此类推。每行数据代表一个人。该模式或数据映射定义了如何将数据写入数据库。</p><p>如果决定需要添加一个“最喜欢的糖果”栏，该怎么办？在大多数情况下，必须进行高成本的操作工作来定义和更新模式，包括存储其副本的任何系统，以及潜在的高成本数据库停机时间。相比之下，基于文档的NoSQL模型允许应用程序几乎不受限制地更改和变异数据。</p><p>缩放是NoSQL大放异彩的故事的第二部分。如果没有复杂的编排，关系数据库很难扩展，维护具有高写吞吐量的高可伸缩、高可用的关系数据库集群是一个不小的工程挑战。AWS、Azure和GCP的主要NoSQL产品能够扩展到潜在的数十亿次每日交易，管理基础设施的运营开销几乎完全由提供商处理。</p><h2 id="h-nosql-pricing-and-service-limits">NoSQL定价和服务限制</h2><p>卓越NoSQL产品的定价在很大程度上取决于如何定义使用指标。每个提供商都根据不同的指标来衡量使用情况，包括明确的和基于时间的衡量标准。AWS提供了可能是定义这些指标的最佳口语，本文将统称为“计费单位”。</p><p>这是所有提供商共有的，也是客户经常遇到的问题:网络和带宽的使用是与基础服务分开收费的。从任何这些服务中传输大量数据都可能在账单上产生不小的费用，这与使用是分开的。</p><p><a href="https://aws.amazon.com/dynamodb/pricing/on-demand/" target="_blank" rel="noreferrer noopener"> AWS </a>的主要计费单位是“写请求单位”和“读请求单位”，代表从DynamoDB 表中写入或<a href="https://acloudguru.com/course/amazon-dynamodb-deep-dive">读取数据的请求。AWS还对其他功能收费，如备份、全局复制、流式传输和网络出口。一个</a><a href="https://acloudguru.com/hands-on-labs/enable-ipv6-on-a-vpc-with-a-private-subnet-and-egress-only-internet-gateway">仅出口互联网网关</a>用于启用从您的VPC中的实例到互联网的IPv6出站通信，并防止您的VPC之外的主机发起与您的实例的IPv6连接。</p><p>GCP在NoSQL的两个主要产品是Bigtable和数据存储模式的Firestore。数据存储服务是一种传统的基于文档的NoSQL服务，它围绕使用构建计费单位<a href="https://cloud.google.com/datastore/pricing" target="_blank" rel="noreferrer noopener">:“实体”读取、写入和删除作为单独的操作计费，数据存储、</a><a href="https://cloud.google.com/datastore/pricing#small_operations" target="_blank" rel="noreferrer noopener">小型操作</a>和网络出口也是如此。在撰写本文时，Google正计划在2021年将Datastore的用户转移到Firestore的Datastore模式，其中使用计费将对象建模为“文档”。这篇<a href="https://cloud.google.com/datastore/docs/concepts/overview#comparison_with_traditional_databases" target="_blank" rel="noreferrer noopener">文章提供了更多关于这两者区别的细节。数据存储也有每月免费使用的配额。Bigtable </a><a href="https://cloud.google.com/bigtable/pricing" target="_blank" rel="noreferrer noopener">围绕Bigtable集群中底层节点的每小时使用情况以及存储、备份和网络出口来构建计费单位</a>。还需要注意的是，虽然使用是基于调配的容量，但是在Bigtable实例上有强制的配额和限制。</p><p>Azure Cosmos DB 为<a href="https://azure.microsoft.com/en-us/pricing/details/cosmos-db/?cdn=disable" target="_blank" rel="noreferrer noopener">提供了两种计费模式</a>供客户选择:供应吞吐量和无服务器。(参见我们在<a href="https://acloudguru.com/blog/engineering/azure-cosmos-db-apis-use-cases-and-trade-offs" target="_blank" rel="noreferrer noopener">Azure Cosmos DB API及其用例与权衡</a>上的帖子，深入了解Cosmos DB的实践。)</p><p>调配的吞吐量以每秒请求单位和每小时账单来衡量使用情况。客户也可以按年或按年预付调配的容量。此外，存储和网络出口也要收费。</p><p>在无服务器模式中，客户只需为发生的使用付费，这更适合不一致的突发工作负载。</p><hr class="wp-block-separator"/><p class="has-text-align-center"><em>在这9小时的课程中，一位云计算大师将深入探讨<a href="https://acloudguru.com/course/azure-cosmos-db-deep-dive"> Azure Cosmos DB </a>。</em></p><hr class="wp-block-separator"/><p>无论是关系数据库还是NoSQL数据库，任何类型的大规模数据库部署都会很快给任何组织带来可观的成本。NoSQL的优势之一应该是显而易见的:三个提供商都提供“按需”，基于使用的计费。客户将只承担实际使用的费用，而不会承担调配使用带来的更高的低效率成本。</p><p>下表重点介绍了三大巨头在定价和配额方面的一些更细微的差异:</p><figure class="wp-block-table is-style-stripes"><table><thead><tr><th><strong>服务* </strong></th><th><strong>计费单位</strong></th><th><strong>成本** </strong></th></tr></thead><tbody><tr><td><strong>写入(已调配)*** </strong></td><td>AWS DynamoDB</td><td>写容量单位(WCU)</td></tr><tr><td>25 WCUs月免费，0.00065美元WCUs小时</td></tr><tr><td>GCP大表</td><td>节点小时</td><td>每个节点0.65美元/小时，使用受限于<a href="https://cloud.google.com/bigtable/quotas" target="_blank" rel="noreferrer noopener">配额/限制</a></td></tr><tr><td>azure Cosmos DB–单区域写入帐户</td><td>请求单位(RU)</td><td>400 RU/s/月免费<br/>自动缩放:100 RU/s x 1.5 x 1区域-0.008美元/小时<br/>手动:100 RU/s x 1区域-0.008美元/小时</td></tr><tr><td><strong>写入(按需)*** </strong></td><td>AWS DynamoDB</td><td>写请求单元</td></tr><tr><td>125万美元/100万个写请求单元</td></tr><tr><td>数据存储模式下的gcp风暴</td><td>实体写入/文档写入</td><td>每天20000次实体写入，每100，000份文档0.099美元</td></tr><tr><td>azure Cosmos DB–无服务器</td><td>请求单位(RU)</td><td>25万美元/10万俄罗斯联邦</td></tr><tr><td><strong>读取(已配置)*** </strong></td><td>AWS DynamoDB</td><td>读取容量单位(RCU)</td></tr><tr><td>25个区域协调单位/月免费，0.00013美元RCUs小时</td></tr><tr><td>GCP大表</td><td>节点小时</td><td>每个节点每小时0.65美元，使用受限于<a href="https://cloud.google.com/bigtable/quotas" target="_blank" rel="noreferrer noopener">配额/限制</a></td></tr><tr><td>azure Cosmos DB–单区域写入帐户</td><td>请求单位(RU)</td><td>400 RU/s/月免费<br/>自动缩放:100 RU/s x 1.5 x 1区域-0.008美元/小时<br/>手动:100 RU/s x 1区域-0.008美元/小时</td></tr><tr><td><strong>读取(按需)*** </strong></td><td>DynamoDB</td><td>读取请求单元</td></tr><tr><td>25万美元/10万个读取请求单元</td></tr><tr><td>数据存储模式下的gcp风暴</td><td>节点小时</td><td>每个节点0.65美元/小时，使用受限于<a href="https://cloud.google.com/bigtable/quotas" target="_blank" rel="noreferrer noopener">配额/限制</a></td></tr><tr><td>azure Cosmos DB–无服务器</td><td>请求单位(RU)</td><td>25万美元/10万俄罗斯联邦</td></tr><tr><td><strong>备份*** </strong></td><td>AWS DynamoDB</td><td>千兆字节</td></tr><tr><td>连续备份(PITR):0.20美元/GB/月<br/>按需备份:0.10美元/GB/月<br/>恢复:0.15美元/GB</td></tr><tr><td>GCP大表</td><td>千兆字节</td><td>每GB/月0.029美元</td></tr><tr><td>天蓝色宇宙数据库</td><td>千兆字节</td><td>定期备份:免费2份，&gt; 2份每份0.12美元/GB<br/>连续备份:0.20美元/GB x区域<br/>时间点恢复:0.15美元/GB</td></tr><tr><td><strong>存储</strong></td><td>AWS DynamoDB</td><td>千兆字节</td></tr><tr><td>25GB/月免费，每GB/月0.25美元</td></tr><tr><td>GCP Bigtable<br/><br/>GCP Firestore处于数据存储模式</td><td>千兆字节</td><td>固态硬盘存储:每GB/月0.19美元<br/>硬盘存储:每GB/月0.029美元<br/>T2:每GB/月0.099美元</td></tr><tr><td>天蓝色宇宙数据库</td><td>千兆字节</td><td>事务存储(面向行):0.25美元/GB/月<br/>分析存储(面向列):0.03美元/GB/月</td></tr><tr><td><strong>复制(已调配)</strong></td><td>AWS DynamoDB</td><td>复制写容量单元(rWCU)</td></tr><tr><td>每rWCU/小时0.000975美元</td></tr><tr><td>GCP大表</td><td>千兆字节</td><td><a href="https://cloud.google.com/bigtable/pricing#network" target="_blank" rel="noreferrer noopener">受互联网出口费率限制</a></td></tr><tr><td>天蓝色宇宙数据库</td><td>请求单位(RU)</td><td>自动缩放:<br/>数据跨多个区域分布的单区域写帐户(有或没有可用性区域):100 RU/秒x 1.5 x N个区域-0.008美元/小时<br/>跨多个区域分布的多区域写帐户(以前称为多主机):100 RU/秒x N个区域-0.016美元/小时<br/>标准:<br/>跨N个区域分布的单区域写帐户(不包括可用性区域):100 RU/秒x N个区域-0.008美元/小时【T4 对于使用可用性区域的地区:100 RU/s x 1.25 x N个区域-0.008美元/小时<br/>具有N个区域的多区域写入(以前称为“多主机”)帐户<sup> * </sup>(有或没有可用性区域):100 RU/s x N个区域-0.016美元/小时</td></tr><tr><td><strong>复制(按需)</strong></td><td>AWS DynamoDB</td><td>复制写请求单元</td></tr><tr><td>187.5万美元/100万个复制写请求单元</td></tr><tr><td>数据存储模式下的gcp风暴</td><td>记录操作</td><td><a href="https://cloud.google.com/datastore/pricing#multi-region_location_pricing">单地区价格乘数</a></td></tr><tr><td>azure Cosmos DB–无服务器</td><td>请求单位(RU)</td><td>1.25 x N个地区x 25美元/100万俄罗斯联邦</td></tr><tr><td>* <em>此表并未全面列出每个提供商的计费功能。它的主要目的是提供通用特性的高级比较。</em></td><td><em> **每个提供商的费用可能因地区而异。请查看本文前面提供的特定地区的具体费用链接。除非特别说明，此处使用美国东海岸/北美。</em></td><td><em> *** GCP Bigtable仅提供调配使用和备份，而数据存储模式下的Firestore仅提供按需使用计费，不提供备份。</em></td></tr></tbody></table></figure><p class="has-text-align-center"><a href="https://get.acloudguru.com/cloud-dictionary-of-pain"> <strong>获得痛苦的云词典</strong> </a> <br/>说云不一定要努力。我们分析了数以百万计的回复，找出了最容易让人犯错的概念。抓住这个<a href="https://get.acloudguru.com/cloud-dictionary-of-pain" target="_blank" rel="noreferrer noopener">云指南</a>获取一些最痛苦的云术语<a>的简洁定义。</a></p><p class="has-text-align-center">尽管计费单位术语不同，这三个提供商之间的定价相当一致。从功能和价格角度来看，NoSQL数据库服务的日益普及和需求导致了一个竞争激烈的市场。每个提供商不仅希望从竞争对手那里夺取市场份额，还希望从MongoDB和Hadoop等第三方解决方案那里夺取市场份额。</p><p class="has-text-align-center">(如果你能流利地使用AWS，并想了解Azure的基础知识，请查看我们的微软Azure用户指南。)</p><hr class="wp-block-separator"/><p class="has-text-align-center">下一节将比较每种产品的特性、性能和潜在使用案例。</p><hr class="wp-block-separator"/><p>AWS、Azure和GCP NoSQL功能比较</p><p>评估给定NoSQL解决方案的性能和功能集在很大程度上取决于环境:存储的是什么类型的数据？这些数据是如何构建的？需要什么样的表现？工作负载是一致的，还是突发的？</p><p>描述复杂数据存储及其端到端用例的所有技术复杂性和细微差别可以写好几本书(现在已经写了)。相反，本节将尝试将最重要的考虑事项提炼为高层次的类别:典型用例、数据模型和查询、假设用例的价格效率，以及每个提供者如何处理一致性。</p><h2 id="h-aws-azure-and-gcp-nosql-feature-comparisons">NoSQL是用来做什么的？</h2><p>正如在开篇中所讨论的，NoSQL的一般用例是关系数据库通常不足的地方:水平伸缩和非结构化数据。应用程序开发人员可以自由地利用编程数据结构来编写和查询数据，避免僵化的SQL模式逻辑。通过提供商提供的托管服务解决方案，精益开发团队可以利用高度可伸缩的解决方案，而没有维护基础设施的运营开销。</p><p><strong>服务</strong></p><h2 id="h-what-is-nosql-used-for"><strong>用例</strong></h2><p><strong> AWS DynamoDB </strong></p><figure class="wp-block-table is-style-stripes"><table><thead><tr><th>广告技术、游戏、零售、银行和金融、媒体和娱乐、软件和互联网</th><th><strong> GCP大表</strong></th></tr></thead><tbody><tr><td>金融分析、物联网、广告技术</td><td><strong>数据存储模式下的GCP Firestore</strong></td></tr><tr><td>需要高度可伸缩、易于使用的NoSQL文档数据库的应用程序开发人员</td><td>蔚蓝宇宙数据库</td></tr><tr><td>关键任务应用、混合Cassandra工作负载、近实时分析、实时物联网设备遥测、实时零售服务</td><td>此表强调了每种服务的各种用例之间的一些共性。</td></tr><tr><td>当组织需要能够处理大量读写事务的高性能解决方案时，NoSQL大放异彩，这些事务可能涉及非结构化和不断变化的数据。然而，需要考虑的重要一点是，虽然提供者列举的一般用例之间存在重叠，但是每个实现的底层技术细节都有一些关键差异。</td><td>例如，虽然DynamoDB和Bigtable共享财务分析作为用例，但它们处理和存储数据的方式不同。DynamoDB将数据建模为键值和文档，而Bigtable是一个宽列存储。对于低吞吐量的用例，这种区别最终可能是微不足道的。当架构必须扩展到每天数十亿次交易时，数据模型的选择变得至关重要。</td></tr></tbody></table></figure><p>NoSQL:模式、数据和查询</p><p>虽然NoSQL没有关系数据库的传统模式，但这并不意味着工程团队可以避免规划实现。相反，有效地使用NoSQL要求密切关注将要读写的数据类型，也许最重要的是，下游用户最有可能运行的查询类型。</p><p>一些人可能会认为这是NoSQL在技术上实施“模式”的地方:开发人员通常需要提前知道潜在查询的结构，否则他们可能会遇到大规模的性能问题。</p><h3 id="h-nosql-schema-data-and-queries"><strong>服务</strong></h3><p><strong>数据模型</strong></p><p><strong>支持的数据类型</strong></p><figure class="wp-block-table is-style-stripes"><table><thead><tr><th><strong> AWS DynamoDB </strong></th><th>键值，文档</th><th>标量:数字、字符串、二进制、布尔、空值<br/>文档:列表、映射<br/>集合:字符串集合、数字集合、二进制集合</th></tr></thead><tbody><tr><td><strong> GCP大表</strong></td><td>宽列存储</td><td><a href="https://cloud.google.com/bigtable/docs/overview#data-types" target="_blank" rel="noreferrer noopener">所有数据通常被视为原始字节串</a></td></tr><tr><td><strong>数据存储模式下的GCP Firestore</strong></td><td>数据存储:数据存储模式下的键值Firestore:文档</td><td>数组、布尔值、字节、数据/时间、浮点数、地理点、整数、地图、空值、引用、文本字符串</td></tr><tr><td>蔚蓝宇宙数据库</td><td>键值、文档、图形、列</td><td><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.azure.documents.document?view=azure-dotnet" target="_blank" rel="noreferrer noopener">凡是可以序列化为有效JSON的</a></td></tr><tr><td>为了理解每个服务可能如何处理潜在的数据和查询，理解它们如何建模数据将是有帮助的。NoSQL数据库的底层数据模型是任何有意义的数据基础设施的规划和设计的关键部分。</td><td>关键值数据库</td><td><a href="https://en.wikipedia.org/wiki/Key%E2%80%93value_database" target="_blank" rel="noreferrer noopener">键值数据库(有时称为存储)</a>通过利用关联数组来存储数据。大多数开发人员可能都熟悉关联数组的底层数据结构:字典或哈希表。数据存储为成对的键和值。键用于唯一标识存储在值中的数据。值可以是简单的数据类型，如字符串、布尔值或整数，也可以是完整的JSON结构。</td></tr></tbody></table></figure><p>一个简单的例子，使用Python字典:</p><h4 id="h-key-value-databases"><code>{"user1": "jsmith", "user2": "kjackson"}</code></h4><p>查询像“user1”这样的键会产生值“jsmith”，“user2”代表“kjackson”等等。一个更复杂的例子，值是一个JSON对象:</p><p><code>{"user1": {"name": "John Smith", "userID": "jsmith"}, "user2": {"name": "Karen Jackson", "userID": "kjackson"}}</code></p><p>查询“user1”键将返回JSON对象作为值。由查询作者开发额外的逻辑来解析对象内部的字段。</p><p>DynamoDB、Datastore和Azure Cosmos DB都提供键值作为存储数据的潜在数据模型。当存储的数据和访问模式相当简单时，如缓存或为网站用户存储会话数据，键值存储是高性能的。</p><p>文档数据库</p><p>当讨论NoSQL时，人们通常会想到文档数据库。在文档模型中，数据以一种键-值模型的形式存在:惟一的id标识值，这些值是半结构化的文档，通常以JSON对象为模型。AWS提供了一个简单的假设文档的例子，这个文档描述了一本书。开发人员通常用给定的语言形成查询，搜索特定的关键字，然后进一步解析返回的文档。然而，与键值存储相比，文档数据对象具有某种结构，并且通常为文档中的各种对象和字段提供元数据关联。</p><p>数据存储模式下的Firestore、Azure Cosmos DB和DynamoDB都可以利用文档模型进行数据存储。文档数据库非常适合于只有一些结构或没有结构的数据，或者开发人员可能需要在以后灵活地扩展和更改数据的情况。通常，这些系统涉及内容管理、高可扩展性，并且需要提供优异的写入性能。</p><h4 id="h-document-databases">列数据库</h4><p><a href="https://en.wikipedia.org/wiki/Column-oriented_DBMS" target="_blank" rel="noreferrer noopener">列数据库</a>已经存在了一段时间，遵循与典型关系数据库相似的模型，只是表是按列存储的，而不是按行存储的。<a href="https://en.wikipedia.org/wiki/Wide-column_store" target="_blank" rel="noreferrer noopener">宽</a>——列存储数据库实际上是一个独立的NoSQL概念，在这个概念中，同一表中不同行之间的列可以有不同的名称和格式。相似的数据被分组为列，相似的列被分组为“列族”。可以对列进行分区，如果需要，单个列可以占据整个磁盘。</p><p>GCP Bigtable和Azure Cosmos DB支持宽列数据模型。它们在处理分布式系统中的大量数据时非常有效，尤其是当数据存储太大而无法占用单台机器或集群时。高流和分析数据是宽列存储数据库的理想选择。</p><h4 id="h-column-databases">什么是OLTP和OLAP？</h4><p><a href="https://database.guide/what-is-oltp/" target="_blank" rel="noreferrer noopener">联机事务处理(OLTP) </a>和<a href="https://olap.com/olap-definition/" target="_blank" rel="noreferrer noopener">联机分析处理(OLAP) </a>是传统上与关系数据库相关的特定类型的数据处理和查询的方法和技术。OLTP通常适用于大量发生的小型、孤立的交易，并且需要成功的保证，例如银行交易。OLAP事务是更复杂的查询，通常涉及连接和聚合，可以对大型数据集产生分析见解。</p><p>历史上，NoSQL数据库一直难以提供OLTP <em>或</em> OLAP。OLTP要求<a href="https://database.guide/what-is-acid-in-databases/%5D" target="_blank" rel="noreferrer noopener">原子性、一致性、隔离性和持久性(ACID) </a>合规性。交易的每一部分都必须成功；部分成功或失败会导致整个事务回滚。NoSQL数据库经常回避这些保证，以换取可伸缩性、可用性和速度。</p><h4 id="h-what-is-oltp-and-olap">OLAP在查询中需要复杂的连接和聚合逻辑。由于NoSQL数据对象通常是非结构化的性质，连接很难执行，需要复杂的软件逻辑和多次昂贵的查询。在NoSQL数据库上实现OLAP通常意味着将数据批量导出到辅助ETL平台进行聚合和分析。</h4><p>那么，三大巨头提供的NoSQL服务能解决这些问题吗？交易和分析仍然是数据处理的关键需求，能够将NoSQL的性能与其中任何一项结合起来将是一个强大的组合。</p><p>DynamoDB <a href="https://aws.amazon.com/blogs/aws/new-amazon-dynamodb-transactions/" target="_blank" rel="noreferrer noopener">在2018年</a>增加了事务处理能力，为NoSQL数据库带来了ACID。像金融交易这样的事情所需的原子性和一致性现在在NoSQL数据库中是可能的。</p><p>相反，像GCP Bigtable这样的解决方案明确建议<a href="https://cloud.google.com/bigtable/docs/overview#other-storage-options" target="_blank" rel="noreferrer noopener">不适合OLTP/OLAP </a>。GCP数据存储区也与<a href="https://cloud.google.com/datastore/docs/concepts/overview" target="_blank" rel="noreferrer noopener">共享相同的指南</a>。</p><p>对于Cosmos DB来说，故事更加模糊:对OLAP和OLTP的支持是最近宣布的。然而，它仍然需要链接不同的运行时和产品来提供完整的体验。</p><p><a href="https://go.acloudguru.com/AWS-Cost-Optimization-Webinar"> <strong>自动化AWS成本优化</strong> </a> <br/> AWS为您的企业提供了前所未有的价值，但经济高效地使用它可能是一项挑战。在这个<a href="https://go.acloudguru.com/AWS-Cost-Optimization-Webinar">免费点播的网络研讨会</a>中，您将了解AWS成本优化工具和策略的概况，如<a href="https://acloudguru.com/course/introduction-to-optimizing-data-storage-in-aws">数据存储优化</a>。</p><p>NoSQL价格效率比较</p><p>在前一节中，列出了每项服务的基本成本。虽然这是很有帮助的数据，但是苹果与苹果之间的比较至少会给潜在客户一个粗略的概念，即对于给定的用例，每个提供商提供的产品的“价格效率”如何。</p><hr class="wp-block-separator"/><p class="has-text-align-center">在这种情况下，考虑价格效率意味着:“为编写、存储和查询给定数量的信息提供最低的端到端成本”。考虑以下假设的例子:</p><hr class="wp-block-separator"/><h3 id="h-nosql-price-efficiency-comparison"><strong>示例数据库(使用1个月)</strong></h3><p><strong>存储大小</strong></p><p><strong>平均物体/实体尺寸</strong></p><figure class="wp-block-table is-style-stripes"><table><thead><tr><th><strong>读取/秒</strong></th></tr></thead><tbody><tr><td><strong>每秒写入次数</strong></td><td><strong>入口/出口带宽</strong></td><td>350 GB</td><td>512字节</td><td>高峰:500 <br/>非高峰:125</td></tr><tr><td>高峰:100 <br/>非高峰:25</td><td>53.08 GB / 265.5 GB</td><td>上表描述了假设的NoSQL数据库实施中一个月的使用情况。这是一个简单的示例，不包括复制、备份或提供商可能提供的任何专有增强或辅助服务。为了进一步简化示例，将做一些额外的假设:</td><td>高峰时间在工作日每天8小时“有效”</td><td>将使用30天的月份</td></tr></tbody></table></figure><p>自由层的使用不会被考虑在内</p><ul><li>一个月30天的总阅读量:518，400，000</li><li>一个月30天的总写入数:103，680，000</li><li>实体/文档大小将始终为512字节</li><li>存储大小是总大小的假定计费平均值</li><li>地区是美国东部</li><li>出口将是美国洲际酒店</li><li>下表将利用每个提供商提供的信息来估算在其服务上实现示例数据库的每月总成本。</li><li>DynamoDB已配置</li><li><strong>存储</strong></li></ul><p><strong>显示为</strong></p><h4 id="h-dynamodb-provisioned"><strong>写道</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td><strong>带宽</strong></td><td>$81.25</td><td>高峰:10.40美元<br/>非高峰:8.32美元</td><td>高峰:10.40美元<br/>非高峰:8.32美元</td></tr><tr><td>$23.90</td><td><strong>总费用:142.59美元/月</strong></td><td>dynamo db–按需</td><td><strong>存储</strong></td></tr><tr><td><strong>显示为</strong></td></tr></tbody></table></figure><h4 id="h-dynamodb-on-demand"><strong>写道</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td><strong>带宽</strong></td><td>$81.25</td><td>$129.60</td><td>$129.60</td></tr><tr><td>$23.90</td><td><strong>总费用:364.35美元/月</strong></td><td>GCP大表</td><td><strong>存储(SSD) </strong></td></tr><tr><td><strong> 6节点集群</strong></td></tr></tbody></table></figure><h4 id="h-gcp-bigtable"><strong>带宽</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td>$66.50</td><td>$3110.40</td><td>$31.86</td></tr><tr><td><strong>总费用:3208.76美元/月</strong></td><td>数据存储模式下的gcp风暴</td><td><strong>存储</strong></td></tr><tr><td><strong>显示为</strong></td></tr></tbody></table></figure><h4 id="h-gcp-firestore-in-datastore-mode"><strong>写道</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td><strong>带宽</strong></td><td>$34.65</td><td>$171.07</td><td>$102.64</td></tr><tr><td>$31.86</td><td><strong>总费用:340.22美元/月</strong></td><td>azure Cosmos DB–自动扩展配置</td><td><strong>存储</strong></td></tr><tr><td><strong>请求单位</strong></td></tr></tbody></table></figure><h4 id="h-azure-cosmos-db-autoscale-provisioned"><strong>带宽</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td>$87.50</td><td>高峰:28.80美元<br/>非高峰:24.58美元</td><td>$21.24</td></tr><tr><td><strong>总费用:<strong>162.12</strong>/月</strong></td><td>azure Cosmos DB–手动调配</td><td><strong>存储</strong></td></tr><tr><td><strong>请求单位</strong></td></tr></tbody></table></figure><h4 id="h-azure-cosmos-db-manual-provisioned"><strong>带宽</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td>$87.50</td><td>峰值:19.20美元<br/>非峰值:16.38美元</td><td>$21.24</td></tr><tr><td><strong>总费用:<strong>144.32</strong>/月</strong></td><td>azure Cosmos DB–无服务器(按需)</td><td><strong>存储</strong></td></tr><tr><td><strong>请求单位</strong></td></tr></tbody></table></figure><h4 id="h-azure-cosmos-db-serverless-on-demand"><strong>带宽</strong></h4><figure class="wp-block-table is-style-stripes"><table><tbody><tr><td>$87.50</td><td>$155.52</td><td>$21.24</td></tr><tr><td><strong>总费用:264.26美元/月</strong></td><td>在“价格效率”讨论中，DynamoDB解决方案的低成本显然是赢家。</td><td>其次是Cosmos DB手动配置选项。</td></tr><tr><td>GCP Bigtable以很大优势排在最后。然而，目标用户群体可能会通过更大量的数据实现更好的成本效益。</td></tr></tbody></table></figure><p>一致性和复制</p><p>简单地说，在数据库中实现一致性意味着写入一些任意数据将使该数据立即可用于对该数据的所有后续读取。</p><p>对于像单个关系数据库节点这样的小型整体架构，这很容易实现。然而，对于大规模的分布式NoSQL体系结构来说，如果不是不可能的话，也是极其困难的。</p><h3 id="h-consistency-and-replication">有哪些选项可以实现NoSQL服务的一致性——这看起来很重要吗？</h3><p>组织应该在尝试实施更强的一致性或完全ACID合规性之前，评估其数据库架构的主要使用情形。</p><p>如果数据库是社交媒体平台的后端，那么强一致性可能不是很重要。来自一个用户的帖子不需要立即被所有其他用户看到。</p><p>相反，在敏感、受监管驱动的环境中，如银行业，高度的一致性和完全的ACID合规性至关重要。反映借项或贷项的交易需要立即得到继续交易的重视，否则将会发生代价高昂的会计错误。</p><p>下表列出了每项服务可用的一致性选项:</p><p><strong>服务</strong></p><p><strong> <strong>一致性选项</strong> </strong></p><p>AWS DynamoDB</p><figure class="wp-block-table is-style-stripes"><table><thead><tr><th>-最终一致<br/>-强烈一致</th><th>GCP大表</th></tr></thead><tbody><tr><td>-最终一致<br/>-读您的写操作一致<br/>-非常一致</td><td>数据存储模式下的gcp风暴</td></tr><tr><td>-非常一致</td><td>天蓝色宇宙数据库</td></tr><tr><td>–<a href="https://docs.microsoft.com/en-us/azure/cosmos-db/consistency-levels">五个定义的级别</a></td><td>所有的提供者都提供了很强的一致性作为配置选项，但是它有一些警告。强一致性对计费写入使用具有倍增效应，尤其是在多个群集、碎片或区域的情况下。它还会影响延迟和整体数据库性能，因为每次写入都必须成功执行多次，操作才能被视为“完成”，数据才能用于后续读取。组织应该仔细关注用例、典型的工作负载形式，以及性能权衡是否值得。</td></tr><tr><td>自托管</td><td>有几个非常强大的第三方NoSQL解决方案可用于自托管。</td></tr></tbody></table></figure><p>对于键值存储，Redis是一个非常受欢迎的解决方案。</p><h2 id="h-self-hosting">MongoDB和CouchDB是众所周知且广泛使用的文档数据库。</h2><p>对于宽列风格的数据库，Apache提供了HBase和Cassandra。</p><ul><li>与之前讨论的托管解决方案相比，它们是否有任何潜在优势？</li></ul><ul><li>自托管解决方案的主要且明显的优势是最大限度地减少了供应商锁定。任何提供普通计算实例的云提供商都可以作为自托管的潜在平台。组织可以选择具有最合适的生态系统和价格的提供商，并迁移其现有解决方案，而无需昂贵的重新培训和定制。</li></ul><ul><li>拥有现有NoSQL部署的组织可能会发现移植到托管解决方案的成本和复杂性太高，从而失去了在维护和性能调整方面积累的数据和知识。</li></ul><p>对于希望部署首个NoSQL基础架构的组织来说，托管服务更具吸引力。操作和管理负担完全由提供商来处理，这对于缺乏资源来部署和维护数据库集群的精简工程团队来说尤其有利。</p><p>考虑到这两种方式都会产生带宽成本，在大多数情况下，利用提供商及其托管产品的现有工程智慧是有意义的。</p><p>底线是:哪个NoSQL服务是最好的？</p><p>哪个NoSQL服务最好？这是一个两部分的回答。</p><p>从价格效率和周边提供商服务生态系统的实力来看，DynamoDB是最好的NoSQL服务。用户可以以非常低的成本利用DynamoDB的性能，选择预先配置，或者在他们拨入工作负载时按需配置。可以启用像强一致性和事务这样的特性，为需要关系产品稳定性的组织提供灵活性。</p><h2 id="h-the-bottom-line-which-nosql-service-is-the-best">然而，这并不意味着其他产品不值得一看。</h2><p>数据存储模式下的GCP Firestore对于需要构建快速、可扩展MVP的小型团队来说极具吸引力，因为它与其他GCP管理的产品(如App Engine)相集成。</p><p>GCP Bigtable支持谷歌的一些最大的服务，如GMail和YouTube，应该值得需要快速流式传输、存储和分析TB和Pb数据的团队考虑。</p><p>Azure Cosmos DB将NoSQL带入了更传统的混合企业世界，因为许多Azure客户通常集成云和本地解决方案。Cosmos DB在数据模型和支持的数据类型方面提供了广泛的灵活性，因此现有的Azure客户可以根据需要访问强大的NoSQL解决方案，并可以利用传统的SQL查询来访问NoSQL后端。</p><ul><li>像任何技术选择一样，总会有权衡，但在大多数情况下，最佳选择将是DynamoDB。</li></ul><ul><li>获得更好职业所需的技能。</li></ul><ul><li>掌握现代技术技能，获得认证，提升您的职业生涯。无论您是新手还是经验丰富的专业人士，您都可以通过实践来学习，并在ACG的帮助下推进您的云计算职业生涯。</li></ul><p>查看更多NoSQL数据库阅读</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-get-the-skills-you-need-for-a-better-career">关于作者</h2><p class="has-text-align-center"><em> <a href="https://mikevanbuskirk.io/" target="_blank" rel="noreferrer noopener">迈克·范布斯柯克</a>是首席DevOps工程师和技术内容创作者。他曾与世界上一些最大的云计算、电子商务和CDN平台合作过。他目前的重点是云优先架构和无服务器基础设施。</em></p><hr class="wp-block-separator"/><h4 id="h-check-out-more-nosql-database-reads">Check out more NoSQL Database Reads</h4><h5 id="h-about-the-author">About the Author</h5><p><em><a href="https://mikevanbuskirk.io/" target="_blank" rel="noreferrer noopener">Mike Vanbuskirk</a> is a Lead DevOps engineer and technical content creator. He’s worked with some of the largest cloud, e-commerce, and CDN platforms in the world. His current focus is cloud-first architecture and serverless infrastructure.</em></p></div></div>    
</body>
</html>