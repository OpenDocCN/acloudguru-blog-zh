<html>
<head>
<title>6 things I’ve learned in my first 6 months using serverless | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>我在使用无服务器|云专家的前6个月学到的6件事</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/six-months-of-serverless-lessons-learned#0001-01-01">https://acloudguru.com/blog/engineering/six-months-of-serverless-lessons-learned#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p id="bf81">在10月份的无服务器会议结束后，我决定我的整个公司将无服务器运营。前几个月我一直在碰壁<a href="https://read.acloud.guru/adventures-in-migrating-to-serverless-a63556b39042" target="_blank" rel="noreferrer noopener">，试图将Python Flask app </a>迁移到Lambda——这些努力帮助我找到了更好的方法。</p><p id="bf81">将一个简单的web应用程序迁移到无服务器的恐惧和沮丧——我花了一个周末的时间与功能斗争，同时试图将托管在<a href="https://acloudguru.com/blog/engineering/adventures-in-migrating-to-serverless"> Elastic Beanstalk上的Flask应用程序迁移到AWS </a>。</p><p id="e02c">六个月后，我们现在正在部署我们的第四个主要项目。这就是我们如何做到的——包括发展的<a href="https://acloudguru.com/solutions/individuals">云技能</a>、吸取的教训<em>以及在此过程中形成的强烈意见</em>。</p><h3 id="1b3f">第1课-放弃Python</h3><p id="e38d">flashboard是一个很好的小框架，适用于服务器管理会话的网站的老式请求-响应风格。这很奇怪——但在互动网络的新世界里，这就像试图用橡皮筋和橡胶扫帚建造一所房子。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/b6f9019da158ee2113fd71464ee1f305.png" alt="Python Flask app runs on Elastic Beanstalk, storing data in RDS" class="wp-image-42353" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/1_zxfBj5hPtinpfRJK3_CGpQ.png"/><figcaption>The old way: Python Flask app runs on Elastic Beanstalk, storing data in RDS</figcaption></figure></div><p id="f3bd">随着您开始将更多的工作转移到客户端来支持交互，您将别无选择，只能使用JavaScript。这通常会导致内联到你的Python模板中，而技术债务的<mark>恶魔为你打开了另一个信用额度</mark>。</p><p id="93ea">Flask解决方案逐渐成为不同语言的混合体。我很快得出结论，这种方法非常糟糕——我不确定为什么我还要使用Python。</p><p id="07ee">在切换到Node之后，一切都变得更容易维护和更符合逻辑，并且不需要使用一种以上的语言。通过在Webpack上进行简单的Node/Express配置，您还可以使用ES6来消除Python开发人员取笑的可怕的JavaScript结构。</p><p id="1823">在Zappa/Flask做同样的事情比做我的税务还糟糕。但是，在大约5分钟内，你可以构建一个完全成熟的Node/Express应用程序，它可以像1040EZ一样在Lambda上工作——这没什么大不了的。所以我们抛弃了Python，加入了JavaScript阵营中的酷孩子。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/8cc83c451faeaed0894f7fa0adeb872b.png" alt="Build a fully-fledged Node Express app that works on Lambda." class="wp-image-42345" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_cIeYrB-v2NlRgbe6.png"/><figcaption>Lambda Function As Monolith</figcaption></figure></div><p id="2099">我们放弃了什么？Pythonistas会热情洋溢地讲述所有很酷的语言特性，但与JavaScript的实用异步魅力相比，这些只是玩具。现在我们不再担心Python版本2或3(它会升级吗？).至少对我们的项目来说，这是一个非常容易的转变。</p><p id="0a85">当然，<a href="https://medium.com/u/586bd5b557d2?source=post_page-----f6da86a73526--------------------------------" target="_blank" rel="noreferrer noopener"> Ben Kehoe </a>提供了一个引人注目的<a href="https://read.acloud.guru/node-is-the-wrong-runtime-for-serverless-jk-c69595f6a8eb" target="_blank" rel="noreferrer noopener">替代的煽情陷阱</a>，他的观点和见解是关于使用Python还是Node来实现无服务器！</p><h3 id="47cf">第二课——将中间层夷为平地</h3><p id="503b">我们花了令人惊讶的时间才意识到无服务器的明显优势——可能是因为我们一直在构建web应用程序，或者可能只是因为我变老了。</p><p id="086f">我们最初的一些web应用程序仍然有一个Node Express层，它要么(1)意外地希望用户一次又一次地点击同一个Lambda容器，要么(2)由于设计的悲剧，我们滥用DynamoDB来让它记住会话id。我们到底在做什么？</p><p id="fc36">在“过渡”的第一阶段，我们的中间层就像Lambda上的web服务器，这是错误的，也是糟糕的。然后我们得到了html页面，其中充满了调用REST APIs的JavaScript。这种方法非常原始，难以维护，并且很快变得脆弱——但是我们已经杀死了中间层。在无服务器中，<em>中间层要去</em>。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/5cf2addea88c6ed0199bea33bd55fe02.png" alt="Logic moves to Lambda, in serverless there is no middle layer. " class="wp-image-42350" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_zOcQl4UwJ9FchYxt.png"/><figcaption>State moves to the client, logic moves to Lambda</figcaption></figure></div><h3 id="d4ea">第3课—享受Vue</h3><p id="0cfb">能够把所有东西都塞进前端是很棒的，但是很快就变得一团糟。你最终停止签入代码，因为你不好意思分享你一直在创造的Rube Goldberg机器魔术。“不签入代码”对开发人员来说不是一个好的工作目标。</p><p id="1095">进入单页面应用程序(SPAs)的世界让我接触到了React——这是构建用户界面最流行的方法。React很棒，但是有一个陡峭的学习曲线，大量的Webpack/Babel设置，以及JSX的引入。虽然它可能是我们最终使用的东西，但对于我们的直接需求来说，它太重了，所以要探索替代方案。</p><p id="15de">幸运的是，我很快发现<a href="https://vuejs.org/" target="_blank" rel="noreferrer noopener"> Vue.js </a>并且我的无服务器生活变成了绝对的幸福。事情是这样的:<em>你可以在一天内学会Vue！</em></p><p id="02cd">Vue的设计方法与我们的设计模型非常契合——一切都是管理自己的内容、设计和代码的组件。这使得管理我们的多个客户项目和分散的团队变得非常容易，并且对于无服务器的思维模式也非常适用。</p><p id="9487">开源JavaScript框架为您提供了强大的调试工具、出色的组织和开箱即用的Webpack构建，从而节省了时间。安装路由器和商店管理插件——你就可以像脸书工程师一样制作实时性感的应用程序。谁知道单页应用会如此简单？</p><p id="0b70">从无服务器的角度来看，Vue将你所有的优点编译成index.html和bundle.js文件，准备上传到S3。键入<code>npm run build</code>是新的编译命令。</p><p id="bc4f">请花点时间考虑一下——在过去，我们会通过Elastic Beanstalk部署应用程序，监控利用率，在需要时自动扩展，并管理合理的基础架构。</p><p id="b182">SPAs的真正神奇之处在于，当您“部署”一个应用程序时，您只是简单地将index.html、bundle.js和一些文件依赖项复制到一个由CloudFront发行版作为前端的S3存储桶中。这为您提供了稳定的分发和加载行为，还支持多版本管理和您喜欢的任何部署方法——只需管理文本文件。</p><p id="a2dd">我们的规模实际上是无限的，并且只为我们使用的东西付费，没有应用程序基础架构管理。</p><p id="e810">Vue本质上允许您在浏览器中构建桌面应用程序，这意味着您可以显著改善用户体验。所有的状态都可以在这里管理，没有无休止的请求/响应，您可以用标准的UI技巧(如转换效果)隐藏延迟，整个应用程序现在行为正常。</p><h3 id="9c0f">第4课—学会爱上DynamoDB</h3><p id="914c">在许多方面，实现无服务器最困难的部分是真正掌握DynamoDB。在最初的几次迭代中，您肯定会犯一些错误，并且很容易放弃所有的东西，回到RDS，在那里一切都是已知的和舒适的。</p><p id="4e73">很长一段时间以来，SQL一直是我的支柱，我承认在数据库中放入了太多的业务逻辑。但是RDMS系统只是另一个庞然大物——无法很好地扩展，并且它们不支持有机进化敏捷系统的想法。</p><p id="887c">DynamoDB是完全不同的动物。如果使用得当，NoSQL数据库可以提供极高的性能、巨大的规模，而且几乎没有管理开销。但是你真的需要花时间去探索它是如何工作的——而且最初的阶段充满了陷阱。</p>  <p id="7a1d">发电机表字段不能包含空字符串。时间点备份不是自动的。如果您弄错了分区和排序键，您必须从表开始。如果您试图过于接近地模拟SQL查询，那么您的表可能会从太少变得太多。一直以来，RDS给人的感觉都很陌生。</p><p id="3c77">经过许多教程，尝试，失败和最终成功与DynamoDB，我学会了…</p><ul><li>您需要了解DynamoDB的工作方式，花一些时间了解索引策略，以及您打算如何查询数据。很容易在不知道你需要知道的一切的情况下就投入进去，所以很多人被烧伤，然后在完全错误的时间搬回RDMS。犯错误并克服它们。</li><li>DynamoDB最少被讨论的乐趣之一是可以使用流将代码附加到表事件上——就像可以做任何事情的SQL触发器。这些都是极其强大的。我们使用的一个非常简单的模式是总是将表更新推送到SNS主题，其中的更改可以被您可能还没有编写的其他无服务器代码<em>接收。</em></li><li>不要忘记，DynamoDB可以支持其他存储系统(RDMS、红移或纯文本文件)，可以用来有效地消除流量峰值或保护另一个数据库免受海量数据的影响。DynamoDB有一个TTL特性，允许您使行过期——这对于存放您想推到其他地方的数据非常有用。</li></ul><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/db78bfd99dcc97836db306d8bde7571a.png" alt="" class="wp-image-42348" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_T_pYtoufH6Jbg_AH.png"/></figure></div><h3 id="cc28">第5课—无服务器框架FTW</h3><p id="732c">我早期对Lambda的实验是一件笨拙的事情，直接编码到AWS控制台中，并对做一些琐碎的事情需要大量的工作和错误消息感到沮丧。缺少将IDE连接到生产环境的桥梁。</p><p id="ca06">嗯，直到你发现了无服务器框架，这是我多年来发现的最令人兴奋的东西。</p><p id="8e65">一个简单的<code>sls deploy</code>拥有巨大的力量，将你宝贵的代码捆绑起来，直接发送到亚马逊的大脑。如果你因为代码行为不当而需要检查日志，只需输入<code>sls logs -f functionname -t</code>，你就可以像专业人士一样跟踪你的CloudWatch日志，而无需打开浏览器。</p><p id="38a1">这个。变化。一切。没有服务器的人应该因为做了每个云提供商从第一天起就应该提供的事情而获得大量赞誉。简直太棒了。而且<em>这么多赢</em>。</p>  <h3 id="6060">第六课——授权是镇上的新警长</h3><p id="8694">在传统的应用程序中，你对用户进行一次身份验证，然后通过一个会话ID来跟踪这个人。我们喜欢它，因为你只需要做一次艰苦的工作，然后ID就可以让你在用户登录的整个生命周期内作弊，只要你愿意。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/aff6ce42b98365ec9efeda840160e673.png" alt="" class="wp-image-42349" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_WqG5t_wfMmWSIkWS.png"/><figcaption>In the old world, the session ID controls access</figcaption></figure></div><p id="d103">但是这种方法有问题。只有当您将服务器放在中间时，它才会起作用，而我们刚刚将该服务器夷为平地。它也潜在地将你暴露给一些讨厌的攻击——像跨站点请求伪造(CSRF)——并且不允许你非常容易地将身份传递给其他服务。所以这种方法基本上支持Monolith ( <em> boooo！</em>)。</p><p id="6ae6">我们讨厌巨石柱和CSRF袭击——但是我们喜欢我们的新朋友，JWT令牌。当我知道这是如何工作的时候，我有一个禅宗般的兴奋时刻，但我需要一个图表来做好它。</p><p id="a7c4">第一步，获得一个JWT，第二步，使用它与您编写的任何服务进行通信:</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/0e79ef9bccecaecc9d9e66421521153e.png" alt="" class="wp-image-42347" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_gQuLLljLfz_Sed9q.png"/><figcaption>The first step looks familiar: the authorization process gets a JWT token</figcaption></figure><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/35e5eda3e2dc5bd8dc0b1627766a4b6a.png" alt="" class="wp-image-42344" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2021/01/0_4HmZSEr0tLdnZ86c.png"/><figcaption>The second step is magic: any lambda function can accept and validate the token</figcaption></figure></div><p id="d901">基本的难点是每个请求都要经过身份验证，客户端甚至可以与多个无服务器活动对话。它非常安全，它是反垄断的，CSRF甚至不存在于JWT土地上。您的无服务器代码所需要的就是使用一个定制的授权器来检查标题中的JWT是否有效(使用样板代码)，我们就完成了。</p><p id="3bf7">JWT让所有其他类型的认证看起来过于复杂。我们把一切都换成了<a href="https://auth0.com/" target="_blank" rel="noreferrer noopener"> Auth0 </a>(在某些情况下还有Cognito)，再也没有回头。无服务器身份验证既简单又非常有效，所以，团队加油。</p>  <h3 id="2881">这是一个勇敢的新世界</h3><p id="a468">虽然我与AWS合作了很长时间，但我从未如此接近底层。即使在EC2的土地上，也有很多帮助，因为我参加聚会相对较晚。离开云专家的无服务器会议后，这感觉像是真正未被探索的领域，在黑暗中有明显更多的发现。</p>  <p id="cd0f">在我们最初的几个实验中，我们在尝试使用现有的工具和技术时有一些失误——结果并不理想。经过几个月的准备，我们已经正式开始以100%无服务器的方式交付项目。我相信我们的迁徙和早期探索是值得的。</p><p id="198d">我们正在构建流畅的实时水疗应用，这些应用完全使用无服务器基础设施，可轻松扩展，成本降低70–90%。我对回报既高兴又震惊。我从未如此确信无服务器技术将彻底改变云中的应用交付。</p><p id="4175">结果是革命性的。</p><hr class="wp-block-separator is-style-wide"/><h2 class="has-text-align-center" id="h-get-the-skills-you-need-for-a-better-career">获得更好职业所需的技能。</h2><p class="has-text-align-center">掌握现代技术技能，获得认证，提升您的职业生涯。无论您是新手还是经验丰富的专业人士，您都可以通过实践来学习，并在ACG的帮助下推进您的云计算职业生涯。</p><hr class="wp-block-separator is-style-wide"/></div></div>    
</body>
</html>