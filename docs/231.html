<html>
<head>
<title>How I Scaled My Static Website to a Global Market on AWS | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>我如何在AWS |云专家上把我的静态网站扩展到全球市场</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/scaling-your-static-site-to-a-global-market-for-a-fraction-of-the-cost-on-aws#0001-01-01">https://acloudguru.com/blog/engineering/scaling-your-static-site-to-a-global-market-for-a-fraction-of-the-cost-on-aws#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p id="afc7">在过去的几年里，我一直在建立一个网站来托管免费编程教程。这个网站始于2014年，是一个充满激情的项目，代表了数千小时的鲜血、汗水和泪水——这是我的骄傲和快乐。</p><p id="66c2">现在，我意识到它并不完美——但它是免费的，并为我提供了一个磨练自己技能的机会，同时鼓励其他人学习编程。我的激情项目已经变成了一个成功的、不断成长的副业项目，需要在不花费我一大笔钱的情况下扩大规模。</p><h3 id="fa5a">一开始——有一个服务器</h3><p id="3866">该网站起源于2014年，当时只是一些反映我兴趣的游戏开发教程。截至2016年1月，该网站每天的用户总数达到了150-200人。</p><p id="18cd">这些年来，这种流量持续增长，对我的服务器的需求也持续增加。额外的流量需要升级我的Linode服务器实例——这允许基于Laravel的网站继续运行，而不会在短期内崩溃。</p><p id="c4f7">在花了很长时间在Laravel中构建我的网站，并尝试确定哪些有效之后，我最终迁移到Hugo——一个不需要<a href="https://acloudguru.com/blog/engineering/serverless-php"> PHP或花哨框架</a>的静态网站构建器。</p><p id="5a57">当时，迁移到Hugo在一定程度上提高了网站的速度。它还降低了服务器成本，因为我不再依赖MySQL数据库来托管内容。我最后还喝了AWS kool-aid，并把我的站点迁移到了T2微实例上。</p><p id="7bf7">该站点的架构图如下所示:</p><p id="355e">有一段时间，一切都很平静。</p><p id="4ddb">我的构建管道已经排序。我在写新的内容，并试图改善网站。交通越来越拥挤。那是一个和平的时代。</p><h3 id="3750"><strong>挑战—表演</strong></h3><p id="9b14">过了一会儿，我开始注意到网站开始变慢。网站性能开始明显下降，我隐约知道为什么会这样。</p><p id="ff71">当使用流行的网站速度测试<mark>工具</mark> Pingdom时，在高峰使用时间，我看到在所有其他请求开始解决之前，平均有大约<strong>0.8秒</strong>的大量等待时间。最终加载时间大约为1.5-2.5秒。</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/95bf277ca4a63121c1f4a37d436ff05a.png" alt="" class="wp-image-42245" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_EyeVHjRL4o_Lnp-LGtQ9zQ.png"/></figure><p id="1b5a">注意在这个例子中，在DNS解析之后，第二个<a href="https://acloudguru.com/blog/engineering/the-secret-sauce-behind-amazon-route53">请求有很长的等待时间。这些指标是在流量相当少的时期获得的，但是它提供了一些关于性能下降的见解。</a></p><h3 id="7c0c">计划——考虑我的选择</h3><p id="8d61">展望未来，我认为有两种选择:</p><ol><li>启动一个负载平衡器和一个自动扩展组，并将我的应用程序部署到所需的任意数量的T2实例中。</li><li>随着云锋从T2迁移到S3。</li></ol><p id="1ea2">第一个选择非常吸引我。我最近一直在学习Terraform和创建有弹性的Go APIs，并且已经将我的站点配置为使用LetsEncrypt来处理HTTPS流量。</p><p id="0812">然而，这种选择并不便宜。这种方法意味着成本增加，CPU容量闲置，需要更多的管理。随着我使用更多的服务和构建更多的教程，我的AWS发票每个月都在攀升——所以我担心会给我的账单增加更多的实例。</p><p id="11f2">第二个选择是我认为风险要大得多的。我必须找到一种方法，使用CloudFront和Route53在前端管理流量，将我的live站点从T2实例迁移到S3的bucket。</p><p id="1b1c">我是所有东西都被加密的忠实拥护者，所以网站继续通过HTTPS服务是一个硬性要求。幸运的是，这可以通过使用Amazon的ACM服务并使用电子邮件验证请求证书来轻松实现。</p><p id="1b1c">ACM现在允许您将Amazon发布的SSL证书部署到您的弹性负载平衡器或CloudFront发行版。查看这篇关于<a href="https://acloudguru.com/blog/engineering/aws-certificate-manager-a-potential-game-changer"> AWS证书管理器</a>的帖子。</p><h3 id="e754">决定—迁移到S3的静态站点</h3><p id="2d34">迁移我的站点的第一个目的地是CI/CD管道。TravisCI非常简单，如下所示:</p><pre class="wp-block-code"><code>language: python
install:
  - wget https://github.com/gohugoio/hugo/releases/download/v0.34/hugo_0.34_Linux-64bit.deb
  - sudo dpkg -i hugo*.deb
script:
  - hugo --buildDrafts
  - cp -r scripts public/
deploy:
  provider: s3
  ... all my S3 creds</code></pre><p id="917b">每当有人提交到我的回购主分支，这就启动了一个构建，并上传到我的生产S3桶。</p><p id="6601">一旦CI/CD管道就绪，我就完成了一个简单的更改，并确保bucket的配置是正确的。</p><p id="c11a">瞧啊。—我要提供的静态文件都在那里，随时可以使用。</p><p id="f90b">在我对我的CloudFlare配置和Route 53设置的其余部分有信心之后，我将我的站点的名称服务器迁移到Amazon的。24小时后，我准备就绪，并成功完成了迁移。我现在可以退役原来的T2.micro实例了。</p><p id="f9d6">在配置CloudFront发行版时，我选择从所有可能的边缘位置对我的站点进行缓存和服务。</p><p id="105c">这意味着，每当有人从澳大利亚来请求我的网站时，将首先在边缘位置进行缓存查找——如果缓存命中，网站的加载时间将会非常短。否则，将从原始S3存储桶提供服务，并为任何后续请求进行缓存。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/0379918b4af897420d237727c354277c.png" alt="Map of AWS Edge locations" class="wp-image-42243" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_9eTAdjkyoV1koHs0bm-93g.png"/><figcaption>The map of all of AWS’ Edge locations</figcaption></figure></div><p id="3fd7">虽然这个选项花费更多，但是性能的提高绝对是值得的，而且总成本仍然远远低于我以前每月的花费。</p><blockquote class="wp-block-quote"><p>特别感谢艾伦·里德，他帮助我完成了S3、云锋和53号公路的配置</p></blockquote><h3 id="31b1">结果—更快、更便宜、更好！</h3><p id="c3a1">迁移到AWS静态网站完成后，结果令人震惊。我已经把我的加载时间从大约1.5秒-2.5秒降到了一个<strong>的234毫秒</strong>，正如下面的截图所强调的。这是一个疯狂的性能提升。</p><p id="3145">看看这些请求时间，现在最大比例的时间花在DNS解析上，即使这样也不过0.1秒多一点。</p><div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" src="../Images/dc70d11207c02c913b126021a1a92c6d.png" alt="" class="wp-image-42246" data-original-src="https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2020/12/1_MaFf0IsAqv0lSlYJHu_cFA.png"/><figcaption>We are no longer in Wait hell!</figcaption></figure></div><p>根据Pingdom的数据，我的网站现在比其他所有测试过的网站快99%。正如你所看到的，还有一些我可以改进的地方！</p><p id="b466">但这次迁移最令人震惊的是，它不仅极大地提高了我的站点的性能，还提高了弹性，因为我不再依赖单个T2实例来维持我的运行。</p><p id="0834">从经济角度来看，托管网站的成本已经从大约每月20美元降低到大约每月7美元:</p><ul><li>Route53约为0.50美元/月</li><li>CloudFront大约是6.50美元/月</li><li>一小部分花费在S3桶存储上</li></ul><p id="e4f6">这是一个令人难以置信的节省，让我放心。如果有一天我的网站流量激增，我的网站会有弹性，而且不会花我一大笔钱。</p><h3 id="5813">结论</h3><p id="5f04">在尝试了许多部署和托管静态站点的不同方法之后，这无疑是最好的方法之一。</p><p id="db88">这是性能和成本的完美结合。这种简单性使它成为每个希望托管自己的站点的人的一个容易获得的选择，这些站点具有巨大的弹性和高度的可伸缩性。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-get-the-skills-you-need-for-a-better-career">获得更好职业所需的技能。</h2><p class="has-text-align-center">掌握现代技术技能，获得认证，提升您的职业生涯。无论您是新手还是经验丰富的专业人士，您都可以通过实践来学习，并在ACG的帮助下推进您的云计算职业生涯。</p><hr class="wp-block-separator"/><p id="db88">大家好！欢迎来到我的频道，TutorialEdge！这是我发布所有视频教程的地方——youtube.com</p><p id="04d8">希望你发现这个激动人心的动荡和胜利的故事很有趣！如果你想支持我，请随时查看我的YouTube频道或在LinkedIn上加我。</p></div></div>    
</body>
</html>