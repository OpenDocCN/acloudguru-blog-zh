<html>
<head>
<title>Azure Bicep File Deployment for Windows or Linux VM | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>面向Windows或Linux虚拟机的Azure Bicep文件部署|云专家</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/azure-bicep-file-windows-or-linux#0001-01-01">https://acloudguru.com/blog/engineering/azure-bicep-file-windows-or-linux#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p>今天，我们将谈论二头肌锉刀。就像它的生物学同名物一样，二头肌的知识是一个非常<em>方便的</em>工具来<em>武装</em>你自己(对不起，我们控制不住自己！).</p><p>在其核心，Bicep是一种声明性语言，您可以使用它以可靠和一致的方式简化和加速您的Azure部署过程。您可以在Bicep文件中定义想要部署Azure资源的结构。</p><hr class="wp-block-separator"/><h2 class="has-text-align-center" id="h-the-power-is-in-your-hands">权力在你手中</h2><p class="has-text-align-center">掌控你的职业生涯。<a href="https://acloudguru.com/pricing">从ACG开始</a>通过AWS、Microsoft Azure、Google Cloud等领域的课程和实际动手实验室增强您的技能。</p><hr class="wp-block-separator"/><p>什么是重复性？</p><h2 id="h-what-is-repeatability">作为代码，基础设施有很多优点，但它最大的好处之一是可重复性。就其核心而言，可重复性仅仅意味着能够从相同的设置中产生完全相同的结果。目标是您编写的代码应该能够在各种环境和场景中使用和重用。</h2><p>我们如何使我们的部署文件更加可重用？</p><h2 id="h-how-do-we-make-our-deployment-files-more-reusable">让我们的部署文件变得更加可重用的一些方法是使用参数和变量。</h2><p>因素</p><h3>参数用于在执行代码时提示用户输入值。这样，您不必将特定的信息硬编码到部署文件中。</h3><p>参数将用于每次运行部署文件时需要更新的值。</p><p>变量</p><h3>另一方面，变量用于指定一个特定的值，该值可以在部署文件中反复使用。与参数不同，变量在值很少变化时使用。但是如果它们确实需要改变，而不是更新文件中的每个值，您只需要更新变量，并且对该变量的所有引用也将具有该值。</h3><p>参数和变量可以保存多种数据，如字符串、整数、数组，甚至是具有属性层的对象。</p><p>参数和变量如何应用于编写Bicep文件？</p><hr class="wp-block-separator"/><h2 id="h-how-do-parameters-and-variables-apply-to-writing-bicep-files">通过使用这两个工具，参数和变量，我们可以使bicep文件适应许多情况。</h2><p>我将介绍如何编写一个Bicep文件来部署一个带有Windows操作系统或Linux操作系统的虚拟机，所有这些都基于用户的输入。部署文件后，将询问用户虚拟机应该是Windows还是Linux，然后根据响应，bicep文件将知道使用什么属性来部署该操作系统。</p><p>创建参数</p><h3 id="h-creating-a-parameter">让我们从创建一个参数开始，询问用户他们是想要部署Windows虚拟机还是Linux虚拟机。在Bicep中，声明参数的方式是使用以下语法:</h3><p>正如我们从下面的代码片段中看到的，我们将参数命名为“windowsOrlinux ”,以让运行部署的用户知道他们应该选择哪个操作系统。</p><div class="wp-block-columns"><div class="wp-block-column"><div class="wp-container-640f2a9cdd9dd wp-block-group"><div class="wp-block-group__inner-container"><pre class="wp-block-code"><code>“param &lt;name of parameter&gt; &lt;type of parameter data&gt;”</code></pre></div></div></div></div><p>为了给如何使用这个参数添加更多的上下文，我们还使用了“description”修饰符。此外，我们还有“允许的”装饰者。这用于指定该参数只接受特定值的列表，“windows”或“linux”。如果使用另一个值，将会出现一个错误，告诉您部署文件无效，因为该参数只允许使用某些值。</p><p>创建可变对象</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/59c8aa47b62f2ca51b1087baee00bd51.png" alt="" class="wp-image-119387" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1159/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png 1159w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png 380w" sizes="(max-width: 1159px) 100vw, 1159px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-1.png"/></figure><h3 id="h-creating-a-variable-object">既然用户已经选择了要用于虚拟机的操作系统，下一步就是向部署文件中添加逻辑，以根据选择确定要使用的映像配置。我们可以通过创建一个变量对象来实现，如下图所示:</h3><p>声明变量</p><figure class="wp-block-image size-large"><img loading="lazy" src="../Images/08bedfa9cc484312290a493bc23e08e7.png" alt="" class="wp-image-119388" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1161/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png 1161w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1024/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png 1024w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png 380w" sizes="(max-width: 1161px) 100vw, 1161px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-2.png"/></figure><h3 id="h-declaring-a-variable">在我们讨论变量对象是如何工作的之前，让我们快速回顾一下如何声明一个变量。您可以简单地使用以下语法:</h3><p>当谈到变量的值时，在许多情况下，这将只是一个单一的值，如整数或字符串。这可以通过硬编码值或利用函数生成值来实现。</p><div class="wp-block-columns"><div class="wp-block-column"><div class="wp-container-640f2a9cddd0e wp-block-group"><div class="wp-block-group__inner-container"><pre class="wp-block-code"><code>“var &lt;name of variable&gt; = &lt;value of variable&gt;” </code></pre></div></div></div></div><p>或者，您可以将一个对象存储为值，该值可以通过信息层保存多个值。这通常用在像这里这样保存配置数据的情况下。</p><p>因此，在我们的代码片段中，我们可以看到我们存储了两个值“windows”和“linux ”,它们列在花括号中。然后，在这些值中，有一些属性，如publisher、offer、sku和version，它们都被包装在自己的一组花括号中。除了这些属性，还有这些属性的特定配置值。在我们的示例中，我们使用的是Windows 2019数据中心映像或Ubuntu 18.04映像。</p><p>图像参考属性</p><h3 id="h-image-reference-properties">现在我们有了一个参数，它将存储“linux”或“windows”的值，以及一个带有相关配置的图像变量。但是他们是如何走到一起的呢？模板如何知道如果参数值是“windows ”,它需要使用图像变量中的windows配置？反之亦然，带有“linux”值？下面，我们有一个虚拟机资源声明的片段，重点是存储配置文件部分中的映像引用属性。</h3><p>在查看这个代码片段时，您可能注意到的第一件事是publisher、offer、sku和version的图像引用属性与上面配置的image变量中保存的属性相匹配。</p><figure class="wp-block-image size-full"><img loading="lazy" src="../Images/247d2b3dc742985f1d9a52b5ab1e722d.png" alt="" class="wp-image-119463" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1022/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 1022w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 380w" sizes="(max-width: 1022px) 100vw, 1022px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png"/></figure><p>属性值</p><hr class="wp-block-separator"/><hr class="wp-block-separator"/><h3 id="h-property-values">让我们继续讨论财产价值。</h3><p>仔细看看同一个代码片段，我们首先有一个对“image”变量的引用，然后在最后我们可以看到有一个句点，后跟相应的object属性。例如，如果“image”的值是“linux”，那么“offer”子属性的值就是“UbuntuServer”。否则，如果“image”的值是“windows”，则“offer”子属性的值将是“WindowsServer”。</p><figure class="wp-block-image size-full"><img loading="lazy" src="../Images/247d2b3dc742985f1d9a52b5ab1e722d.png" alt="" class="wp-image-119463" srcset="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_1022/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 1022w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_300/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 300w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_768/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 768w, https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto,w_380/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png 380w" sizes="(max-width: 1022px) 100vw, 1022px" data-original-src="https://res.cloudinary.com/acloud-guru/image/fetch/c_thumb,f_auto,q_auto/https://acg-wordpress-content-production.s3.us-west-2.amazonaws.com/app/uploads/2022/04/Azure-bicep-4.png"/></figure><p>那么模板如何知道为“image”选择哪个值呢？这就是“windowsOrLinux”参数的用武之地。在“image”变量之后，括号中引用了“windowsOrLinux”参数，表示“image”变量的值是根据括号中的参数值选择的。</p><p>这就是为什么给参数添加一个允许值修饰器如此重要，因为我们必须确保参数值与变量对象中的值相匹配。所以现在，当部署这个文件时，当参数提示时，用户将选择“windows”或“linux”。然后，该参数将用于指定“image”变量对象中的哪些数据用于出版商、报价、sku和版本属性值。</p><p>结论和下一步措施</p><hr class="wp-block-separator"/><h2 id="h-conclusion-and-next-steps">这只是编写部署文件以适应多种情况的许多方法之一。还有其他可以利用的工具和策略，例如函数和模块。然而，正如我们从上面的例子中看到的，虽然这些策略中的每一个都有助于提高可重复性，但是当它们结合在一起时会更加有效。</h2><p>如果你想参考本文中提到的完整二头肌文件，你可以在这里找到这个<a href="https://github.com/linuxacademy/content-intro-to-azure-resource-manager/blob/main/blog-content/deploy.bicep"/>。</p><p>如果你觉得这个演练很有趣，并想了解更多关于Bicep以及如何更有效地部署和管理Azure资源，请查看我的课程<em><a href="https://acloudguru.com/course/introduction-to-azure-resource-manager" target="_blank" rel="noreferrer noopener">Azure资源管理器</a> </em>简介。</p><p>你也可以<a href="https://www.youtube.com/c/AcloudGuru/?sub_confirmation=1" target="_blank" rel="noreferrer noopener">在YouTube上订阅一个云专家</a>来定期修复微小的技术内容。为什么不把本周的<a href="https://acloudguru.com/videos/azure-this-week" target="_blank" rel="noreferrer noopener">变成你观看节目的一部分呢？</a></p><hr class="wp-block-separator"/><p>别忘了在<a href="https://www.facebook.com/acloudguru" target="_blank" rel="noreferrer noopener">脸书</a>上喜欢我们，在<a href="https://twitter.com/acloudguru" target="_blank" rel="noreferrer noopener">推特</a>上关注我们，并在<a href="http://discord.gg/acloudguru" target="_blank" rel="noreferrer noopener">不和</a>上加入对话。</p><p>Don’t forget to like us on <a href="https://www.facebook.com/acloudguru" target="_blank" rel="noreferrer noopener">Facebook</a>, follow us on <a href="https://twitter.com/acloudguru" target="_blank" rel="noreferrer noopener">Twitter</a>, and join the conversation on <a href="http://discord.gg/acloudguru" target="_blank" rel="noreferrer noopener">Discord</a>.</p></div></div>    
</body>
</html>