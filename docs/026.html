<html>
<head>
<title>Configure a Failover Cluster with Pacemaker | A Cloud Guru</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Pacemaker |云专家配置故障转移集群</h1>
<blockquote>原文：<a href="https://acloudguru.com/blog/engineering/configure-a-failover-cluster-with-pacemaker#0001-01-01">https://acloudguru.com/blog/engineering/configure-a-failover-cluster-with-pacemaker#0001-01-01</a></blockquote><div><div class="elementor-widget-container"><p><span> <em>高可用性</em>是IT行业的一个主要术语，这有几个原因。随着越来越多的企业通过互联网提供服务，对这些服务始终可访问的需求也在增长。你必须去实体店面购买商品和服务的日子已经一去不复返了。现在，在白天或晚上的任何时候，你都可以购买食物、衣服、娱乐或任何你能想到的东西，并把它们送到你家门口或在媒体设备上消费。这就是高可用性T4的用武之地。确保您的服务保持高可用性是在现代市场中取得成功的关键。在本教程中，我们将在两台CentOS 7服务器上安装Pacemaker集群，并对其进行配置，以确保我们的服务保持高可用性。</span></p><h2>安装起搏器集群</h2><p><span> Pacemaker是一个高可用性集群资源管理器(CRM ),可用于管理资源，并确保在发生节点故障时资源仍然可用。</span> <span>首先，我们需要安装Pacemaker包和pcs命令行工具。在两个节点上，运行:</span></p><pre>sudo yum install -y pacemaker pcs</pre><p><span>在两个节点上运行<code>firewall-cmd</code>命令，允许Pacemaker的流量(TCP端口2224、3121、21064和UDP端口5405): </span></p><pre>sudo firewall-cmd --permanent --add-service=high-availability sudo firewall-cmd --reload</pre><p><span>启动并启用pcsd服务。同样，在两个节点上运行这些命令:</span></p><pre><span>sudo systemctl start pcsd.service</span><span>sudo systemctl enable pcsd.service</span></pre><p><span>再次在两个节点上为<code>hacluster</code>用户设置密码，该密码是在软件包安装期间创建的。该用户将用于向其他集群节点进行身份验证，并在集群上执行操作:</span></p><pre>sudo passwd hacluster</pre><p><span>在<code>node1</code>日，认证为<code>hacluster</code>用户:</span></p><pre>sudo pcs cluster auth NODE1 NODE2</pre><p><span>在<code>node1</code> : </span>生成并同步corosync配置</p><pre><span>sudo pcs cluster setup --name cluster_name NODE1 NODE2 </span></pre><p><span>在<code>node1</code> </span>上启动集群:</p><pre><span>sudo pcs cluster start --all</span></pre><h2>配置群集资源</h2><p><span>现在集群已经启动并运行，我们可以创建我们的集群资源了。首先，我们将创建一个IP地址资源，然后创建一个Apache HTTP服务器资源。一旦创建了资源，我们就可以设置资源约束来确保IP地址总是在Apache HTTP服务器之前开始，并且两个资源总是在同一个节点上一起运行。</span> <span>添加一个IP地址资源到<code>node1</code> : </span>上的集群</p><pre><span>sudo pcs resource create cluster_ip ocf:heartbeat:IPaddr2 ip=192.168.1.100 cidr_netmask=24 op monitor interval=30s</span></pre><p><span>在两个节点上安装Apache HTTP服务器，打开防火墙的HTTP端口:</span></p><pre>sudo yum install -y httpd sudo firewall-cmd --permanent --add-service=http sudo firewall-cmd --reload</pre><p><span>在两个节点上，启用状态URL进行健康监控:</span></p><pre><span>sudo cat &gt; /var/www/html/index.html &lt;&lt;EOF</span><span>    SetHandler server-status</span><span>    Require local</span> <span>EOF</span></pre><p><span>将Apache HTTP服务器资源添加到<code>node1</code> : </span>上的集群中</p><pre><span>sudo pcs resource create apache ocf:heartbeat:apache configfile=/etc/httpd/conf/httpd.conf statusurl="https://localhost/server-status" op monitor interval=1min</span></pre><p><span>对<code>node1</code>设置一个托管约束，保证集群资源运行在同一个节点上:</span></p><pre><span>sudo pcs constraint colocation add apache with cluster_ip INFINITY</span></pre><p><span>同样，在<code>node1</code>上，设置一个顺序约束，以确保集群资源以正确的顺序启动:</span></p><pre><span>sudo pcs constraint order cluster_ip then apache</span></pre><p><span>验证<code>node1</code> : </span>的资源约束</p><pre><span>sudo pcs constraint</span></pre><p><span>在<code>node1</code> : </span>上验证集群资源的状态</p><pre><span>sudo pcs status</span></pre><hr/><p><span>现在，我们已经使用Pacemaker成功配置了故障转移集群！如果一个节点出现故障，资源将自动转移到群集中的一个工作节点。</span></p><h2>想了解更多？</h2><p><span>如果你喜欢这个简短的教程，并想了解关于Pacemaker的更多信息，请查看我的<a target="_blank" rel="noopener noreferrer" href="https://linuxacademy.com/linux/training/course/name/linux-academys-lpic-3-304-virtualization-and-high-availability-preparation-course" noreferrer="1"> <em> LPIC-3 304虚拟化和高可用性</em> </a>预备课程。本课程涵盖Pacemaker，以及其他几种支持高可用性和虚拟化的技术和服务。</span></p></div></div>    
</body>
</html>